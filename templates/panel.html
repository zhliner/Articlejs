<!--主面板区
----------------------------------------------------------------------------->

<!--录入：
    insert 插入已创建的元素/集（detail），通用。
    instop 插入顶层固定单元。
    insfix 插入区块内固定性单元，如：标题、表头、导言等。
    instbd 插入表体<tbody>元素（特例）。
    update 跟随更新，来源：内容区选取变化、标签页切换。
-->
<form class="Input" tpl-name="slave:input"
    on="submit|avoid;
        update|v.sels;
        insert|ev('detail') checked('before') value('level');
        instop|ev('detail') value('level');
        insfix|ev('detail') value('level');
        instbd|ev('detail') checked('merge') value('level');
        insrbpt|ev('detail') checked('before') value('level')"
    by="-;-;
        Kit.inserts(_2);
        Kit.topinsert(_1);
        Kit.fixinsert(_1);
        Kit.instbody(_2);
        Kit.insrbpt(_2)"
    to="/._body|trigger('create');
        /#con-level|trigger('renew');
        #g-scroll|trigger('focus');
        #g-scroll|trigger('focus');
        #g-scroll|trigger('focus');
        #g-scroll|trigger('focus');
        #g-scroll|trigger('focus')">
    <div class="_roll">
        <!--插入位置：
            ev:detail 已选取元素的集合。
            renew 选单更新。fire非延迟避免闪烁。
            section 片区单元内容混杂检查（标记_mixed类名）。
            click focus 快捷操作友好。 -->
        <div id="con-level" class="_minibar"
            on="renew|ev('detail') $('/input') val('level') v.inslist(_1);
                section|('_mixed') $('/input') val('level') v.ismixed;
                click(input)|$('1/select') focus v.sels"
            to="1/select|fill|fire(10, 'change', 0) goto('section');
                1/select|toggleClass(_1);
                |trigger('renew')">
            <label title="平级插入">
                <input type="radio" name="level" value="siblings" checked /><i id="l-siblings"></i>
            </label>
            <label title="向内插入">
                <input type="radio" name="level" value="children"><i id="l-children"></i>
            </label>
        </div>
        <!--动态选单
            input.select 快捷键选取。从data-k特性取值触发（仅部分）。
            change 空选单时采用empty模板，str 用前缀构造最终模板名。
            备忘：
            scroll 聚焦便于快捷键定位。取消本设计：内容区切换选取后选单重构会激发此事件，使内容区失焦（不友好）。 -->
        <select id="input-items" name="items" size="5" class="_list"
            on="change|evo(3) val or('empty') str('input:') pop tpl;
                input.select|ev('detail') slr('/','-k', _1) $(_1) dup pass prop('value')"
            to="form/._body|replace;
                |val|goto('change')">
            <!-- 动态更新：与目标关联的合法单元。 -->
        </select>
    </div>
    <div class="_body _Empty" tpl-name="input:empty">
        <p on="^obted|(KM.slaveResize)" to="/code:first-child|text">
            <code>[Alt]</code> + 拖动改变面板高度<br>
            <code>[ Alt+F ]</code> 录入框最大化<br>
            <code>[ Ctrl+Enter ]</code> 录入框内直接提交<br>
            <code>[ Ctrl+Shift+Enter ]</code> 录入框内直接提交并取消最大化<br>
        </p>
    </div>
</form>


<!-- 微编辑 -->
<form class="Input Minied" onsubmit="return false" tpl-name="slave:minied">
    <div class="_roll">
        <div class="_minibar"
            on="click(input)|evo(2) val pop tpl;
                click(input)|evo(2) attr('-val') pop tpl"
            to="1/select|replace|focus fire(11, 'change');
                2/._body|replace">
            <label title="内联元素">
                <input type="radio" name="ctype" value="item:inlines" data-val="minied:inlines" checked /><i id="l-element"></i>
            </label>
            <label title="文本字符">
                <input type="radio" name="ctype" value="item:ctypes" data-val="minied:chars" /><i id="l-schar"></i>
            </label>
        </div>
        <!--固定选单
            input.select 快捷键选取。从data-k特性取值触发。
            change str 用前缀（inlines:）构造模板名。 -->
        <select name="inlines" size="5" class="_list _inlines" tpl-name="item:inlines"
            on="change|evo(3) val dup pass str('inlines:') pop tpl;
                input.select|ev('detail') slr('/','-k', _1) $(_1) dup pass prop('value')"
            to="2/._main|fill;
                |val|goto('change')">
            <option tpl-node="
                option:audio,
                option:video,
                option:picture,
                option:svg,
                option:ruby,
                option:meter,
                option:space,
                option:img,
                option:br,
                option:wbr,
                option:a,
                option:q,
                option:abbr,
                option:del,
                option:ins,
                option:dfn,
                option:bdo,
                option:times,
                option:code,
                option:strong,
                option:em,
                option:cite,
                option:small,
                option:sub,
                option:sup,
                option:mark,
                option:orz,
                option:samp,
                option:kbd,
                option:s,
                option:u,
                option:var"></option>
        </select>
    </div>
    <div tpl-source="minied:inlines"> [主栏：单元属性] </div>
</form>


<!--样式：
    style 接收各子区发来的信息（[name,value]），设置内容区元素样式。
          不自动聚焦到内容区（由具体的片区自己决定）。
    erase 接收名称序列，擦除部分内联样式。应当激发主面板状态更新。
    submit 如果子区有提交逻辑，提交转发为子区修改（modify）事件，各子区因应而为。
    update 跟随更新：来源：内容区选取变化、标签页切换、样式按钮切换、清除/格式刷操作。
-->
<form class="Style" tpl-name="slave:style"
    on="style|v.sels ev('detail');
        erase|v.sels ev('detail');
        submit|avoid;
        update|stop v.sels dup len pass"
    by="Ed.setStyle(_);
        Ed.eraseStyle(_1)"
    to="-;
        #g-scroll|trigger('focus')|fire(3, 'update');
        /._body|trigger('modify');
        /._body|trigger('follow')">
    <!--click(b)：
        - 切换模板。
        - 表达按下，跟随更新。-->
    <div class="_icons"
        on="click(b)|evo(2) attr('-tpl') node(_1);
            click(b)|$$('/b')"
        to="1/._body|replace;
            =|only('_press')|fire('form/', 'update')">
        <!-- 直接执行：click stop 避免触发上层行为。-->
        <b title="擦除"
            on="click|stop v.sels"
            by="Ed.clearStyle"
            to="#g-scroll|trigger('focus')|fire('form/', 'update')">
            <i id="b-erase"></i>
        </b>
        <b data-tpl="style:align" title="对齐"><i id="b-align"></i></b>
        <b data-tpl="style:fontview" title="字形" class="_press"><i id="b-fontview"></i></b>
        <b data-tpl="style:width" title="宽/高度"><i id="b-width"></i></b>
        <b data-tpl="style:fontsize" title="字号"><i id="b-fontsize"></i></b>
        <b data-tpl="style:margin" title="内/外边距"><i id="b-margin"></i></b>
        <b data-tpl="style:color" title="颜色"><i id="b-colors"></i></b>
        <!-- 直接执行 -->
        <b title="样式刷"
            on="click|stop v.focus dup pass"
            by="Ed.brushStyle"
            to="#g-scroll|trigger('focus')|fire('form/', 'update')">
            <i id="b-brush"></i>
        </b>
    </div>
    <div class="_body" tpl-source="style:fontview"> [字形] </div>
</form>


<!-- 特性 -->
<form class="Attr" onsubmit="return false" tpl-name="slave:attr">
    <div class="_roll">
        <div class="_name">
            <input type="text" name="attr" value="" />
            <!-- ✚✛ -->
            <input type="button" value="✛" class="_add" />
        </div>
        <select name="attrs" size="5" class="_list" tpb-for>
            <option _="$">style</option>
        </select>
    </div>
    <div class="_body">
        <div class="_main">
            <!-- OBT: 分组对应提示 -->
            <header class="_tips" data-pbo="lost">
                <label data-pbo="">
                    <b>on</b><input type="text" spellcheck="false" class="_code" disabled />
                </label>
                <label data-pbo="">
                    <b>by</b><input type="text" spellcheck="false" class="_code" disabled />
                </label>
                <label data-pbo="lost">
                    <b>to</b><input type="text" spellcheck="false" class="_code" disabled />
                </label>
            </header>
            <textarea name="content" spellcheck="false" class="_code"></textarea>
        </div>
        <aside>
            <div class="_option">
                <label>换行符
                    <input type="text" name="nlchar" class="_char _code" value=";" />
                </label>
            </div>
            <hr tpl-node="common:submit" />
        </aside>
    </div>
</form>


<!-- 源码 -->
<form class="Source" onsubmit="return false" tpl-name="slave:source">
    <div class="_body _main">
        <textarea name="content" spellcheck="false" class="_code"></textarea>
    </div>
    <aside>
        <div class="_option">
            <label title="outerHTML"><input type="checkbox" name="outerHtml" />包含自身</label>
            <button>结构检查</button>
            <!-- _ok|_err -->
            <div class="_info _ok">OK!</div>
        </div>
        <hr tpl-node="common:submit" />
    </aside>
</form>


<!-- 脚本 -->
<form class="Script" onsubmit="return false" tpl-name="slave:script">
    <div class="_env">
        <label><input type="radio" name="runbox" value="sandbox" checked />沙盒内</label>
        <label><input type="radio" name="runbox" value="editor" />编辑器内</label>
    </div>
    <div class="_body">
        <div class="_main">
            <header>
                <input type="text" name="prefix" spellcheck="false" placeholder="记忆前缀：script-" class="_prefix" />
            </header>
            <textarea name="content" spellcheck="false" class="_code"></textarea>
        </div>
        <aside>
            <div class="_cmds">
                <b title="脚本历史"><i id="l-history"></i></b>
            </div>
            <div class="_submit">
                <button type="submit">运行</button>
            </div>
        </aside>
    </div>
</form>



<!--转换条目（子菜单）
    data-val 待转换目标单元名。
    <kbd>    单字符快捷键直达。
    注：仅包含完整的单元（不含中间结构）。
----------------------------------------------------------------------------->

<!-- 内联单元 -->
<menu role="submenu" class="_cells" tpl-name="menu:inlines">
    <li data-k="a" data-val="a" title="<a>"><b><a>链接</a></b><kbd>a</kbd></li>
    <li data-k="c" data-val="code" title="<code>"><b><code>代码</code></b><kbd>c</kbd></li>
    <li data-k="s" data-val="strong" title="<strong>"><b><strong>重点</strong></b><kbd>s</kbd></li>
    <li data-k="e" data-val="em" title="<em>"><b><em>强调</em></b><kbd>e</kbd></li>
    <li data-val="sup" title="上标<sup>"><b>O<sup>2</sup></b><kbd></kbd></li>
    <li data-val="sub" title="下标<sub>"><b>O<sub>2</sub></b><kbd></kbd></li>
    <li data-k="q" data-val="q" title="<q>"><b><q>引用</q></b><kbd>q</kbd></li>
    <li data-k="t" data-val="time" title="<time>"><b><time>时间</time></b><kbd>t</kbd></li>
    <li data-k="i" data-val="ins" title="<ins>"><b><ins>插入</ins></b><kbd>i</kbd></li>
    <li data-k="d" data-val="del" title="<del>"><b><del>删除</del></b><kbd>d</kbd></li>
    <li data-val="abbr" title="<abbr>"><b><abbr>缩写</abbr></b><kbd></kbd></li>
    <li data-val="small" title="<small>"><b><small>注脚</small></b><kbd></kbd></li>
    <li data-val="cite" title="<cite>"><b><cite>来源</cite></b><kbd></kbd></li>
    <li data-k="m" data-val="mark" title="<mark>"><b><mark>标记</mark></b><kbd>m</kbd></li>
    <li data-k="r" data-val="ruby" title="<ruby>">
        <b><ruby>
                <rb>注音</rb>
                <rp>(</rp><rt>zhù yīn</rt><rp>)</rp>
            </ruby></b>
        <kbd>r</kbd>
    </li>
    <li data-k="o" data-val="orz" title="表情<code:orz>"><b><code role="orz">(^_^)</code></b><kbd>o</kbd></li>
    <li data-val="dfn" title="<dfn>"><b><dfn>定义条目</dfn></b><kbd></kbd></li>
    <li data-val="samp" title="<samp>"><b><samp>样本</samp></b><kbd></kbd></li>
    <li data-k="k" data-val="kbd" title="<kbd>"><b><kbd>键盘字</kbd></b><kbd>k</kbd></li>
    <li data-val="s" title="<s>"><b><s>失效</s></b><kbd></kbd></li>
    <li data-k="u" data-val="u" title="<u>"><b><u>注记</u></b><kbd>u</kbd></li>
    <li data-k="v" data-val="var" title="<var>"><b><var>变量</var></b><kbd>v</kbd></li>
    <li data-k="b" data-val="bdo" title="<bdo dir=rtl>"><b><bdo dir="rtl">有向文本</bdo></b><kbd>b</kbd></li>
    <li data-pbo="disabled">&nbsp;</li>
    <!-- 注：不支持，只可划选创建 -->
    <!-- <li data-val="b" title="<b>"><b>特用&lt;b&gt;</b><kbd></kbd></li> -->
    <!-- <li data-val="i" title="<i>"><b>特用&lt;i&gt;</b><kbd></kbd></li> -->
</menu>


<!-- 行块单元（仅部分） -->
<menu role="submenu" tpl-name="menu:blocks">
    <li data-val="p" title="<p>"><b>段落</b><kbd>p</kbd></li>
    <li data-k="n" data-val="note" title="<p:note>"><b>注解</b><kbd>n</kbd></li>
    <li data-k="t" data-val="tips" title="<p:tips>"><b>提示</b><kbd>t</kbd></li>
    <li data-val="pre" title="<pre>"><b>预排版</b><kbd></kbd></li>
    <li data-val="address" title="<address>"><b>地址</b><kbd></kbd></li>
    <li data-k="u" data-val="ul" title="<ul>"><b>无序列表</b><kbd>u</kbd></li>
    <li data-k="o" data-val="ol" title="<ol>"><b>有序列表</b><kbd>o</kbd></li>
    <li data-val="ulx" title="<ul:ulx>"><b>无序级联表</b><kbd></kbd></li>
    <li data-val="olx" title="<ol:olx>"><b>有序级联表</b><kbd></kbd></li>
    <li data-k="c" data-val="cascade" title="<ol:cascade>"><b>级联编号表</b><kbd>c</kbd></li>
    <li data-k="b" data-val="blockquote" title="<blockquote>"><b>块引用</b><kbd>b</kbd></li>
    <li data-k="a" data-val="aside" title="<aside>"><b>批注</b><kbd>a</kbd></li>
    <li data-val="details" title="<details>"><b>详细内容</b><kbd></kbd></li>
    <!-- 注：不可为转换目标，因为无<dt>源（逻辑上）。 -->
    <!-- <li data-k="d" data-val="dl" title="<dl>"><b>描述列表</b><kbd>d</kbd></li> -->
</menu>

<!-- 空占位菜单（replace） -->
<menu role="submenu" tpl-name="menu:empty" data-pbo="hidden">
</menu>



<!--模态框区
----------------------------------------------------------------------------->
<!-- 确定/重置 -->
<div class="_btn2" tpl-name="modal:okreset">
    <button type="submit">确定</button>
    <button type="reset">重置</button>
</div>


<!-- 确定/取消 -->
<div class="_btn2" tpl-name="modal:okcancel">
    <button type="submit">确定</button>
    <button type="button">取消</button>
</div>

<!-- 确定 -->
<div class="_submit" tpl-name="modal:ok">
    <button type="submit">确定</button>
</div>


<!-- 模态页（通用） -->
<form class="_page" tpl-name="modal:page"
    on="submit|avoid">
    <header>
        <h4>[标题]</h4>
        <b class="_close" title="关闭">✕</b>
    </header>
    <div class="_list">
        <!-- [node] -->
    </div>
    <hr tpl-node="modal:okreset" />
    <!-- 条目标记 -->
    <input type="hidden" name="item" value="" />
</form>


<!-- 模态框：属性 -->
<form class="_usual" tpl-name="modal:prop"
    on="init|ev('detail') pop tpl;
        label|$('/._prop') attr('-label');
        submit|avoid"
    to="/>._list|fill|goto('label');
        /h4|text">
    <header>
        <h4>[标题]</h4>
        <b class="_close" title="关闭">✕</b>
    </header>
    <p class="_note" data-pbo="lost">
        [可选的说明/提示]
    </p>
    <div class="_list" data-pbo="">
        <!-- <ul> -->
    </div>
    <hr tpl-node="modal:okreset" />
</form>

<!-- 模态框：单行 -->
<form class="_small" tpl-name="modal:small"
    on="submit|avoid">
    <header>
        <h4>[标题]</h4>
        <b class="_close" title="关闭">✕</b>
    </header>
    <p><input type="text" name="txtline" /></p>
    <hr tpl-node="modal:okreset" />
</form>


<!-- 模态框：消息 -->
<form class="_message" tpl-name="modal:message"
    on="submit|avoid">
    <header>
        <h4>[标题]</h4>
        <b class="_close" title="关闭">✕</b>
    </header>
    <p class="_note">
        [消息内容]
    </p>
    <hr tpl-node="modal:ok" />
</form>


<!-- 插件页 -->
<form class="_page _plugins" tpl-name="modal:plugins"
    on="submit|avoid">
    <header>
        <h4>插件</h4>
        <b class="_close" title="关闭">✕</b>
    </header>
    <p class="_list">
        <!-- 点击执行：<b>... -->
    </p>
</form>


<!-- 模态页：脚本历史 -->
<form class="_page _history" tpl-name="script:history"
    on="submit|avoid">
    <header>
        <h4>脚本历史</h4>
        <b class="_close" title="关闭">✕</b>
    </header>
    <div class="_search">
        <!-- change|blur,select：避免历史遮挡 -->
        <input type="text" name="word" class="_text" placeholder="标记词" />
        <button type="submit">过滤</button>
    </div>
    <ol reversed tpb-for><li><code _="$"></code></li></ol>
</form>


<!-- 模态页：脚本执行结果 -->
<form class="_page _result" tpl-name="script:result">
    <header>
        <h4>脚本执行结果</h4>
        <b class="_close" title="关闭">✕</b>
    </header>
    <ul>
        <li tpb-if="$.error">
            错误：<i class="_error" _text="$.error"></i>
        </li>
        <li tpb-if="$.warn">
            警告：<i class="_warn" _text="$.warn"></i>
        </li>
        <li title="RESULT.type">
            操作类型：<b _text="$.type"></b>
        </li>
        <li title="RESULT.to">
            目标元素：<b _text="$.to"></b>
        </li>
        <li title="RESULT.selector">
            选择器：<b _text="$.selector"></b>
        </li>
        <li title="RESULT.method">
            插入方式：<b _text="$.method"></b>
        </li>
        <li>结果数据：</li>
        <li title="RESULT.data" class="_data">
            <div _html="$.data"></div>
        </li>
    </ul>
</form>
