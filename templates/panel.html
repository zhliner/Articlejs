<!--主面板区
----------------------------------------------------------------------------->

<!--录入：
    insert 插入已创建的元素/集（detail），通用。
    instop 插入顶层固定单元。
    insfix 插入区块内固定性单元，如：标题、表头、导言等。
    instbd 插入表体<tbody>元素（特例）。
    update 跟随更新，来源：内容区选取变化、标签页切换。
-->
<form class="Input" tpl-name="slave:input"
    on="submit|avoid;
        update|v.sels;
        insert|ev('detail') checked('before') value('level');
        instop|ev('detail') value('level');
        insfix|ev('detail') value('level');
        instbd|ev('detail') checked('merge') value('level');
        insrbpt|ev('detail') checked('before') value('level')"
    by="-;-;
        Kit.inserts(_2);
        Kit.topinsert(_1);
        Kit.fixinsert(_1);
        Kit.instbody(_2);
        Kit.insrbpt(_2)"
    to="/._body|trigger('create');
        /#con-level|trigger('renew');
        #g-scroll|trigger('focus');
        #g-scroll|trigger('focus');
        #g-scroll|trigger('focus');
        #g-scroll|trigger('focus');
        #g-scroll|trigger('focus')">
    <div class="_roll">
        <!--插入位置：
            ev:detail 已选取元素的集合。
            renew 选单更新。fire非延迟避免闪烁。
            section 片区单元内容混杂检查（标记_mixed类名）。
            click focus 快捷操作友好。 -->
        <div id="con-level" class="_minibar"
            on="renew|ev('detail') $('/input') val('level') v.inslist(_1);
                section|('_mixed') $('/input') val('level') v.ismixed;
                click(input)|$('1/select') focus v.sels"
            to="1/select|fill|fire(10, 'change', 0) goto('section');
                1/select|toggleClass(_1);
                |trigger('renew')">
            <label title="平级插入">
                <input type="radio" name="level" value="siblings" checked /><i id="l-siblings"></i>
            </label>
            <label title="向内插入">
                <input type="radio" name="level" value="children"><i id="l-children"></i>
            </label>
        </div>
        <!--动态选单
            input.select 快捷键选取。从data-k特性取值触发（仅部分）。
            change 空选单时采用empty模板，str 用前缀构造最终模板名。
            备忘：
            scroll 聚焦便于快捷键定位。取消本设计：内容区切换选取后选单重构会激发此事件，使内容区失焦（不友好）。 -->
        <select id="input-items" name="items" size="5" class="_list"
            on="change|evo(3) val or('empty') str('input:') pop tpl;
                input.select|ev('detail') slr('/','-k', _1) $(_1) dup pass prop('value')"
            to="form/._body|replace;
                |val|goto('change')">
            <!-- 动态更新：与目标关联的合法单元。 -->
        </select>
    </div>
    <div class="_body _Empty" tpl-name="input:empty">
        <p on="^obted|(KM.slaveResize)" to="/code:first-child|text">
            <code>[Alt]</code> + 拖动改变面板高度<br>
            <code>[ Alt+F ]</code> 录入框最大化<br>
            <code>[ Ctrl+Enter ]</code> 录入框内直接提交<br>
            <code>[ Ctrl+Shift+Enter ]</code> 录入框内直接提交并取消最大化<br>
        </p>
    </div>
</form>


<!-- 微编辑 -->
<form class="Input Minied" onsubmit="return false" tpl-name="slave:minied">
    <div class="_roll">
        <div class="_minibar"
            on="click(input)|evo(2) val pop tpl;
                click(input)|evo(2) attr('-val') pop tpl"
            to="1/select|replace|focus fire(11, 'change');
                2/._body|replace">
            <label title="内联元素">
                <input type="radio" name="ctype" value="item:inlines" data-val="minied:inlines" checked /><i id="l-element"></i>
            </label>
            <label title="文本字符">
                <input type="radio" name="ctype" value="item:ctypes" data-val="minied:chars" /><i id="l-schar"></i>
            </label>
        </div>
        <!--固定选单
            input.select 快捷键选取。从data-k特性取值触发。
            change str 用前缀（inlines:）构造模板名。 -->
        <select name="inlines" size="5" class="_list _inlines" tpl-name="item:inlines"
            on="change|evo(3) val dup pass str('inlines:') pop tpl;
                input.select|ev('detail') slr('/','-k', _1) $(_1) dup pass prop('value')"
            to="2/._main|fill;
                |val|goto('change')">
            <option tpl-node="
                option:audio,
                option:video,
                option:picture,
                option:svg,
                option:ruby,
                option:meter,
                option:space,
                option:img,
                option:br,
                option:wbr,
                option:a,
                option:q,
                option:abbr,
                option:del,
                option:ins,
                option:dfn,
                option:bdo,
                option:times,
                option:code,
                option:strong,
                option:em,
                option:cite,
                option:small,
                option:sub,
                option:sup,
                option:mark,
                option:orz,
                option:samp,
                option:kbd,
                option:s,
                option:u,
                option:var"></option>
        </select>
    </div>
    <div tpl-source="minied:inlines"> [主栏：单元属性] </div>
</form>


<!--样式：
    style 接收各子区发来的信息（[name,value]），设置内容区元素样式。
    erase 接收名称序列，擦除部分内联样式。应当激发主面板状态更新。
    submit 如果子区有提交逻辑，提交转发为子区修改（modify）事件，各子区因应而为。
    update 跟随更新：来源：内容区选取变化、标签页切换、样式按钮切换、清除/格式刷操作。 -->
<form class="Style" tpl-name="slave:style"
    on="style|v.sels ev('detail');
        erase|v.sels ev('detail');
        submit|avoid;
        update|stop v.sels"
    by="Ed.setStyle(_);
        Ed.eraseStyle(_1)"
    to="#g-scroll|trigger('focus');
        #g-scroll|trigger('focus')|fire(3, 'update');
        /._body|trigger('modify');
        /._body|trigger('follow')">
    <!--click(b)：
        - 切换模板。
        - 表达按下，跟随更新。-->
    <div class="_icons"
        on="click(b)|evo(2) attr('-tpl') node;
            click(b)|$$('/b')"
        to="1/._body|replace;
            =|only('_press')|fire('form/', 'update')">
        <!-- 直接执行：click stop 避免触发上层行为。-->
        <b title="擦除"
            on="click|stop v.sels"
            by="Ed.clearStyle"
            to="#g-scroll|trigger('focus')|fire('form/', 'update')">
            <i id="b-erase"></i>
        </b>
        <b data-tpl="style:align" title="对齐"><i id="b-align"></i></b>
        <b data-tpl="style:fontview" title="字形" class="_press"><i id="b-fontview"></i></b>
        <b data-tpl="style:width" title="宽/高度"><i id="b-width"></i></b>
        <b data-tpl="style:fontsize" title="字号"><i id="b-fontsize"></i></b>
        <b data-tpl="style:margin" title="内/外边距"><i id="b-margin"></i></b>
        <b data-tpl="style:color" title="颜色"><i id="b-colors"></i></b>
        <!-- 直接执行 -->
        <b title="样式刷"
            on="click|stop v.focus dup pass"
            by="Ed.brushStyle"
            to="#g-scroll|trigger('focus')|fire('form/', 'update')">
            <i id="b-brush"></i>
        </b>
    </div>
    <div class="_body" tpl-source="style:fontview"> [字形] </div>
</form>


<!-- 特性 -->
<form class="Attr" onsubmit="return false" tpl-name="slave:attr">
    <div class="_roll">
        <div class="_name">
            <input type="text" name="attr" value="" />
            <!-- ✚✛ -->
            <input type="button" value="✛" class="_add" />
        </div>
        <!--特性清单：
            - 支持多个选取的元素。
            - 全部元素都拥有的特性条目设置_all类名，部分元素拥有的特性条目设置_part类名。
            - 单击目标特性条目，值区域显示首个拥有该特性元素的该特性值。 -->
        <select name="attrs" size="5" class="_list" tpb-for>
            <option _class="$.type" _="$.name"></option>
        </select>
    </div>
    <div class="_body">
        <div class="_main">
            <!-- OBT: 分组对应提示 -->
            <header class="_tips" data-pbo="lost">
                <label data-pbo="">
                    <b>on</b><input type="text" spellcheck="false" class="_code" disabled />
                </label>
                <label data-pbo="">
                    <b>by</b><input type="text" spellcheck="false" class="_code" disabled />
                </label>
                <label data-pbo="lost">
                    <b>to</b><input type="text" spellcheck="false" class="_code" disabled />
                </label>
            </header>
            <textarea name="content" spellcheck="false" class="_code" placeholder="空白 特性删除&#10;''  空串值标识"></textarea>
        </div>
        <aside>
            <div class="_option">
                <label>换行符
                    <input type="text" name="nlchar" class="_char _code" value=";" />
                </label>
            </div>
            <hr tpl-node="common:submit" />
        </aside>
    </div>
</form>


<!--源码：
    仅支持内容区单个元素的源码显示。
    内容区多元素选取时，源码录入框失效。 -->
<form class="Source" tpl-name="slave:source"
    on="submit|avoid $('/textarea') val;
        update|v.sels dup len eq(1) $if('valid', 'invalid')"
    by="Ed.htmlUpdate"
    to="#g-scroll|trigger('focus');
        /textarea|trigger(_1)">
    <div class="_body _main">
        <!--状态切换
            失效：设置disabled，清空内容。
            生效：移除disalbed，填充发送来的源码。
            注记：源码编辑并不常见，因此未提供友好性（如自动缩进）。 -->
        <textarea name="html" spellcheck="false" class="_code"
            on="invalid|(true, null);
                valid|ev('detail') item(0) v.cleanHTML (false)"
            to="|val $disabled;
                |$disabled val"></textarea>
    </div>
    <aside>
        <div class="_option"
            on="click(button)|v.sels item(0) $('form/textarea') val trim dup pass"
            by="Kit.checkhtml(_1) dup $if('err', 'ok')"
            to="/pre|trigger(_1)">
            <button on="click|avoid">结构检查</button>
            <!--反馈信息：
                ok  结构正常。设置_ok类名、文本并取消聚焦能力。
                    3秒后隐藏文本，便于再次检查时反馈更清晰（不变的提示缺乏表达力）。
                err 结构错误。设置提示文本、移除_ok类名、赋予聚焦能力。
                错误时：
                focus 获取焦点后即平铺最大化。
                blur  失焦时取消平铺最大化。
                keydown 平铺时按 ESC 键聚焦源码框（失焦--取消平铺），stop避免全局ESC执行。
                注记：
                信息封装在<i>内便于样式控制。 -->
            <pre class="_info"
                on="ok|('_ok', '<i>Good!</i>', null);
                    err|(0, '_ok') ev('detail') wrap('<i>') prop('outerHTML') join('\n');
                    focus|evo(3) full;
                    blur|evo(3) full(false);
                    keydown|evo(3) fulled pass ev('key') pass('Escape') stop $('form/textarea') focus"
                to="|@tabindex @html addClass|delay(3000) $('/i') hide;
                    |@html removeClass @tabindex">...</pre>
        </div>
        <hr tpl-node="common:submit" />
    </aside>
</form>


<!-- 脚本 -->
<form class="Script" tpl-name="slave:script"
    on="submit|avoid $('/pre._code') text value('runbox itext ihtml');
        ^nodeok(~)|evo(3);
        shcode|ev('detail')"
    by="Ed.runScript(_) dup pass ('script:result') node;
        Kit.spinit"
    to="#g-modal|trigger('open')|pop fire('#g-modal>._script', 'result');
        -;
        /pre._code|trigger('codes')">
    <div class="_env"
        on="click([name=runbox])|evo(2) val str('run:') node"
        to="/fieldset|replace">
        <label>
            <input type="radio" name="runbox" value="sandbox" checked />沙盒内执行
        </label>
        <label class="_warn">
            <input type="radio" name="runbox" value="editor" />编辑器内运行
        </label>
        <fieldset class="_opts" tpl-name="run:sandbox"
            on="nodeok click(input)|$$('/label') attr('-tip') $$('/input') val arr2j(_1) join('\n')"
            to="2/pre|@-tip">
            <legend>数据：</legend>
            <label title="选取集文本" data-tip="TEXT 已选取元素文本集">
                <input type="checkbox" name="itext" />TEXT
            </label>
            <label title="选取集源码" data-tip="HTML 已选取元素源码集">
                <input type="checkbox" name="ihtml" />HTML
            </label>
        </fieldset>
        <fieldset class="_warn" data-tip="NODES 已选取元素集" tpl-name="run:editor"
            on="nodeok|evo(1) attr('-tip');
                ^obted|evo(3) delay remove"
            to="2/pre|@-tip">
            <legend>警告：</legend>
            <p>修改 DOM 可能会带来破坏性，导致编辑器不可用或内容丢失！</p>
        </fieldset>
    </div>
    <div class="_body">
        <div class="_main"
            on="^nodeok|('return 结果数据')"
            to="/pre|@-tip">
            <pre tpl-node="prop:codes" /></pre>
        </div>
        <aside>
            <!--脚本记录：
                - 执行之后计入脚本历史。
                - 提供历史条目的置顶和删除能力（简单复用和清理）。
                - 普通段包含前缀 yyyy-mm-dd[n]: 便于浏览，置顶段可自定义标签。
                功能：
                - 非管理模式下，单击某一条记录，自动插入脚本框内光标处。 -->
            <div class="_cmds">
                <b title="脚本历史"
                    on="click|tpl('script:history')"
                    to="#g-modal|trigger('open')"><i id="l-history"></i></b>
                <b title="执行结果"
                    on="click|tpl('script:result')"
                    to="#g-modal|trigger('open')"><i id="l-result"></i></b>
                <input type="hidden" name="tabs" value="4" />
            </div>
            <div class="_submit">
                <button type="submit">执行</button>
            </div>
        </aside>
    </div>
</form>



<!--转换条目（子菜单）
    data-val 待转换目标单元名。
    <kbd>    单字符快捷键直达。
    注：仅包含完整的单元（不含中间结构）。
----------------------------------------------------------------------------->

<!-- 内联单元 -->
<menu role="submenu" class="_cells" tpl-name="menu:inlines">
    <li data-k="a" data-val="a" title="<a>"><b><a>链接</a></b><kbd>a</kbd></li>
    <li data-k="c" data-val="code" title="<code>"><b><code>代码</code></b><kbd>c</kbd></li>
    <li data-k="s" data-val="strong" title="<strong>"><b><strong>重点</strong></b><kbd>s</kbd></li>
    <li data-k="e" data-val="em" title="<em>"><b><em>强调</em></b><kbd>e</kbd></li>
    <li data-val="sup" title="上标<sup>"><b>O<sup>2</sup></b><kbd></kbd></li>
    <li data-val="sub" title="下标<sub>"><b>O<sub>2</sub></b><kbd></kbd></li>
    <li data-k="q" data-val="q" title="<q>"><b><q>引用</q></b><kbd>q</kbd></li>
    <li data-k="t" data-val="time" title="<time>"><b><time>时间</time></b><kbd>t</kbd></li>
    <li data-k="i" data-val="ins" title="<ins>"><b><ins>插入</ins></b><kbd>i</kbd></li>
    <li data-k="d" data-val="del" title="<del>"><b><del>删除</del></b><kbd>d</kbd></li>
    <li data-val="abbr" title="<abbr>"><b><abbr>缩写</abbr></b><kbd></kbd></li>
    <li data-val="small" title="<small>"><b><small>注脚</small></b><kbd></kbd></li>
    <li data-val="cite" title="<cite>"><b><cite>来源</cite></b><kbd></kbd></li>
    <li data-k="m" data-val="mark" title="<mark>"><b><mark>标记</mark></b><kbd>m</kbd></li>
    <li data-k="r" data-val="ruby" title="<ruby>">
        <b><ruby>
                <rb>注音</rb>
                <rp>(</rp><rt>zhù yīn</rt><rp>)</rp>
            </ruby></b>
        <kbd>r</kbd>
    </li>
    <li data-k="o" data-val="orz" title="表情<code:orz>"><b><code role="orz">(^_^)</code></b><kbd>o</kbd></li>
    <li data-val="dfn" title="<dfn>"><b><dfn>定义条目</dfn></b><kbd></kbd></li>
    <li data-val="samp" title="<samp>"><b><samp>样本</samp></b><kbd></kbd></li>
    <li data-k="k" data-val="kbd" title="<kbd>"><b><kbd>键盘字</kbd></b><kbd>k</kbd></li>
    <li data-val="s" title="<s>"><b><s>失效</s></b><kbd></kbd></li>
    <li data-k="u" data-val="u" title="<u>"><b><u>注记</u></b><kbd>u</kbd></li>
    <li data-k="v" data-val="var" title="<var>"><b><var>变量</var></b><kbd>v</kbd></li>
    <li data-k="b" data-val="bdo" title="<bdo dir=rtl>"><b><bdo dir="rtl">有向文本</bdo></b><kbd>b</kbd></li>
    <li data-pbo="disabled">&nbsp;</li>
    <!-- 注：不支持，只可划选创建 -->
    <!-- <li data-val="b" title="<b>"><b>特用&lt;b&gt;</b><kbd></kbd></li> -->
    <!-- <li data-val="i" title="<i>"><b>特用&lt;i&gt;</b><kbd></kbd></li> -->
</menu>


<!-- 行块单元（仅部分） -->
<menu role="submenu" tpl-name="menu:blocks">
    <li data-val="p" title="<p>"><b>段落</b><kbd>p</kbd></li>
    <li data-k="n" data-val="note" title="<p:note>"><b>注解</b><kbd>n</kbd></li>
    <li data-k="t" data-val="tips" title="<p:tips>"><b>提示</b><kbd>t</kbd></li>
    <li data-val="pre" title="<pre>"><b>预排版</b><kbd></kbd></li>
    <li data-val="address" title="<address>"><b>地址</b><kbd></kbd></li>
    <li data-k="u" data-val="ul" title="<ul>"><b>无序列表</b><kbd>u</kbd></li>
    <li data-k="o" data-val="ol" title="<ol>"><b>有序列表</b><kbd>o</kbd></li>
    <li data-val="ulx" title="<ul:ulx>"><b>无序级联表</b><kbd></kbd></li>
    <li data-val="olx" title="<ol:olx>"><b>有序级联表</b><kbd></kbd></li>
    <li data-k="c" data-val="cascade" title="<ol:cascade>"><b>级联编号表</b><kbd>c</kbd></li>
    <li data-k="b" data-val="blockquote" title="<blockquote>"><b>块引用</b><kbd>b</kbd></li>
    <li data-k="a" data-val="aside" title="<aside>"><b>批注</b><kbd>a</kbd></li>
    <li data-val="details" title="<details>"><b>详细内容</b><kbd></kbd></li>
    <!-- 注：不可为转换目标，因为无<dt>源（逻辑上）。 -->
    <!-- <li data-k="d" data-val="dl" title="<dl>"><b>描述列表</b><kbd>d</kbd></li> -->
</menu>

<!-- 空占位菜单（replace） -->
<menu role="submenu" tpl-name="menu:empty" data-pbo="hidden">
</menu>



<!--模态框区
----------------------------------------------------------------------------->
<!-- 确定/重置 -->
<div class="_btn2" tpl-name="modal:okreset">
    <button type="submit">确定</button>
    <button type="reset">重置</button>
</div>


<!-- 确定/取消 -->
<div class="_btn2" tpl-name="modal:okcancel">
    <button type="submit">确定</button>
    <button type="button">取消</button>
</div>

<!-- 确定 -->
<div class="_submit" tpl-name="modal:ok">
    <button type="submit">确定</button>
</div>


<!--模态页（通用）
    注：可供插件开发调用。 -->
<form class="_page" tpl-name="modal:page"
    on="submit|avoid">
    <header>
        <h4>[标题]</h4>
        <b class="_close" title="关闭">✕</b>
    </header>
    <div class="_list">
        <!-- [node] -->
    </div>
    <hr tpl-node="modal:okreset" />
    <!-- 条目标记 -->
    <input type="hidden" name="item" value="" />
</form>


<!-- 模态框：属性 -->
<form class="_usual" tpl-name="modal:prop"
    on="init|ev('detail') pop tpl;
        label|$('/._prop') attr('-label');
        submit|avoid"
    to="/>._list|fill|goto('label');
        /h4|text">
    <header>
        <h4>[标题]</h4>
        <b class="_close" title="关闭">✕</b>
    </header>
    <p class="_note" data-pbo="lost">
        [可选的说明/提示]
    </p>
    <div class="_list" data-pbo="">
        <!-- <ul> -->
    </div>
    <hr tpl-node="modal:okreset" />
</form>

<!-- 模态框：单行 -->
<form class="_small" tpl-name="modal:small"
    on="submit|avoid">
    <header>
        <h4>[标题]</h4>
        <b class="_close" title="关闭">✕</b>
    </header>
    <p><input type="text" name="txtline" /></p>
    <hr tpl-node="modal:okreset" />
</form>


<!-- 模态框：消息 -->
<form class="_message" tpl-name="modal:message"
    on="submit|avoid">
    <header>
        <h4>[标题]</h4>
        <b class="_close" title="关闭">✕</b>
    </header>
    <p class="_note">
        [消息内容]
    </p>
    <hr tpl-node="modal:ok" />
</form>


<!-- 插件页 -->
<form class="_page _plugins" tpl-name="modal:plugins"
    on="submit|avoid">
    <header>
        <h4>插件集</h4>
        <b class="_close" title="关闭">✕</b>
    </header>
    <p class="_list">
        <!-- 点击执行：<b>... -->
    </p>
</form>


<!--脚本历史：
    submit  搜索过滤，空串搜索显示全部。
    nodeok  初始载入/展示置顶代码清单，一次即可。
    click   删除目标条目。 -->
<form class="_page _script" tpl-name="script:history"
    on="submit|avoid value('words');
        ^nodeok(~)|$('/#nav-tops');
        ^obted|$('/#sh-redo') $('/#sh-tops') $('/#sh-list') $$('/nav') spread;
        click(li>b[role=del])|stop evo(2) parent dup attr('-sid')"
    by="Kit.shsearch;
        Kit.shtops;
        Kit.shinit(_4);
        Kit.delsh(_1)">
    <header>
        <h4>脚本历史</h4>
        <b class="_close" title="关闭">✕</b>
    </header>
    <!--操作定义：
        click     code 单击代码确认提取。
        mousemove 定义上下区高度调整。$$('/>*') 确定为3个元素。
        _tophei   跟随设置置顶区高度。
        keydown   label 键入Enter也确认编辑（上下两区）。
    -->
    <main class="_history"
        on="@mouseup|movementY(null);
            @mousemove|movementY evo(3) $$('/>*') spread;
            click(li>code)|stop evo(2) attr('title');
            _tophei|ev('detail');
            _editon|(false);
            keydown(li>label)|ev('key') pass('Enter') avoid evo(2) blur"
        by="-;
            Kit.sh2panel(_4) spread add('px');
            Kit.shcode"
        to="|off('mousemove');
            /._down|%max-height|goto('_tophei', _1);
            .Modal/|trigger('cancel');
            /._top|height;
            (/._list>li>b)|lose">
        <!--内置限高：避免初始即溢出。
            click   li>b  置顶/取消置顶操作，同时激发下区状态同步。stopAll避免立即触发反向操作。
            click   label 单击即可编辑。
            blur    label 失焦即编辑确认，同时激发下区名称同步。
            edsync  相同条目的名称编辑同步（从下区来）。
            topsync 相同条目的置顶状态同步（从下区来）。-->
        <div class="_top" style="height: 35%;"
            on="click(li>b[role=top])|stopAll evo(2) parent attr('-sid');
                click(li>b[role=untop])|stop evo(2) parent attr('-sid');
                blur(li>label)|evo(2) parent attr('-sid') evo(2) text;
                click(li>label)|stop evo(2) attr('contenteditable') eq('true') end (true);
                edsync|ev('detail') spread slr('li', '-sid', _1) str('/', '>label') $(_1) dup pass pop;
                topsync|ev('detail') spread pick(-2) slr('li', '-sid', _1) str('/', '>b:first-of-type') $(_1) dup pass pop"
            by="Kit.topsh ('untop') dup;
                Kit.untop ('top') dup;
                Kit.shlabel(_1) (false);"
            to="=|@role|pack(2) pop fire('1/._down', 'topsync');
                =|@role|pack(2) pop fire('1/._down', 'topsync');
                =|$contenteditable|pop fire('1/._down', 'edsync');
                =|$contenteditable|focus select;
                -|$text;
                -|@role">
            <div class="_bar">
                <label>置顶区</label>
                <!-- 管理时显示，完成后隐藏（hidden） -->
                <span id="_urbox" data-pbo="hidden"
                    on="off|evo(3) hide $('main/') $('#nav-tops');
                        on|evo(3) hide(false) $('main/');
                        reset|$$('/b') disable;"
                    by="Kit.shEdok(_1);
                        Kit.shEdin"
                    to="|trigger('reset')|fire('main/._search', 'on', 0) fire('form/', 'submit');
                        |trigger('reset')|fire('main/._search', 'off') fire('main/', 'editon')">
                    <!--撤销：成功后会激活Redo。-->
                    <b id="sh-undo" title="撤消" data-pbo="disabled"
                        on="click|evo(3) disabled end;
                            state|evo(1) ev('detail') disable(_1);
                            enable|evo(1) disable(0)"
                        by="Kit.shUndo"
                        to="|trigger('state');
                            #sh-redo|trigger('enable')">↶</b>
                    <!--重做：成功后会激活Undo。-->
                    <b id="sh-redo" title="重做" data-pbo="disabled"
                        on="click|evo(3) disabled end;
                            state|evo(1) ev('detail') disable(_1);
                            enable|evo(1) disable(0)"
                        by="Kit.shRedo"
                        to="|trigger('state');
                            #sh-undo|trigger('enable')">↷</b>
                </span>
                <!-- click avoid 避免提交逻辑 -->
                <button type="button" data-op="off"
                    on="click|avoid $$('main/li>b') lose(2) (['on', 'off']) ('_edit') (['管理', '完成']);
                        bstate|evo(3) attr('-op')"
                    to="|^text toggleClass ^-op|goto('bstate');
                        1/span|trigger(_1)">管理</button>
            </div>
            <!--置顶区代码清单 -->
            <ul id="sh-tops" class="_list" tpb-for="$.list"
                on="update|ev('detail')"
                to="|replace">
                <li _data-sid="$.shid">
                    <label _="($.name || '---')">[片段名称]</label>
                    <code _title="$.code" _="$.code|cut($.$.cmax)">[代码：单击提取并导入脚本录入框]</code>
                    <time _="$.time|date('yyyy-MM-dd hh:mm')">[时间戳]</time>
                    <b data-pbo="lost" _data-pbo="$.$.edit ? null : 'lost'" role="untop" title="取消置顶"><i></i></b>
                    <b data-pbo="lost" _data-pbo="$.$.edit ? null : 'lost'" role="del">删除</b>
                </li>
            </ul>
            <!--分页主控：
                click 更新到目标页次。由By全权处理，因为需要可撤销。
                page  当前页更新。事件接收者，非延迟。
                state 导航信息更新。事件接收者，非延迟。值格式：[[Number2], [Boolean4]]
                注：
                事件会被搜索区导航完整克隆，注意选择器通用。-->
            <nav id="nav-tops"
                on="click(b)|evo(2) dup disabled end attr('-m') evo(3) pop;
                    page|ev('detail');
                    state|ev('detail') spread"
                by="Kit.shpage(_1)"
                to="-;
                    1/._list|trigger('update');
                    (/>b)|disable|pop fire('/code', 'update', 0)">
                <!-- data-m 对应页操作方法 -->
                <b data-m="first" title="首页"><i id="l-tobeg"></i></b>
                <b data-m="prev" title="前一页"><i id="l-prevpage"></i></b>
                <b data-m="next" title="后一页"><i id="l-nextpage"></i></b>
                <b data-m="last" title="末页"><i id="l-toend"></i></b>
                <code
                    on="update|stop ev('detail')"
                    to="(/i)|text">(<i>1</i>/<i>0</i>)</code>
            </nav>
        </div>
        <!--拖动：调整上下区域高度
            上区：CSS:height
            下区：CSS:max-height -->
        <hr on="mousedown|avoid"
            to="main/|bind('mousemove') once('mouseup')" />
        <!--下区行为：
            click   li>b  置顶/取消置顶操作，同时激发置顶区状态同步。
            click   label 单击即可编辑。
            blur    label 失焦即编辑确认。
            edsync  相同条目的名称编辑同步（从置顶区来）。
            topsync 相同条目的置顶状态同步（从置顶区来）。-->
        <div class="_down"
            on="click(li>b[role=top])|stopAll evo(2) parent attr('-sid');
                click(li>b[role=untop])|stop evo(2) parent attr('-sid');
                blur(li>label)|evo(2) parent attr('-sid') evo(2) text;
                click(li>label)|stop evo(2) attr('contenteditable') eq('true') end (true);
                edsync|ev('detail') spread slr('li', '-sid', _1) str('/', '>label') $(_1) dup pass pop;
                topsync|ev('detail') spread pick(-2) slr('li', '-sid', _1) str('/', '>b:first-of-type') $(_1) dup pass pop"
            by="Kit.topsh ('untop') dup;
                Kit.untop ('top') dup;
                Kit.shlabel(_1) (false)"
            to="=|@role|pack(2) pop fire('1/._top', 'topsync');
                =|@role|pack(2) pop fire('1/._top', 'topsync');
                =|$contenteditable|pop fire('1/._top', 'edsync');
                =|$contenteditable|target pop fire('1/._top', 'edsync');
                -|$text;
                -|@role">
            <div class="_search"
                on="on|stop evo(3) disable(0) (false);
                    off|stop evo(3) disable (true)"
                to="(/>*)|$disabled;
                    (/>*)|$disabled">
                <input type="text" name="words" placeholder="空格：AND； 逗号：OR" />
                <button type="submit"></button>
            </div>
            <!--搜索结果清单
                label:title 置顶或曾经置顶的条目有效。 -->
            <ol id="sh-list" class="_list" tpb-for="$.list"
                on="update|ev('detail')"
                to="|replace">
                <li _data-sid="$.shid">
                    <label _="($.name || '---')">[片段名称]</label>
                    <code _title="$.code" _="$.code|cut($.$.cmax)">[代码：单击提取导入]</code>
                    <time _="$.time|date('yyyy-MM-dd hh:mm')">[时间戳]</time>
                    <b data-pbo="lost" _data-pbo="$.$.edit ? null : 'lost'" _role="$.top ? 'untop' : 'top'" _title="$.top ? '取消置顶' : '置顶'"><i></i></b>
                    <b data-pbo="lost" _data-pbo="$.$.edit ? null : 'lost'" role="del">删除</b>
                </li>
            </ol>
            <!-- 复用：#nav-tops 绑定的事件处理 -->
            <nav id="nav-misc"
                on="^obted|$$('2/#nav-tops>*') $('2/#nav-tops');
                    ^obted|(true)"
                to="|cloneEvent append(true, true);
                    (/>b)|disable"></nav>
        </div>
    </main>
</form>


<!--执行结果：
    reset  表单重置时手动重置部分内容。
    result 上级递送的执行结果：{type:'value|error', data:String}。
    shsave 脚本历史存储（有值才执行）。
    state  表单初始状态设置：微编辑下内容插入不可用。
-->
<form class="_page _script" tpl-name="script:result"
    on="submit|avoid $('/pre') text value('type where');
        shsave|ev('detail') dup pass;
        reset;
        result|ev('detail') get('code data type') spread;
        state|env('minied') bool"
    by="Ed.insResult(_);
        Kit.shsave"
    to="1/|trigger('cancel');
        -;
        (/pre, ._type)|trigger('reset');
        /pre|trigger(_1)|goto('shsave', _1);
        /fieldset|trigger('disable')">
    <header>
        <h4>脚本执行结果</h4>
        <b class="_close" title="关闭">✕</b>
    </header>
    <main class="_result">
        <!--结果框：
            value 设置正常的结果内容，同时存储备份。
            reset 提取初始存储的源码重置。
            error 错误信息手动连接源码封装。
            obted 代码编辑框友好事件克隆。 -->
        <pre class="_err" data-bak="" contenteditable
            on="reset|evo(3) prop('-bak');
                value|ev('detail') str html dup ('_err');
                error|ev('detail') str html str('<label>错误：</label><i>', '</i>') dup ('_err');
                ^obted|tpl('prop:codes')"
            to="|html;
                |removeClass prop('-bak') html;
                |addClass prop('-bak') html;
                |cloneEvent">
<label>错误：</label><i>this is a error massage.</i>
</pre>
        <!-- 仅部分禁用（tabs保留） -->
        <fieldset
            on="disable|ev('detail') dup $$('/>span') pop disable(_1)"
            to="(input[name=type], select)|$disabled">
            <legend>内容插入</legend>
            <!-- reset 手动切换节点替换。 -->
            <span class="_type"
                on="click(input)|evo(2) val str('where:') node;
                    reset|$('input') click"
                to="1/._where|replace">
                <i>类型：</i>
                <label title="text"><input type="radio" name="type" value="text" checked />文本</label>
                <label title="html"><input type="radio" name="type" value="html" />节点</label>
            </span>
            <span class="_where" tpl-name="where:text">
                <i>位置：</i>
                <!-- 友好：空值可用于简单关闭对话框 -->
                <select name="where">
                    <option value=""> ------ </option>
                    <option title="内部填充">fill</option>
                    <option title="内部末尾">append</option>
                    <option title="内部前端">prepend</option>
                </select>
            </span>
            <span class="_where" tpl-name="where:html"
                on="^obted|evo(3) delay remove">
                <i>位置：</i>
                <select name="where">
                    <option value=""> ------ </option>
                    <option title="内部填充">fill</option>
                    <option title="替换目标">replace</option>
                    <option title="内部末尾">append</option>
                    <option title="内部前端">prepend</option>
                    <option title="目标之前">before</option>
                    <option title="目标之后">after</option>
                </select>
                <em class="_tips">提示：注意源码结构的合法性！</em>
            </span>
            <label title="编辑时用">制表符
                <input type="text" name="tabs" class="_char" value="4" title="空格数">
            </label>
        </fieldset>
    </main>
    <hr tpl-node="modal:okreset" />
</form>
