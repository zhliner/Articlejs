/*! Coolj/Tpb@tQuery v0.2.0 | (c) zhliner@gmail.com 2021.10.27 |  */
import e,{OBTA as t,TplsPool as n,TplrName as r,tplMaps as o,DEBUG as l}from"./tpb/config.js";import{processProxy as i,processExtend as s,customGetter as a,Tpb as u,obtBuilder as c}from"./tpb/tpb.esm.js";import{HotKey as f,ObjKey as d}from"./tpb/tools/hotkey.js";import{Scripter as p,By as h,Sys as m,Limit as g,On as _,ROOT as w,Local as v,Cmdx as y,Tips as b,Fx as x,Help as E}from"../config.js";import T from"./shortcuts.js";import{Render as C}from"./tpb/tools/render.js";import{Spliter as N,UmpCaller as S,UmpString as $,UmpChars as A}from"./tpb/tools/spliter.js";import{MdLine as k}from"./hlparse/languages/mdline.js";import{Hicolor as O}from"./hlparse/main.js";import{Util as R}from"./tpb/tools/util.js";import{Templater as I}from"./tpb/tools/templater.js";import{Loader as L,TplLoader as z}from"./tpb/tools/tloader.js";
//! $ID: types.js 2020.05.09 Cooljed.Libs $
const U=1,D=2,H=3,M=6,F=8,j=100,P=101,B=102,K=103,V=104,W=105,G=106,X=200,q=201,J=202,Y=203,Q=204,Z=205,ee=206,te=207,ne=208,re=209,oe=210,le=211,ie=212,se=213,ae=214,ue=215,ce=216,fe=217,de=218,pe=219,he=220,me=221,ge=300,_e=301,we=302,ve=303,ye=304,be=400,xe=401,Ee=402,Te=403,Ce=404,Ne=405,Se=406,$e=407,Ae=408,ke=409,Oe=410,Re=411,Ie=412,Le=413,ze=414,Ue=418,De=419,He=420,Me=421,Fe=422,je=423,Pe=501,Be=502,Ke=503,Ve=504,We=505,Ge=506,Xe=510,qe=511,Je=513,Ye=514,Qe=515,Ze=516,et=517,tt=518,nt=519,rt=520,ot=523,lt=524,it=525,st=527,at=-1,ut=-2,ct={0:0,[U]:18,[D]:18,[H]:18,4:18,5:530,[M]:528,7:528,[F]:144,9:400,10:400,107:6,[j]:390,[P]:390,[B]:390,[K]:134,[G]:14,104:3082,[W]:3842,[X]:24,[q]:24,[J]:24,[Y]:24,[Q]:24,[Z]:24,[ee]:24,[te]:24,[ne]:24,[re]:24,[oe]:24,[le]:24,[ie]:24,[se]:24,[ae]:24,[ue]:24,[ce]:24,[fe]:24,[de]:24,[pe]:24,[he]:24,[me]:24,[ge]:40,[_e]:40,[we]:40,[ye]:40,[ve]:40,[be]:1098,[xe]:1098,[Ee]:14,[Te]:1098,[Ce]:3146,[Ne]:14,[Se]:1098,[$e]:78,[Ae]:1102,[ke]:14,[Oe]:14,[Re]:14,[Ie]:10,[Le]:10,[ze]:6,416:2,415:70,417:70,[Ue]:518,[De]:14,[He]:3146,[Me]:518,[Fe]:518,[je]:518,424:3586,425:6,500:1122,[Ge]:1122,507:1634,509:34,508:34,[Xe]:1122,[qe]:2146,512:98,[Pe]:34,[Be]:34,[Ke]:34,[Ve]:34,[We]:34,[Je]:34,[Ye]:34,[Qe]:34,[Ze]:34,[et]:34,[tt]:34,[nt]:34,[rt]:34,521:34,522:34,[ot]:34,[lt]:34,[it]:34,526:34,[st]:160,528:544,[at]:13,[ut]:13},ft=[q,J,Z,ee,te,ne,5,re,oe,le,ie,se,ae,ue,ce,fe,de,me],dt=[Y,Q,pe,he],pt=[9,10,7],ht=[...[U,D,H,4,M,F],...ft,...dt,...pt],mt=[...ft,...dt,...pt],gt=[...dt,...pt],_t=[ot,lt,Ye,Qe],wt=[ge,_e,we,ve,Ye,Qe,Ze,et,tt,nt,rt,521,522,ot,lt,it,526,528],vt={0:null,[U]:[0,P,j],[D]:[0,P,j],[H]:[B,K],4:[107],5:[0,104,W],[M]:[0],7:null,[F]:null,9:null,10:null,107:[107],[j]:null,[P]:null,[B]:null,[K]:null,104:[0],[W]:[0],[G]:[0,X,...mt],[X]:[0,...ht],[q]:[0,X,...ht,4,F],[J]:[0,...dt],[Y]:[0,X,...ft,...pt],[Q]:[0,X,...ft,...pt],[Z]:[0,J,...gt],[ee]:[0,...ft,...dt],[te]:[0,...dt],[ne]:[0,at,ut],[re]:[0,...gt],[oe]:[0,...gt],[le]:[0,...gt],[ie]:[0,...gt],[se]:[0,...gt],[ae]:[0,...gt],[ue]:[0,...mt],[ce]:[0],[fe]:[0,...dt],[de]:[0,...dt],[pe]:[0,...mt],[he]:[0,...mt],[me]:[0,...dt],[ge]:[0,X,...ht],[_e]:[0,X,...ht],[we]:[0,X,...ht],[ve]:[0,X,...mt],[ye]:[0,X,...ht],[be]:[0,X,...mt,4,F,ut],[xe]:[0,X,...mt,4,F,ut],[Ee]:[0,X,...mt,4,F,ut],[Te]:[0,X,...mt,4,F,ut],[Ce]:[0,X,...mt,4,F,ut],[Ne]:[0,X,...mt,4,F,ut],[Se]:[0,X,...mt],[$e]:[0,X,...mt],[Ae]:[0,X,...mt],[Oe]:[0,X,...mt,4,F,ut],[ke]:[0,X,...ht],[Re]:[0,X,...ht],[Ie]:[0,X,...ht],[Le]:[0,X,...ht],[ze]:[Ie,Le],415:[ze],416:[ze],417:[ze],[Ue]:[ne],[De]:[X],[He]:[X],[Me]:[Te,Ye],[Fe]:[Te,Qe],[je]:[He,Qe],424:[De,je],425:[F,4,G],500:[be,Ee],[Ge]:[Te,ge,..._t],507:[Te,424],508:[Te,Qe],509:[Te,Ye],[Xe]:[Te,ge,we,_e,..._t,et,tt],[qe]:[Te,ge,we,_e,..._t,ye],[Ye]:[ke,De],[Qe]:[ke,De],[Ze]:[Ue],[et]:[ke,De,Me,Fe],[tt]:[ke,De,Me,Fe],[nt]:[ke,De,Fe,je],[rt]:[Oe,Re],521:[Ae,415,416,417],522:[$e,425],[ot]:[Te,ge,..._t,521],[lt]:[Te,ge,..._t,521],[it]:[Se,ge,..._t,521],526:[ne],[st]:null,528:null,[at]:[0],[ut]:[0,X],[-10]:[be,500,Ge,507,512,508,509,qe]};e.each(vt,((e,t,n)=>n[t]=e&&new Set(e)));const yt={512:[Xe,qe,st,Pe],[Pe]:[xe,Xe,qe,st,Be],[Be]:[xe,Xe,qe,st,Ke],[Ke]:[xe,Xe,qe,st,Ve],[Ve]:[xe,Xe,qe,st,We],[We]:[xe,Xe,qe,st,Je],[Je]:[xe,Xe,qe,st,Je]};function bt(e){return!!(128&ct[e])}function xt(e){return!!(64&ct[e])}function Et(e){return!!(256&ct[e])}function Tt(e){return!!(1024&ct[e])}function Ct(e){return!!(2048&ct[e])}function Nt(e){return!!(1024&ct[e]&&2048&ct[e])}function St(e){return!!(512&ct[e])}function $t(e){return!!(32&ct[e])}function At(e){return!!(16&ct[e])}function kt(e){return!!(8&ct[e])}function Ot(e){return!!(4&ct[e])}function Rt(e){return!!(1&ct[e])}function It(e){let t=vt[e];return!!t&&1===t.size&&t.has(0)}function Lt(t){let n=e.not(e.children(t),"h2,header,footer,hr"),r=e.filter(n,"section");return n.length?r.length?n.length===r.length?2:3:1:0}function zt(e,t){switch(Lt(e)){case 1:return t.slice(0,-1).concat(wt);case 2:return t}return t.concat(wt)}var Ut=Object.freeze({__proto__:null,$TEXT:0,AUDIO:U,VIDEO:D,PICTURE:H,SVG:4,RUBY:5,METER:M,SPACE:7,IMG:F,BR:9,WBR:10,TRACK:j,SOURCE1:P,SOURCE2:B,PIMG:K,RT:104,RP:W,EXPLAIN:G,SVGITEM:107,A:X,Q:q,ABBR:J,DEL:Y,INS:Q,DFN:Z,BDO:ee,TIME:te,CODE:ne,STRONG:re,EM:oe,CITE:le,SMALL:ie,SUB:se,SUP:ae,MARK:ue,ORZ:ce,SAMP:fe,KBD:de,S:pe,U:he,VAR:me,P:ge,NOTE:_e,TIPS:we,PRE:ve,ADDRESS:ye,H1:be,H2:xe,H3:Ee,H4:Te,H5:Ce,H6:Ne,SUMMARY:Se,FIGCAPTION:$e,CAPTION:Ae,LI:ke,DT:Oe,DD:Re,TH:Ie,TD:Le,TR:ze,THEAD:415,TBODY:416,TFOOT:417,CODELI:Ue,ALI:De,AH5:He,XH5LI:Me,XOLH5LI:Fe,XOLAH5LI:je,TOCCASCADE:424,FIGIMGBOX:425,HGROUP:500,S1:Pe,S2:Be,S3:Ke,S4:Ve,S5:We,ABSTRACT:Ge,TOC:507,REFERENCE:508,SEEALSO:509,HEADER:Xe,FOOTER:qe,ARTICLE:512,SECTION:Je,UL:Ye,OL:Qe,CODELIST:Ze,ULX:et,OLX:tt,CASCADE:nt,DL:rt,TABLE:521,FIGURE:522,BLOCKQUOTE:ot,ASIDE:lt,DETAILS:it,CODEBLOCK:526,HR:st,BLANK:528,B:at,I:ut,MAIN:-10,ChildTypes:vt,ChildTypesX:yt,isEmpty:bt,isSingle:xt,isCovert:Et,isFixed1:Tt,isFixed2:Ct,isFixed:Nt,isFixedAny:function(e){return!!(1024&ct[e]||2048&ct[e])},isSealed:St,isBlocks:$t,isInlines:At,isContent:kt,isStruct:function(e){return!!(2&ct[e])},isStructX:Ot,isSpecial:Rt,onlyText:It,sectionState:Lt,sectionSubs:zt});
//! $ID: base.js 2020.05.10 Cooljed.Libs $
const Dt=Symbol("type-value"),Ht=new WeakMap,Mt=new Set(["abstract","toc","seealso","reference","s1","s2","s3","s4","s5","codelist","ulx","olx","cascade","codeblock","note","tips","blank","orz","space","explain"]),Ft=new Set([415,417,be,Se,Ge,507,424,508,512,G,K]),jt={LI(t){let n=t.firstElementChild;return t.childElementCount<=1?function(t,n){if(!t||e.siblingNodes(t).length)return;if("A"===t.tagName)return De;return"CODE"===t.tagName&&"OL"===n.tagName&&en(n)===Ze&&Ue}(n,t.parentElement)||ke:2===t.childElementCount&&"H5"===n.tagName?Qt(n):ke},H5:e=>Zt(e,"A")?He:Ce,SPAN:e=>"FIGURE"===e.parentElement.tagName?425:e.hasAttribute("space")&&!e.childNodes.length?7:null,IMG:e=>"PICTURE"===e.parentElement.tagName?K:F,SOURCE:e=>"PICTURE"===e.parentElement.tagName?B:P},Pt={LI:[{type:Ue,check:e=>Zt(e,"CODE")},{type:De,check:e=>Zt(e,"A")},{type:je,check:function(e){let t=e.firstElementChild;return 2===e.childElementCount&&"H5"===t.tagName&&Qt(t)===je}},{type:Fe,check:function(e){let t=e.firstElementChild;return 2===e.childElementCount&&"H5"===t.tagName&&Qt(t)===Fe}},{type:Me,check:function(e){let t=e.firstElementChild;return 2===e.childElementCount&&"H5"===t.tagName&&Qt(t)===Me}},{type:ke,check:()=>!0}],SPAN:[{type:7,check:e=>0===e.childNodes.length},{type:425,check:()=>!0}],IMG:[{type:K,check:()=>!0},{type:F,check:()=>!0}]},Bt=Symbol("normal-list"),Kt=Symbol("small-block"),Vt=Symbol("blockcode-item"),Wt={[Xe]:Kt,[qe]:Kt,[ot]:Kt,[lt]:Kt,[it]:Kt,[Ue]:Vt,526:Vt,[Ye]:Bt,[Qe]:Bt,[et]:Bt,[tt]:Bt,[nt]:Bt};function Gt(e){if(3===e.nodeType)return 0;if("http://www.w3.org/2000/svg"===e.namespaceURI)return"svg"===e.tagName?4:107;let t=jt[e.tagName];return t?t(e):function(e){let t=+Ut[e];return isNaN(t)?null:t}(function(e){let t=e.getAttribute("role");return(Mt.has(t)?t:e.tagName).toUpperCase()}(e))}function Xt(e,t){if(e===t)return null;let n=en(e);return At(n)?Xt(e.parentElement):kt(n)?e:qt(e,t)}function qt(e,t){return e===t?null:function(e){let t=en(e);return $t(t)||At(t)}(e)?e:qt(e.parentElement)}function Jt(t,n){return 3===t.nodeType||e.find("*",t,!0).every((e=>n.has(en(e))))}function Yt(t){return 3==t.nodeType?null:un(t)?t:e.children(t).map((e=>Yt(e))).flat()}function Qt(e){switch(e.nextElementSibling.tagName){case"UL":return Me;case"OL":return Zt(e,"A")?je:Fe}return ke}function Zt(t,n){let r=t.firstElementChild;return 1===t.childElementCount&&!e.siblingNodes(r).length&&r.tagName===n}function en(e){if(3===e.nodeType)return 0;if(11===e.nodeType)return null;let t=e[Dt];return void 0===t&&tn(e,t=Gt(e)),t}function tn(e,t){return Reflect.defineProperty(e,Dt,{value:t,enumerable:!1,configurable:!0}),e}function nn(e,t){let n=rn(e);return!!n&&n.has(t)}function rn(e){if("number"==typeof e)return vt[e];let t=en(e),n=yt[t];return n?new Set(zt(e,n)):vt[t]||""}function on(t){let n=e.clone(t,!0,!0,!0),r=e.find("*",t);return e.find("*",n).forEach(((e,t)=>tn(e,en(r[t])))),tn(n,en(t))}function ln(t){return an(t)?[t]:e.contents(t).map((e=>1===e.nodeType?ln(e):e)).flat()}function sn(e){return Et(en(e))}function an(e){return At(en(e))}function un(e){return kt(en(e))||0===e.childElementCount&&e.innerText&&e.innerText.trim()}function cn(e){return Tt(en(e))}function fn(e){return Ct(en(e))}function dn(e){return Nt(en(e))}function pn(e){let t=en(e);return t>=Pe&&t<=We}function hn(e){return Ft.has(en(e))}function mn(t,n){return n?Ht.set(t,n)&&null:(n=Ht.get(t)||Ht.set(t,new e.Table(t)).get(t)).checkCols()}function gn(t){let n=Yt(t);return n?e.isArray(n)?n:[n]:[]}function _n(e,t){return an(e)?Xt(e.parentElement,t):qt(e.parentElement,t)}function wn(t){let n=e.attr(t,"role");return n?+n.substring(1):t.parentElement?e.parentsUntil(t,"section[role=s5]").length+6:6}function vn(t,n){let r=(n+=wn(t))<6?`s${n}`:null;if(0===n)return!1;Reflect.deleteProperty(e.attr(t,"role",r),Dt)}function yn(e,t){let n=Wt[en(e)];if(void 0===n)return function(e,t){let n=en(e);for(const e of t)if(n!==en(e))return e;return null}(e,t);for(const e of t)if(n!==Wt[en(e)])return e;return null}function bn(e,t){let n=Pt[e.tagName];return n?n.some((n=>function(e,t,n){return t.has(n.type)&&n.check(e)&&!!tn(e,n.type)}(e,t,n))):t.has(en(e))}
//! $ID: common.js 2019.09.07 Cooljed.Libs $
const xn=new N(";",new S,new $),En=new k;class Tn extends Set{constructor(e){super(),this._cls=e,this._n2=null,this._p2=null}add(t){return super.add(e.addClass(t,this._cls)),t}delete(t){return super.delete(e.removeClass(t,this._cls)),t===this._n2&&(this._n2=null),t===this._p2&&(this._p2=null),t}clear(){return this.removes(this)}first(){for(const e of this)return e}next(e){let t=[...this],n=this._next(t,e),r=this._n2;return this._n2=this._next(t,n||r||t[0]),n||r||t[0]}prev(e){let t=[...this],n=this._prev(t,e),r=this._p2;return this._p2=this._prev(t,n||r||t[t.length-1]),n||r||t[t.length-1]}pushes(e){return e.forEach((e=>this.add(e))),this}removes(e){return e.forEach((e=>this.delete(e))),this}_next(e,t){let n=e.indexOf(t);return n<0?null:e[n+1]}_prev(e,t){let n=e.indexOf(t);return n<0?null:e[n-1]}}class Cn extends Map{add(e,t){super.set(t,e)}top(){let e;for(e of this);return e?e[1]:null}}class Nn{constructor(e=""){this._fix=e}get(e){return window.localStorage.getItem(this._fix+e)}set(e,t){return window.localStorage.setItem(this._fix+e,t),this}del(e){window.localStorage.removeItem(this._fix+e)}has(e){return!!window.localStorage.getItem(this._fix+e)}clear(){window.localStorage.clear()}keys(){let e=Object.keys(window.localStorage),t=this._fix.length;return e.filter((e=>e.startsWith(this._fix))).map((e=>e.substring(t)))}}class Sn{constructor(e,t){this._max=e,this._buf=[],this._idx=-1,this._hist=t}push(...e){if(!e.length)return;return this._buf.length=++this._idx,this._buf.push(e)-this._max>0&&this._shift()}pop(){let e=this._buf.pop();this._idx--,e.slice().reverse().forEach((e=>e.undo()))}undo(){if(this._idx<0)return Rn("[undo] overflow.");let e=this._buf[this._idx];this._confirm(e)&&(this._idx--,e.slice().reverse().forEach((e=>e.undo())))}redo(){if(this._idx>=this._buf.length-1)return Rn("[redo] overflow.");this._buf[++this._idx].forEach((e=>e.redo()))}clear(){this._buf.length=0,this._idx=-1,this._hist.clear()}canUndo(){return this._idx>=0}canRedo(){return this._idx<this._buf.length-1}_confirm(e){let t=!0;for(const n of e)if(n.warn&&(t=window.confirm(n.warn()),!t))break;return t}_shift(){let e=this._buf.shift();this._idx--,e.forEach((e=>e.count&&this._hist.prune(e.count)))}}class $n{constructor(e,t){this._data=e,this._size=t,this._idx=0}next(){let e=this.pages()-1;return this._idx<e?this.page(this._idx+1):null}prev(){return this._idx>0?this.page(this._idx-1):null}first(){return this.page(0)}last(){return this.page(this.pages()-1)}page(e){let t=e*this._size;return this._idx=e,this._data.slice(t,t+this._size)}index(e){if(void 0===e)return this._idx;this._idx=e}reset(e){return this._idx=0,this._data=e,this}pages(){return Math.ceil(this._data.length/this._size)}}class An{constructor(e){this._tpl=e,this._pool=[]}page(e,t){return this._pool[e]||this._render(e,this._clone(this._tpl),t)}reset(){return this._pool.length=0,this}_render(e,t,n){return this._pool[e]=C.update(t,n)}_clone(t){return C.clone(t,e.clone(t,!0,!0,!0))}}class kn extends Set{constructor(e){super(),this._make=e}pick(...e){return this._pick()||this._make(...e)}_pick(){let e;for(e of this)break;return void 0!==e&&this.delete(e),e}}const On=new kn(p);function Rn(e,t){window.console.warn(e,t||"")}function In(t,n,r){let o=t.tagName.toLowerCase(),l=`<${o}${function(e,t,n){let r="",o=new Map([["on"],["by"],["to"]]);for(let t=0;t<e.length;t++){let n=e[t];o.has(n.name)?o.set(n.name,n.value):r+=` ${n.name}`+(""===n.value?"":`="${Ln(n.value)}"`)}return r+function(e,t,n){let r=[];n=`${n}${t}`;for(const[o,l]of e)l&&r.push(`${o}="${zn(l,t,n)}"`);return r.length?`\n${n}`+r.join(`\n${n}`):""}(o,t,n)}(t.attributes,n,r)}`,i="";if(function(e){return bt(en(e))}(t))return l+" />";l+=">";for(const e of t.childNodes)i+=Fn(e,n,r+n);return l+i+function(t,n){return 3===t.nodeType||an(t)||un(t)||function(t){let n=e.contents(t,-1,!1,!0);return 3===n.nodeType||an(n)}(t)?"":"\n"+n}(t,r)+`</${o}>`}function Ln(e){return e.replace(/"/g,"&quot;")}function zn(e,t,n){return xn.reset(),[...xn.split(e)].map((e=>Ln(e.trim()))).join(`;\n${n}${t}`)}function Un(e){let t=On.pick();return new Promise((n=>{t.onmessage=e=>{if(t.onmessage=null,On.add(t),e.data.error)throw e.data.error;n(e.data.result)},t.postMessage(`return ${e}`)}))}function Dn(t,n=1){let r=e.prevNodes(t,!1,!0),o=0;for(;o<r.length;o++){let e=r[o];if(--n<0||cn(e))break}return r[o-1]||null}function Hn(t,n=1){let r=e.nextNodes(t,!1,!0),o=0;for(;o<r.length;o++){let e=r[o];if(--n<0||fn(e))break}return r[o-1]||null}function Mn(t,n){let r=n.parentNode,o=n.previousSibling;return e.replace(t,n),o?e.after(o,t):e.prepend(r,t)}function Fn(t,n,r=""){let o=t.nodeType,l=(s=r,3===(i=t).nodeType||1===i.nodeType&&an(i)?"":"\n"+s);var i,s;return 1===o?l+(function(t){let n=t.nodeName;return"CODE"==n||"PRE"==n?e.prop(t,"outerHTML"):""}(t)||In(t,n,r)):3===o?t.textContent.trim()&&e.html(function(e){let t=e.textContent.replace(/\s\s+/g," ");return e.nextSibling||(t=t.trimEnd()),e.previousSibling||(t=t.trimStart()),t}(t)):8===o?l+`\x3c!--${t.data}--\x3e`:t.outerHTML||t+""}function jn(e){return En.parse(e).map((e=>{return t=e.type,n=e.text,t?`<${t}>${n}</${t}>`:n;var t,n})).join("")}function Pn(t){let n=[];for(const e of t.childNodes){let t=e.nodeType;1===t?n.push(Pn(e)):3!==t&&8!==t||n.push(e)}return n.length&&e.fill(t,n),function(e){let t=en(e);return At(t)||"CODE"===e.parentElement.tagName&&Rt(t)}(t)?t:t.textContent}
//! $ID: coding.js 2020.02.07 Cooljed.Libs $
const Bn=new Set("ೠൕ൘൙൚൛൜൝൞ൟൠ൧൨൩൪൫൬൭൮൯൰൱൲൳൴൵൶൷൸൹ൺൻർൽൾൿᳩᳪᳫ⁇※‱℃".split(""));function Kn(e){let t=e.indexOf("\t");return t<0?[e]:[e.substring(0,t),e.substring(t+1)||!0]}function Vn(e,t,n){let r=e.innerText||e.textContent,o=r.lastIndexOf(n,t-1);return o<0?[r.substring(0,t)]:[r.substring(o+1,t),!0]}function Wn(e,t,n){let r=e.innerText||e.textContent,o=r.indexOf(n,t);return o<0?[r]:[r.substring(t,o),!0]}function Gn(e,t,n){let r=[];for(;e;){let[o,l]=Vn(e,t,n);if(r.push(o),t=1/0,l)break;e=e.previousSibling}return[r.reverse().join(""),!!e]}function Xn(e,t,n){let r=[];for(;e;){let[o,l]=Wn(e,t,n);if(r.push(o),t=0,l)break;e=e.nextSibling}return[r.join(""),!!e]}function qn(e,t){let n=0;for(;n<t&&/[ \t]/.test(e[n]);n++);return n}function Jn(e){let t=0;for(const n of e)t+="\t"!==n?n.codePointAt(0)>=8527||Bn.has(n)?2:1:8-t%8;return t}function Yn(t,n,r){let o=t.startContainer,l=t.startOffset;return o===r&&(o=e.contents(o,l)),n?Gn(o,l,"\n")[0]:!1===n?Xn(o,l,"\n")[0]:Gn(o,l,"\n")[0]+Xn(o,l,"\n")[0]}function Qn(t,n,r){return r>0&&(t=t.map((e=>function(e,t=4){let n=[],r="",o=e;for(;o;)[r,o]=Kn(o),o&&(r+=" ".repeat(t-Jn(r)%t),!0===o&&(o=null)),n.push(r);return n.join("")}(e,r)))),t=t.join("\n"),n?new O(t,n).effect():[{text:e.html(t)}]}
//! $ID: create.js 2019.09.07 Cooljed.Libs $
const Zn={[U]:"audio",[D]:"video",[H]:"picture",4:"svg",5:"ruby",[M]:"meter",7:"span\\space",[F]:"img",[K]:"img",9:"br",10:"wbr",107:null,[j]:"track",[P]:"source",[B]:"source",[G]:"i\\explain",104:"rt",[W]:"rp",[X]:"a",[re]:"strong",[oe]:"em",[q]:"q",[J]:"abbr",[le]:"cite",[te]:"time",[ie]:"small",[Y]:"del",[Q]:"ins",[se]:"sub",[ae]:"sup",[ue]:"mark",[ne]:"code",[ce]:"code\\orz",[Z]:"dfn",[fe]:"samp",[de]:"kbd",[pe]:"s",[he]:"u",[me]:"var",[ee]:"bdo",[ge]:"p",[_e]:"p\\note",[we]:"p\\tips",[ye]:"address",[ve]:"pre",[be]:"h1",[xe]:"h2",[Ee]:"h3",[Te]:"h4",[Ce]:"h5",[Ne]:"h6",[Se]:"summary",[$e]:"figcaption",[Ae]:"caption",[ke]:"li",[Oe]:"dt",[Re]:"dd",[ze]:"tr",[Ie]:"th",[Le]:"td",416:"tbody",415:"thead",417:"tfoot",[Ue]:"li",[De]:"li",[He]:"h5",[Me]:"li",[Fe]:"li",[je]:"li",424:"ol\\cascade",425:"span",500:"hgroup",[Ge]:"header\\abstract",507:"nav\\toc",508:"nav\\reference",509:"aside\\seealso",[Xe]:"header",[qe]:"footer",512:"article",[Pe]:"section\\s1",[Be]:"section\\s2",[Ke]:"section\\s3",[Ve]:"section\\s4",[We]:"section\\s5",[Je]:"section",[Ye]:"ul",[Qe]:"ol",[Ze]:"ol\\codelist",[et]:"ul\\ulx",[tt]:"ol\\olx",[nt]:"ol\\cascade",[rt]:"dl",521:"table",522:"figure",[ot]:"blockquote",[lt]:"aside",[it]:"details",526:"pre\\codeblock",[st]:"hr",528:"div\\blank",[at]:"b",[ut]:"i"},er={[U]:function(){return e.elem("audio","Sorry, your browser doesn't support embedded audios.")},[D]:function(){return e.elem("video","Sorry, your browser doesn't support embedded videos.")},4:function(){return e.svg()},107:function(){return e.fragment("","svg")}},tr={4:function(e,t,n,r){return Er(null,_r(e,t,r),!0)},107:function(e,t,n,r){return Er(null,_r(e,t,r),!0)},5:function(t,n,{rt:r,rpl:o,rpr:l},i){return e.append(n,function(t,n,r,o){let l=[e.Text(o)];n&&l.push(Cr(W,t||m.rpLeft),Cr(V,n),Cr(W,r||m.rpRight));return l}(o,r,l,function(t){if(e.isArray(t))return t.map((e=>e.textContent)).join("");return t.nodeType?t.textContent:t+""}(i))),Er(null,n,!0)},[ne]:function(t,n,r,o){return o&&(o="string"==typeof o?e.fragment(o,!1):function(t){let n=rn(ne);return e.isArray(t)?t.every((e=>Jt(e,n))):Jt(t,n)}(o)&&o,e.append(n,o)),Er(null,n,!0)},[ze]:function(t,n,{tsec:r},o){let l=e(n.cells);return 0===l.length&&(l=e(function(t,n){let r=mn((n=n||t.parentElement).parentElement);return e.append(t,r.newTR("THEAD"===n.tagName).children)}(n,r))),o&&o.nodeType?(l.append(gn(o).map((t=>e.contents(t)))),Er(null,l,!0)):Er(null,l)},416:function(e,t,n,r){let{th0:o,head:l,foot:i}=n,s=mn(t.parentElement||n.table),[a,u]=dr(e,s,t,r);return o&&s.rows()>0&&s.insertColumn(s.newColumn(!0),0),l&&function(e,t,n){ar(e,ur(e,t,!0),n)}(s,l,s.head()),i&&function(e,t,n){ar(e,ur(e,t),n)}(s,i,s.foot()),vr(n,"th0","head","foot"),Er(null,a,u)},415:function(e,t,n,r){let[o,l]=dr(e,mn(t.parentElement||n.table),t,r,!0);return Er(null,o,l)},417:function(e,t,n,r){let[o,l]=dr(e,mn(t.parentElement||n.table),t,r);return Er(null,o,l)},[Me]:function(t,n,{h5:r},o){if(!o)return Er(null,o,!0);let l=e.empty(n),[i,s]=cr(t,n,o,(()=>Cr(Ye)));return Er(ir(n,Ce,r||l),i,s)},[Fe]:function(t,n,{h5:r},o){let l=e.empty(n),[i,s]=cr(t,n,o,(()=>Cr(Qe)));return Er(ir(n,Ce,r||l),i,s)},[je]:function(e,t,{h5a:n},r){let[o,l]=cr(e,t,r,(()=>Cr(Qe)));return Er(n&&ir(t,He,n),o,l)},424:function(t,n,r,o){let l=e.children(o,"section");return Er(null,e.append(n,mr(l)),!0)},425:function(t,n,{explain:r},o){let[l,i]=cr(t,n,o,(()=>Cr(F)));return"string"==typeof r&&(r=function(t,n){let r=n;e.isArray(n)||(r=[n]);if(r.some((e=>!nn(t,en(e)))))return null;return e.append(t,n)}(n,$r(G,null,r))),Er(r,l,i)},500:function(e,t,n,r){let{h1:o}=n,[l,i]=cr(e,t,r,(()=>Cr(Ee)));return vr(n,"h1"),Er(o&&ir(t,be,o),l,i)},507:function(e,t,{h4:n},r){let[o,l]=cr(e,t,r,(()=>Cr(424)));return Er(n&&ir(t,Te,n),o,l)},508:function(e,t,{h4:n},r){let[o,l]=cr(e,t,r,(()=>Cr(Qe)));return Er(n&&ir(t,Te,n),o,l)},509:function(e,t,{h4:n},r){let[o,l]=cr(e,t,r,(()=>Cr(Ye)));return Er(n&&ir(t,Te,n),o,l)},512:function(e,t,n,r){let{header:o}=n,[l]=cr(e,t,r,hr(e,t,r));return vr(n,"header"),Er(o&&sr(t,o),l,!0)},[Ze]:function(e,t,n,r){let[o,l]=cr(e,t,r,(()=>Cr(Ue)));return Er(null,o,l)},526:function(e,t,n,r){let[o,l]=cr(e,t,r,(()=>Cr(ne)));return Er(null,o,l)},[rt]:function(e,t,n,r){let{dt:o}=n,[l,i]=cr(e,t,r,(()=>Cr(Re)));return vr(n,"dt"),Er(o&&fr(l||e,t,Cr(Oe,o)),l,i)},521:function(e,t,n,r){let o,l=mn(t),i=[];return function(e,t,n){if(!t)return e.caption(null);n.push(e.caption(t))}(l,n.caption,i),function(e,t){null===t&&e.head(null);t&&e.head(!0)}(l,n.head),function(e,t){null===t&&e.foot(null);t&&e.foot(!0)}(l,n.foot),r&&"TBODY"===r.tagName&&(o=l.bodies(0,r)),vr(n,"caption"),Er(i,o||l.body(!0),!!o)},522:function(e,t,n,r){let{figcaption:o}=n,[l,i]=cr(e,t,r,(()=>Cr(425)));return vr(n,"figcaption"),Er(o&&ir(t,$e,o),l,i)},[it]:function(e,t,n,r){let{summary:o}=n,[l,i]=cr(e,t,r,(()=>Cr(ge)));return vr(n,"summary"),Er(o&&ir(t,Se,o),l,i)}};[U,D,H].forEach((function(t){tr[t]=function(t,n,r,o){return nn(n,o&&en(o))&&e.append(n,o),Er(null,n,!0)}})),[[Ue,ne],[De,X],[He,X]].forEach((function(e){tr[e[0]]=function(t,n,r,o){if(n.childElementCount>0)return Er(null,n.firstElementChild);let[l,i]=cr(null,n,o,(()=>Cr(e[1])));return Er(null,l,i)}})),[Ge,Xe,qe,ot,lt].forEach((function(e){tr[e]=function(e,t,n,r){let{h4:o}=n,[l,i]=cr(e,t,r,(()=>Cr(ge)));return vr(n,"h4"),Er(o&&ir(t,Te,o),l,i)}})),[Ye,Qe,et,tt,nt].forEach((function(e){tr[e]=function(e,t,n,r){let[o,l]=cr(e,t,r,(()=>Cr(ke)));return Er(null,o,l)}})),[Pe,Be,Ke,Ve,We,Je].forEach((function(e){tr[e]=function(e,t,n,r){let{h2:o,header:l}=n,i=[o&&ir(t,xe,o),l&&sr(t,l)],[s]=cr(e,t,r,hr(e,t,r));return vr(n,"h2","header"),Er(i.filter((e=>e)),s,!0)}})),[M,G,X,q,J,Y,Q,Z,ee,te,re,oe,le,ie,se,ae,ue,ce,fe,de,pe,he,me,at,ut,ge,_e,we,ve,ye,be,xe,Ee,Te,Ce,Ne,Se,$e,Ae,ke,Oe,Re,Ie,Le].forEach((function(t){tr[t]=function(t,n,r,o){return o=e.isArray(o)?e.map(o,(e=>wr(n,e))).flat():wr(n,o),fr(t,n,o),Er(null,o,!0)}}));const nr={4:function(t,n){return e.attribute(t,n)},[te]:function(t,{date:n,time:r}){return e.attr(t,"datetime",gr(n,r))},[Y]:function(t,{date:n,time:r,cite:o}){return e.attribute(t,"datetime cite",[gr(n,r),o||null])},[Q]:function(t,{date:n,time:r,cite:o}){return e.attribute(t,"datetime cite",[gr(n,r),o||null])},7:function(t,{width:n}){return n&&e.css(t,"width",n),t},[st]:function(t,{role:n,thick:r,length:o,space:l}){return n&&e.attr(t,"role",n),e.cssSets(t,"borderWidth width height",[r,o,l])},521:function(t,{cols:n,border:r}){let o=new e.Table(t,n);return r&&e.attr(t,"border",r),mn(t,o)||t}};[[U,["src","autoplay","loop","controls"]],[D,["src","autoplay","loop","controls","poster","width","height"]],[F,["src","alt","width","height"]],[K,["src","alt","width","height"]],[P,["src","type"]],[B,["srcset","media"]],[j,["kind","src","srclang","label","default"]],[M,["value","max","min","high","low","optimum"]],[ke,["value"]],[Ue,["value"]],[De,["value"]],[Me,["value"]],[Fe,["value"]],[je,["value"]],[ot,["cite"]],[it,["open"]],[X,["href","target","title"]],[q,["cite"]],[J,["title"]],[Z,["title"]],[ee,["dir"]],[Ze,["lang:-lang","start"]],[ne,["lang:-lang"]],[G,["fix:-pba"]]].forEach((function(t){nr[t[0]]=(n,r)=>e.attribute(n,function(e,t){let n={};for(const r of t){let[t,o]=r.split(":");void 0!==e[t]&&(n[o||t]=e[t])}return n}(r,t[1]))}));const rr={[q]:function(t,n={}){return n.cite=e.attr(t,"cite"),[n,e.Text(t)]},[J]:yr,[Y]:br,[Q]:br,[Z]:yr,[ee]:function(t,n={}){return n.dir=e.attr(t,"dir"),[n,e.Text(t)]},[te]:br};[X,ne,re,oe,le,ie,se,ae,ue,ce,fe,de,pe,he,me].forEach((function(t){rr[t]=(t,n)=>[n||{},e.Text(t)]}));const or={[ot]:xr,[lt]:xr,[it]:function(t,n={}){let r=e.get("summary",t),o=e.children(t);return r&&(n.h4=r.textContent,o.splice(o.indexOf(r),1)),n.open=!0,[n,o.map(on)]}};[Ye,Qe,et,tt,nt,rt].forEach((function(t){or[t]=function(t,n={}){return n.open=!0,[n,e.children(t).map(on)]}}));const lr={};function ir(t,n,r){let o=t.firstElementChild;return o===r?o:(o&&en(o)===n||(o=e.prepend(t,Cr(n))),r.nodeType&&en(r)===n?e.replace(o,r):(e.fill(o,r.nodeType?e.contents(r):r),o))}function sr(t,n){let r=e.get(">header",t);if(r)return r===n?r:e.replace(r,n);let o=e.get(">h2",t);return o?e.after(o,n):e.prepend(t,n)}function ar(e,t,n){return t.forEach((t=>e.insertTR(t,null,n))),n}function ur(t,n,r){let o=[];for(const l of n)o.push(t.newTR(r)),e("th,td",o[o.length-1]).fill(l);return o}function cr(e,t,n,r){if(!n)return[null,!0];let o=n.nodeType?en(n):0;return nn(t,o)&&!xt(o)?[fr(e,t,n),!0]:[fr(e,t,r()),!1]}function fr(t,n,r){return t?e.before(t,r):e.append(n,r)}function dr(e,t,n,r,o){if(!r)return[null,!0];let l=e?t.trIndex(e,n):null;return"TR"!==r.tagName||!function(e,t){return function(e){return[...e.cells].reduce(((e,t)=>e+t.colSpan),0)}(e)===t.cols()}(r,t)||o&&![...r.cells].every((e=>"TH"===e.tagName))?[t.insertTR(t.newTR(o),l,n),!1]:[t.insertTR(r,l,n),!0]}function pr(t,n,r){if("SECTION"!==r.tagName)throw new Error(`<${r.tagName}> not a SECTION`);fr(t,n,function(t,n){return e.find("section",t,!0).forEach((e=>vn(e,n))),t}(r,("ARTICLE"===n.tagName?0:wn(n))-wn(r)+1))}function hr(e,t,n){switch(Lt(t)){case 0:case 1:return()=>$r(ge,null,n);case 2:return()=>pr(e,t,n)}return null}function mr(t){return t.map((t=>function(t){let n=e.get(">h2",t),r=e.children(t,"section");n||function(e,t){t&&window.console.info(t);throw new Error(e)}("<H2> is missed...!!",t);if(!r.length)return o=n,Nr(Cr(De),{href:o.id?`#${o.id}`:null},o.innerText);var o;let l=function(e){let t=Nr(Cr(X),{href:e.id?`#${e.id}`:null},e.innerText);return Nr(Cr(je),{h5a:[t]},Cr(Qe))}(n);return e.append(l.lastElementChild,mr(r)),l}(t)))}function gr(e,t){return t&&(e=e?`${e} ${t}`:`${t}`),e||null}function _r(t,n,r){return"string"==typeof r&&(r=function(t){return e.find("*",t).forEach((e=>tn(e,107))),t}(e.fragment(r,"svg"))),fr(t,n,r)}function wr(t,n){return!n||n.nodeType>1?n||null:"string"==typeof n?e.Text(n,!0):It(en(t))?e.Text(n):ln(n).map((n=>nn(t,en(n))?n:e.Text(n)))}function vr(e,...t){t.forEach((t=>delete e[t]))}function yr(t,n={}){return n.title=e.attr(t,"title"),[n,e.Text(t)]}function br(t,n={}){let r=e.attr(t,"datetime");return r&&([n.date,n.time]=r.split(/\s+/)),n.cite=e.attr(t,"cite"),n.datetime=r,[n,e.Text(t)]}function xr(t,n={}){let r=e.get("h4",t),o=e.children(t);return r&&(n.h4=r.textContent,n.summary=r.textContent,o.splice(o.indexOf(r),1)),n.open=!0,[n,e(o).clone()]}function Er(e,t,n=!1){return{head:e||null,body:t,end:n}}function Tr(t,n){return t?(e.isArray(t)?t:[t]).concat(n):e.isArray(n)?n:[n]}function Cr(t,n){let r=er[t],o=r?r():function(t,n){let r=e.elem(t);return n&&r.setAttribute("role",n)||r}(...Zn[t].split("\\"));return n&&e.append(o,n),tn(o,t)}function Nr(e,t,n,r){let o=en(e),l=nr[o];return l&&(e=l(e,t)),tr[o]&&function(e,t,n,r){if(r)return n.forEach((n=>Sr(null,e,t,n)));Sr(null,e,t,n)}(e,t,n,r),e}function Sr(t,n,r,o){let l=en(n),i=tr[l](t,n,r,o);return i.end?Tr(i.head,i.body):e.isArray(i.body)?Tr(i.head,i.body.map(((t,n)=>Nr(t,r,function(t,n){return e.isArray(t)?t[n]:t}(o,n))))):Tr(i.head,Nr(i.body,r,o))}function $r(e,t,n,r){if("string"==typeof e&&(e=Ut[e.toUpperCase()]),null==e)throw new Error("invalid target name.");return Nr(Cr(e),t||{},n,r)}function Ar(e){let t=en(e);return or[t]?m.convBlocks:lr[t]?m.convLines:rr[t]&&!function(e){let t=en(e.parentElement);return 526===t||t===Ue}(e)?m.convInlines:null}function kr(e){let t=en(e),n=rr[t]||lr[t]||or[t];if(!n)throw new Error(`[${e}] convert is not supported.`);return n(e)}[ge,_e,we,ve,ye].forEach((function(e){lr[e]=(e,t={})=>[(t.open=!0,t),on(e)]})),i(h,"New",(function(e){let t=Ut[e.toUpperCase()];if(null==t)throw new Error("invalid target name.");return(e,n,r)=>Nr(Cr(t),n||{},e.data,r)}),1),i(h,"New2",(function(e){let t=Ut[e.toUpperCase()];if(null==t)throw new Error("invalid target name.");return(e,n)=>e.data.map((e=>Nr(Cr(t),n||{},e)))}),1);
//! $ID: templates.js 2020.05.09 Cooljed.Config $
const Or={0:"option:text",[U]:"option:audio",[D]:"option:video",[H]:"option:picture",4:"option:svg",5:"option:ruby",[M]:"option:meter",7:"option:space",[F]:"option:img",9:"option:br",10:"option:wbr",[j]:"option:track",[P]:"option:source1",[B]:"option:source2",[K]:"option:pimg",[G]:"option:explain",107:"option:svgitem",[X]:"option:a",[q]:"option:q",[J]:"option:abbr",[Y]:"option:del",[Q]:"option:ins",[Z]:"option:dfn",[ee]:"option:bdo",[te]:"option:times",[ne]:"option:code",[re]:"option:strong",[oe]:"option:em",[le]:"option:cite",[ie]:"option:small",[se]:"option:sub",[ae]:"option:sup",[ue]:"option:mark",[ce]:"option:orz",[fe]:"option:samp",[de]:"option:kbd",[pe]:"option:s",[he]:"option:u",[me]:"option:var",[ge]:"option:p",[_e]:"option:note",[we]:"option:tips",[ve]:"option:pre",[ye]:"option:address",[be]:"option:h1",[xe]:"option:h2",[Ee]:"option:h3",[Te]:"option:h4",[Ce]:"option:h5",[Ne]:"option:h6",[Se]:"option:summary",[$e]:"option:figcaption",[Ae]:"option:caption",[ke]:"option:li",[Oe]:"option:dt",[Re]:"option:dd",[ze]:"option:tr",415:"option:thead",416:"option:tbody",417:"option:tfoot",[Ue]:"option:codeli",[De]:"option:ali",[He]:"option:ah5",[Me]:"option:xh5li",[Fe]:"option:xolh5li",[je]:"option:xolah5li",425:"option:figimgbox",500:"option:hgroup",512:"option:article",[Pe]:"option:s1",[Be]:"option:s2",[Ke]:"option:s3",[Ve]:"option:s4",[We]:"option:s5",[Ge]:"option:abstract",509:"option:seealso",508:"option:reference",[Xe]:"option:header",[qe]:"option:footer",[Je]:"option:section",[Ye]:"option:ul",[Qe]:"option:ol",[Ze]:"option:codelist",[et]:"option:ulx",[tt]:"option:olx",[nt]:"option:cascade",[rt]:"option:dl",521:"option:table",522:"option:figure",[ot]:"option:blockquote",[lt]:"option:aside",[it]:"option:details",526:"option:codeblock",[st]:"option:hr",528:"option:blank"},Rr={[U]:"property:audio",[D]:"property:video",[H]:"property:picture",[F]:"property:img",[K]:"property:img",4:"property:svg",5:"property:ruby",[te]:"property:times",[M]:"property:meter",7:"property:space",[X]:"property:a",[q]:"property:q",[J]:"property:abbr",[Y]:"property:del",[Q]:"property:ins",[ne]:"property:code",[Z]:"property:dfn",[ee]:"property:bdo",[ot]:"property:blockquote",[it]:"property:details",[Ze]:"property:codelist",[Qe]:"property:ol",[tt]:"property:olx",[ke]:"property:li",[Ue]:"property:li",[De]:"property:li",[Me]:"property:li",[Fe]:"property:li",[je]:"property:li",521:"property:table",[st]:"property:hr",528:"property:blank",[G]:"property:explain",[be]:"property:h1",[xe]:"property:h2",[Ee]:"property:h3",[Te]:"property:h4",[Ce]:"property:h5",[Ne]:"property:h6"},Ir=new Set([V,W,Ie,Le,K,10,-10]);
//! $ID: shedit.js 2021.04.08 Cooljed.Libs $
const Lr=new e.Fx.History,zr=new Nn(`${m.nameEditor}_${m.scriptList}`),Ur=new Sn(g.shEdits,Lr),Dr=Symbol("sh:dpage"),Hr=Symbol("sh:pager");let Mr=null,Fr=null,jr=!1;class Pr{constructor(t){this.$els=e(t),this.count=null,this.redo()}undo(){this.count>0&&Lr.back(this.count)}redo(){let e=Lr.size();this.$els.remove(),this.count=Lr.size()-e}}class Br{constructor(e){this._sid=e,this._old=zr.get(e),this.redo()}undo(){zr.set(this._sid,this._old)}redo(){zr.del(this._sid)}}class Kr{constructor(e,t){let n=e[Dr];this._idx=n.index();let r=Gr(n[t]()),o=n.index();this._nav=e,this._new=e[Hr].page(o,r),this._pgn=o+1,this._pgs=n.pages(),this.count=null,this.redo()}undo(){this.count>0&&Lr.back(this.count),this._nav[Dr].index(this._idx)}redo(){let e=Lr.size();Xr(this._nav,"page",this._new,"state",this._pgn,this._pgs),this.count=Lr.size()-e}}function Vr(...t){e.trigger(Fr,"state",!0),Ur.push(...t.filter((e=>e)))}function Wr(e){let t=zr.get(e);return t?JSON.parse(t):null}function Gr(t){return(t=e.map(t,Wr)).edit=jr,t.cmax=g.shCodelen,t}function Xr(t,n,r,o,l,i){var s,a;e.trigger(t,n,r),e.trigger(t,o,[[l,i],(s=l,a=i,a<=1?[!0,!0,!0,!0]:[1===s,1===s,s===a,s===a])])}function qr(e,t){let n=e.index();return t.page(n,Gr(e.page(n)))}function Jr(e,t=0){let n=Date.now()+t;return e.has(n)?Jr(e,parseInt(240*Math.random()*3600*1e3)):n}function Yr(e){if(!e||function(e){return zr.keys().some((t=>Wr(t).code===e))}(e))return;let t=Jr(zr),n={shid:t,code:e,time:Date.now()};zr.set(t,JSON.stringify(n))}const Qr={spinit(e){Mr=e.data},__spinit:1,shUndo:()=>(Ur.undo(),!Ur.canUndo()),shRedo:()=>(Ur.redo(),!Ur.canRedo()),shinit(e,t,n,r,o){Fr=e.data,r[Dr]=new $n(null,g.shListTop),r[Hr]=new An(t),o[Dr]=new $n(null,g.shListAll),o[Hr]=new An(n)},__shinit:1,delsh(e,t){jr&&Vr(new Pr(e.data),new Br(t))},__delsh:1,topsh(e){let t=Wr(e.data);return t&&(t.top=!0,zr.set(e.data,JSON.stringify(t))),t&&e.data},__topsh:1,untop(e){let t=Wr(e.data);return t&&(t.top=!1,zr.set(e.data,JSON.stringify(t))),t&&e.data},__untop:1,shlabel(e,t){let n=Wr(e.data);return n&&(n.name=t,zr.set(e.data,JSON.stringify(n))),n&&[t,e.data]},__shlabel:1,shpage(e,t){let n=new Kr(e.data,t);jr&&Vr(n)},__shpage:1,shtops(e){let t=e.data,n=t[Dr].reset(function(){let e=[];for(const t of zr.keys()){let n=Wr(t);n&&n.top&&n.code&&e.push({id:n.shid,tm:n.time})}return e.sort(((e,t)=>t.tm-e.tm)).map((e=>e.id))}()),r=qr(n,t[Hr].reset());Xr(t,"page",r,"state",n.index()+1,n.pages())},__shtops:1,shIndex:e=>(jr=!0,e.data.map((e=>qr(e[Dr],e[Hr].reset())))),__shIndex:1,shEdin(t){Ur.clear(),e.on(t.data,"nodeok emptied detach",null,Lr),e.on(t.data,"attrdone","nav >b",Lr)},__shEdin:1,shEdok(t){jr=!1,Ur.clear(),e.off(t.data,"nodeok emptied detach attrdone",!1,Lr)},__shEdok:1,sh2panel(t,n,r,o,l){let i=e.outerHeight(r,!0)+e.outerHeight(o,!0),s=e.outerHeight(l,!0)-e.height(l);return[e.height(r)+t.data,e.height(n)-(i+s+t.data)]},__sh2panel:1,shsearch(e,t){let n=t[Dr].reset(function(e){let t=function(...e){return t=>e.some((e=>e.every((e=>t.includes(e)))))}(...e.split(",").map((e=>e.trim().split(/\s+/)))),n=[];for(const e of zr.keys().reverse()){let r=Wr(e);r&&r.code&&t(r.code)&&n.push({id:r.shid,tm:r.time})}return n.sort(((e,t)=>t.tm-e.tm)).map((e=>e.id))}(e.data)),r=qr(n,t[Hr].reset());Xr(t,"page",r,"state",n.index()+1,n.pages())},__shsearch:1,shcode(t){e.trigger(Mr,"shcode",t.data)},__shcode:1,shsave(e){Yr(e.data)},__shsave:1};s(h,"Kit",Qr,["spinit","shUndo","shRedo","shinit","delsh","topsh","untop","shlabel","shpage","shtops","shEdin","shEdok","shIndex","sh2panel","shsearch","shcode","shsave"]);
//! $ID: highlight.js 2020.02.07 Cooljed.Libs $
const Zr={keyword:"kw",literal:"lit",number:"num",function:"fn",operator:"op",builtin:"bin",datatype:"dt",xmltag:"tag",attribute:"atn",regex:"re",selector:"slr",rgba:"rgb",unit:"un",important:"imp",doctype:"doc",error:"err",comments:null};function eo(e,t){return null==t?e:"string"==t?`<s>${e}</s>`:"comments"==t?`<i>${e}</i>`:`<b role="${Zr[t]||"non"}">${e}</b>`}function to(t,n,r){return e.html(t,eo(n,r),"append"),t}function no(e){return e.map((e=>"string"==typeof e?e:eo(e.text,e.type))).join("")}function ro(e){let t=e[0],n=e[e.length-1];return t.text&&t.text.startsWith("\n")&&(t.text=t.text.substring(1)),n.text&&n.text.endsWith("\n")&&(n.text=n.text.slice(0,-1)),e}function oo(t,n){let{text:r,type:o}=t;return e.isArray(r)&&(r=no(r)),[to(n,r,o)]}function lo(t,n){let{text:r,type:o}=t,l=(e.isArray(r)?no(r):r).split("\n");return[to(n,l.shift(),o),...l.map((e=>to(n.cloneNode(),e,o)))]}function io(e,t,n,r=!0){let o=[],l=$r(ne,{lang:e});for(const i of t)void 0===i.text?(o.push(...io(i.lang,r?ro(i.data):i.data,n)),l=$r(ne,{lang:e})):(o.push(...n(i,l)),l=o[o.length-1]);return[...new Set(o)].filter((e=>!e.normalize()))}
//! $ID: property.js 2021.06.16 Cooljed.Libs $
const so=/\s+/g,ao=e([m.rpLeft,m.rpRight]).elem("rp"),uo={[U]:function(t,n,r,o){e.attribute(t,r),void 0!==o&&vo(t,"source",o)},[D]:function(t,n,r,o,l){e.attribute(t,r),void 0!==o&&vo(t,"source",o);void 0!==l&&vo(t,"track",l)},[H]:function(t,n,r,o){let l=e.get("img",t);void 0!==o&&(e.fill(t,o),e.append(t,l));e.attribute(l,r)},[F]:ho,[K]:ho,4:ho,5:function(t,n,r,o,l,i){let s=e("rp",t),a=e.get("rt",t);void 0!==o&&(e.fill(t,o),a&&e.append(t,[s[0],a,s[1]]));if(void 0===r)return;a?e.fill(a,r):e.append(t,[l,e.elem("rt",r),i])},[M]:ho,7:po,[X]:ho,[Y]:ho,[Q]:ho,[ne]:function(t,n,r,o){void 0!==r&&e.attr(t,"-lang",function(t,n){let r=t.parentElement.parentElement;if(en(r)!==Ze)return n;return e.attr(r,"-lang")===n?null:n}(t,r));void 0!==o&&e.fill(t,o)},[Ze]:function(t,n,r,o){e.attribute(t,r),void 0!==o&&e.fill(t,e(o).elem("li"))},[Qe]:ho,[tt]:ho,[ke]:ho,[Ue]:ho,[De]:ho,[Me]:ho,[Fe]:ho,[je]:ho,521:function(t,n,r,o,l){let i=new e.Table(t);void 0!==r&&e.attr(t,"border",r);void 0!==o&&wo(i,o,0);void 0!==l&&wo(i,l,null)},[st]:function(t,n,r,o){e.cssSets(t,n,r),e.attr(t,"role",o)},528:po,[G]:function(t,n,r){e.attr(t,n,r),e.cssSets(t,"top right bottom left",null)}},co={[U]:function(e,t,n,r){return t.autoplay=n[0],t.loop=n[1],t.controls=n[2],[bo(t,"",null),r]},[D]:function(e,t,n,[r,o]){return t.autoplay=n[0],t.loop=n[1],t.controls=n[2],[bo(t,"",null),r,o]},[H]:function(e,t,n){return[bo(t,"",null),n]},5:function(t,n,r){let o=e.get("rt",t);return e([n,r]).Text().concat(o?[]:ao.clone())},521:yo,[te]:mo,[Y]:mo,[Q]:mo,[ne]:_o,[Ze]:function(t,n,r,o){let l={"-lang":n,start:r},i=e.attr(t,"-lang")||"";if(bo(l,"",null),!o&&n===i)return[l];return[l,To(t,n)]}},fo={[U]:function(t,n,r,o){let l=o&&e(o);return n.autoplay=r[0],n.loop=r[1],n.controls=r[2],bo(n,"",void 0),bo(n,null,void 0),t.map((()=>[n,l?l.clone():void 0]))},[D]:function(t,n,r,[o,l]){let i=o&&e(o),s=l&&e(l);return n.autoplay=r[0],n.loop=r[1],n.controls=r[2],bo(n,"",void 0),bo(n,null,void 0),t.map((()=>[n,i?i.clone():void 0,s?s.clone():void 0]))},[H]:function(t,n,r){let o=r&&e(r);return bo(n,"",void 0),t.map((()=>[n,o?o.clone():void 0]))},5:function(t,n,r){let o=[void 0,void 0];n&&(o[0]=e.Text(n));r&&(o[1]=e.Text(r));return t.map((t=>o.concat(e.get("rt",t)?[]:ao.clone())))},521:function(e,t,n,r){return e.map((e=>yo(e,t,n,r)))},[te]:go,[Y]:go,[Q]:go,[ne]:function(e,t){return e.map((e=>_o(e,t)))},[Ze]:function(t,n,r){return t.map((t=>function(t,n,r){let o={"-lang":n,start:r},l=e.attr(t,"-lang")||"";if(bo(o,"",void 0),bo(o,null,void 0),n===l||null===n)return[o];return[o,To(t,n)]}(t,n,r)))}};function po(t,n,...r){e.cssSets(t,n,r)}function ho(t,n,...r){e.attribute(t,n,r)}function mo(e,t,n,r){return n&&(t=t?`${t} ${n}`:`${n}`),[t||null,r||null]}function go(e,t,n,r){return n&&(t=t?`${t} ${n}`:`${n}`),xo(e,[t||void 0,r||void 0])}function _o(t,n){let r=t.textContent;if(""===n)return[null,e.Text(r)];let o=io(null,Qn([r],n),oo,!1);return[n,(l=o,l.map((e=>[...e.childNodes])).flat())];var l}function wo(e,t,n){let r=e.hasVth(null==n);t?r||e.insertColumn(t,n):r&&e.removeColumn(null==n?-1:n)}function vo(t,n,r){e.find(n,t).forEach((t=>e.remove(t))),e.append(t,r)}function yo(t,n,r,o){let l=new e.Table(t),i=l.hasVth(),s=l.hasVth(!0);return[n,r?i||l.newColumn(!0):null===r?void 0:null,o?s||l.newColumn(!0):null===o?void 0:null]}function bo(e,t,n){for(const r of Object.keys(e))e[r]===t&&(e[r]=n);return e}function xo(e,t){return new Array(e.length).fill(t)}function Eo(e,t){let n=e.map((e=>e.hasVth(!!t)));return 1===n.length||1===new Set(n).size?[n[0],!1]:[null,!0]}function To(t,n){let r=e.children(t).map((e=>e.textContent));return""===n?e(r).elem("code"):io(null,Qn(r,n),lo)}const Co={vals1:e=>1===e.data.length||1===new Set(e.data).size?e.data[0]||"":null,__vals1:1,vals2:e=>1===e.data.length||1===new Set(e.data).size?[e.data[0],!1]:[null,!0],__vals2:1,tableVth(t){let n=t.data.map((t=>new e.Table(t)));return[Eo(n),Eo(n,!0)]},__tableVth:1,attrVal:(t,n)=>n.split(so).map((n=>function(t,n){let r=t.map((t=>e.attr(t,n)));return 1===r.length||1===new Set(r).size?r[0]||"":null}(t.data,n))),__attrVal:1,attrBool:(t,n)=>n.split(so).map((n=>function(t,n){let r=t.map((t=>e.attr(t,n)));return 1===r.length||1===new Set(r).size?[null!==r[0],!1]:[null,!0]}(t.data,n))),__attrBool:1};a(_,"p",Co,Object.keys(Co).filter((e=>"_"!==e[0])));
//! $ID: plugins.js 2021.09.23 Cooljed.Plugins $
const No=new L(w),So=new Map,$o=new Map,Ao=new WeakMap;function ko(t,n=v.plugConf){return No.json(`${t}/${n}`).then((n=>function(t,n){if(n.style)return e.style({href:`${w}${t}/${n.style}`}).then((e=>$o.set(t,e)&&n));return n}(t,n))).then((e=>function(e,t){if(!t.extend)return t;return import(`${w}${e}/${t.extend}`).then((e=>function(e,t){return e.on=t.On||null,e.by=t.By||null,e}(t,e)))}(t,e))).then((e=>function(e,t){if(!t.root)return null;let n=new I(c(t.on,t.by),new z(e,No));return n.config(t.maps).then((()=>No.node(`${e}/${t.root}`))).then((e=>n.build(e,t.root)))}(t,e)))}function Oo(t,n=null){if(So.has(t))return Promise.resolve(null);let r=`${v.plugRoot}/${t}`,o=e.Element("img",{src:`${w}${r}/${v.plugLogo}`}),l=e.wrap(o,e.Element("button",{title:n}));return ko(r).then((e=>So.set(t,l)&&u.templater(t,e)||Ao.set(l,t)&&l))}
//! $ID: cmdline.js 2021.08.08 Cooljed.Libs $
const Ro=/^\(([^]*?)\)$/,Io=/^\[([\d:,\s]*)\]$/,Lo=/\s*:\s*/,zo=/^\{(.*)\}$/,Uo=/^\/(.*)\/([imsugy]*)$/,Do=/^(['"`])(.*)\1$/,Ho=new N("|",new S,new A("[","]"),new A("{","}"));let Mo=null,Fo=null;class jo{constructor(e,t){this._set=e,this._ctx=t}exec(e,t){let n=[...Ho.reset().split(e.trim())],r=n.shift();return Jo(n,this._set.size>0?this._finds(r,t,[...this._set]):this._find(r,t,this._ctx))}_find(e,t,n){return R.find(e,t,!1,n)}_finds(e,t,n){return n.map((n=>R.find(e,t,!1,n))).flat()}}class Po{constructor(e){this._set=e}exec(t){return Jo([...Ho.reset().split(t.trim())],e(this._set))}execOne(t,n){return this._handle(t.trim())(e(n))}_handle(e){return Ro.test(e)?this._exclude(e.match(Ro)[1]):Io.test(e)?this._number(e.match(Io)[1]):zo.test(e)?this._filter(e.match(zo)[1]):t=>t.filter(e)}_exclude(t){return n=>n.filter((n=>!e.is(n,t)))}_number(e){let t=e.split(Lo);return t.length>1?this._range(t):(t=JSON.parse(`[${e}]`),e=>t.map((t=>e[t])).filter((e=>e)))}_range([e,t]){return e=Math.trunc(e)||0,t=t.trim()?Math.trunc(t):void 0,n=>n.slice(e,t)}_filter(e){let t=new Function("v","i","c",`return ${e};`);return e=>e.filter(t)}}class Bo{constructor(e){this._ctx=e,this._doc=e.ownerDocument}exec(e,t){return e=Uo.test(e)?this._regexp(e):Yo(e),t.map((t=>this._ranges(t,e))).flat()}_ranges(e,t){let n=[],r=0,o=0;for(;[r,o]=this._search(e.textContent,t,r),!(r<0||0===o);)n.push(this._range(e,r,o)),r+=o;return n}_search(e,t,n){if("string"==typeof t)return[e.indexOf(t,n),t.length];let r=e.substring(n),o=r&&r.match(t);return o?[n+o.index,o[0].length]:[-1,0]}_range(e,t,n){let r=this._doc.createRange();return r.setStart(e,t),r.setEnd(e,t+n),r}_regexp(e){let[t,n]=e.match(Uo).slice(1);return n&&(n=n.split("").filter((e=>"g"!==e)).join("")),new RegExp(t,n)}}class Ko{constructor(e){this._cmds=new Map([["plug-ins",this._plugIns],["plug-del",this._plugDel],["help",this._help],["config",this._config],["replace",this._replace.bind(this)]]),this._eset=e}exec(e){let[t,n]=this._cmdArgs(e),r=this._cmds.get(t);if(!t)return b.commandInvalid;try{return r(...n)||""}catch(e){return`[${e.name}]: ${e.message}`}}_cmdArgs(e){for(const t of this._cmds.keys())if(e===t||e.startsWith(t+" "))return[t,this._args(e.substring(t.length+1))];return[]}_args(t){return e.split(t," ",1/0,!0).filter((e=>e)).map(Yo)}_help(t){e.trigger(Mo,"open"),e.trigger(Mo,"help",t)}_plugIns(t,n){e.trigger(Fo,m.plugIns,Oo(t,n))}_plugDel(t){e.trigger(Fo,m.plugDel,function(t){let n=So.get(t),r=`${v.plugRoot}/${t}`,o=$o.get(r);return n&&(So.delete(t),u.templater(t,null)),o&&(e.remove(o),$o.delete(r)),n||null}(t))}_config(e,t){if(void 0===t)return g[e].toString()||b.configNothing;if(void 0===x[e])throw new Error(`${e} option is not supported`);return`Fx.${e}=${x[e]=t&&JSON.parse(t)}`}_replace(...e){return e.length?this._eset.size?[new qo([...this._eset],...e)]:b.selectNone:b.missContent}}class Vo{constructor(e,t){this._set=e,this._ctx=t}exec(t,n){let r=new Function("$$","$","_",`return ${t};`),o=null;try{o=r(e(this._set),n,this._ctx)}catch(e){o=`[${e.name}]: ${e.message}`}return""+o}}class Wo{constructor(){this._buf=[]}add(e){this._buf[this._buf.length-1]!==e&&this._buf.push(e)}find(e){let t=this._buf.slice().reverse(),n=[],r=0;for(;r>=0;)r=this._indexOf(e,t,r),r>=0&&n.push(t[r++]);return n}size(){return this._buf.length}_indexOf(e,t,n=0){for(;n<t.length;n++)if(t[n].startsWith(e))return n;return-1}}class Go{constructor(e){this._buf=e,this._idx=0}next(){let e=this.size()-1;return this._idx<e?this._buf[++this._idx]:null}prev(){return this._idx>0?this._buf[--this._idx]:null}first(){return this._idx=0,this._buf[0]||null}last(){return this._idx=this._buf.length-1,this._buf[this._idx]||null}reset(){return this._idx=0,this}size(){return this._buf.length}}const Xo={[y.select]:new Wo,[y.filter]:new Wo,[y.search]:new Wo,[y.command]:new Wo,[y.calcuate]:new Wo};class qo{constructor(t,n,r){if(!this._checks(t))throw new Error(b.needContent);void 0===r?[n,r]=[/[^]+/,n]:n=this._regstr(n),this._tts=e(t).map((e=>e.textContent.replace(n,r))).Text(),this._els=t,this._old=t.map(((e,t)=>this._fill(e,this._tts[t])))}undo(){this._els.forEach(((e,t)=>this._fill(e,this._old[t])))}redo(){this._els.forEach(((e,t)=>this._fill(e,this._tts[t])))}_checks(e){return e.every((e=>un(e)))}_regstr(e){return Uo.test(e)?new RegExp(...e.match(Uo).slice(1)):e}_fill(t,n){let r=[...t.childNodes];return t.textContent="",t.append(...e.isArray(n)?n:[n]),r}}function Jo(e,t){return e.reduce(((e,t)=>(new Po).execOne(t,e)),t)}function Yo(e){return Do.test(e)?e.match(Do)[2]:e}function Qo(t,n){Mo=t,Fo=n,e.trigger(n,m.plugInit,v.plugList.reduce(((e,t)=>e.then((e=>Oo(t[0],t[1]).then((t=>e.push(t)&&e))))),Promise.resolve([])))}function Zo(e){return Xo[e]}
//! $ID: edit.js 2019.09.07 Cooljed.Libs $
const el=e.Fx.History.Normalize,tl=`${m.selectedClass} ${m.focusClass} ${m.hoverClass} ${m.pointClass}`,nl=`.${m.selectedClass}, .${m.focusClass}, .${m.hoverClass}, .${m.pointClass}`,rl=Symbol(),ol=/\s+/g,ll=/\n\s*\n/,il=/(\s)\s*/g,sl=/\r\n|\n|\r/,al=/section|article/i,ul=/\sclass="[\w\s]+"/,cl={[Oe]:["dd",rt],[Se]:["p",it],[Ee]:["p",Ge],[Ee]:["p",Xe],[Ee]:["p",qe],[Ee]:["p",ot],[Ee]:["p",lt]},fl=new Set([ke,Oe,Re,ge,we,_e,ye]),dl={minied:"miniedIn",toup:"indentReduce",todown:"indentIncrease",delete:"deletes",property:"properties"},pl={children:qi,siblings:function(e){return qi([...Gi(e)])}},hl=new Set(["a","ruby","bdo"]),ml=`${t.on} ${t.by} ${t.to}`,gl=new Set([t.on,t.by,t.to,ml]),_l=new Tn(m.selectedClass),wl=new class{constructor(e){this._cls=e,this._its=null}set(e){let t=this._its;return t!==e&&this._set(e),t}get(){return this._its||null}is(e){return!!e&&e===this._its}cancel(){return this._its&&e.removeClass(this._its,this._cls),this._its=null}_set(t){if(null==t)return this.cancel();this._its&&e.removeClass(this._its,this._cls),this._its=e.addClass(t,this._cls)}}(m.focusClass),vl=new class{constructor(t="_cursor_"){let n=t+(Date.now()%4294967295).toString(16);this._cel=e.attr(e.elem("i"),n,""),this._slr=`[${n}]`}cursor(t,n){let r=n.commonAncestorContainer,o=e.contains(t,r);return o&&(3===r.nodeType&&0===n.endOffset&&n.setEnd(n.endContainer,1),n.collapse(!1),n.insertNode(this._cel)),n.detach(),o&&t}active(t){let n=e.get(this._slr,t),r=document.createRange();return n?(r.selectNode(n),r.deleteContents(),t.normalize()):r.selectNodeContents(t),this._active(r,t)}active2(t,n=!1){let r=e.get(this._slr,t),o=document.createRange();return r&&(r.remove(),t.normalize()),o.selectNodeContents(t),o.collapse(n),this._active(o,t)}clean(t){let n=e.get(this._slr,t);return n&&(n.remove(),t.normalize()),n&&t}_active(e,t){let n=window.getSelection();return n.removeAllRanges(),n.addRange(e),e.detach(),t.focus(),t}},yl=new e.Fx.History,bl=new Nn(`${m.nameEditor}_`),xl=new N(";",new S,new $);class El{constructor(e,...t){this._fun=e,this._vals=t,this.count=null,this.redo()}undo(){this.count>0&&yl.back(this.count)}redo(){let e=yl.size();this._fun(...this._vals),this.count=yl.size()-e}changed(){return this.count>0}}class Tl{constructor(e,...t){this._fun=e,this._args=t,this._data,this.count=null,this.redo()}undo(){this.count>0&&yl.back(this.count)}redo(){let e=yl.size();this._data=this._fun(...this._args),this.count=yl.size()-e}changed(){return this.count>0}result(){return this._data}warn(e){if(void 0===e)return this._msg;this._msg=e}}class Cl{constructor(e,t){this._nds=e,this._old=e.map((e=>e.textContent)),this._tts=this._old.map(t),this.redo()}undo(){this._nds.forEach(((e,t)=>e.textContent=this._old[t]))}redo(){this._nds.forEach(((e,t)=>e.textContent=this._tts[t]))}}class Nl{constructor(e,...t){this._fun=e,this._vals=t,this._old=[..._l],this.redo()}undo(){_l.clear().pushes(this._old),Xi(Kl,m.evnFollow)}redo(){this._fun(...this._vals),Xi(Kl,m.evnFollow)}}class Sl{constructor(e=wl.get()){this._hot=e,this._old=Jl(e)}undo(){Jl(this._old)}redo(){Jl(this._hot)}}class $l{constructor(e){e&&this.redo()}undo(){Xi(Kl,m.evnFollow)}redo(){Xi(Kl,m.evnFollow)}}class Al{constructor(e,t){this._el=$r(t,...this._optData(t,e)),this._old=[...e.extractContents().childNodes],e.insertNode(this._el),e.collapse(),e.detach(),this._tmp=null}undo(){let e=this._el.parentElement;this._el.replaceWith(...this._old),this._tmp=new el(e)}redo(){this._tmp.back(),this._old.slice(1).forEach((e=>e.remove())),this._old[0].replaceWith(this._el)}elem(){return this._el}completed(){return this._whole}_optData(e,t){let n=this[`_${e}`],r=t.cloneContents();return n?n(this,t.toString(),r):[null,r]}_a(e,t,n){return e._whole=Al.url.test(t.trim()),[e._whole&&{href:t},n]}_ruby(e,t,n){let r=t.trim().match(Al.ruby),o=r?r[2]:m.rtHolder,l=r?r[1]:n;return e._whole=r,[{rt:o},l]}}Al.url=/^(?:http|https|ftp|email):\/\/\w[\w.-]+\/\S+$/i,Al.ruby=RegExp(`^([\\S\\x20]+)\\${m.rpLeft}([\\w\\u00c0-\\u017e\\u3105-\\u312d ]+)\\${m.rpRight}$`,"i");class kl{constructor(t){this._el=e.attr(e.elem("mark",t.toString()),"role","tmp"),this._old=[...t.extractContents().childNodes],t.insertNode(this._el),t.detach(),this._tmp=null}undo(){let e=this._el.parentElement;this._el.replaceWith(...this._old),this._tmp=new el(e)}redo(){this._tmp.back(),this._old.slice(1).forEach((e=>e.remove())),this._old[0].replaceWith(this._el)}elem(){return this._el}}class Ol{constructor(e,t){this._cp=this._clone(e,t),this._el=e,e.replaceWith(this._cp),this._cp.setAttribute("contenteditable",!0)}active(){vl.active(this._cp)}activeEnd(){vl.active2(this._cp,!1)}done(){let t=this._clean(e.clone(this._cp),en(this._cp));gs((()=>e.fill(e.removeAttr(this._cp,"contenteditable"),t)))}elem(){return this._cp}original(){return this._el}undo(){this._cp.replaceWith(this._el)}redo(){this._el.replaceWith(this._cp)}_clone(t,n){vl.cursor(t,n);let r=e.clone(t,!0,!0,!0);return vl.clean(t),r}_clean(t,n){return e.fill(t,this._inlines(t.childNodes)),n===ve?e("br",t).replace("\n"):n===ne&&this._codeparse(t),[...e.normalize(t).childNodes]}_inlines(e){let t=[];for(const n of e){let e=n.nodeType;3===e||8===e?t.push(n):1===e&&t.push(Pn(n))}return t}_codeparse(t){let n=e.attr(t,"-lang");if(!n)return e("br",t).replace("\n");e.html(t,io(null,Qn([t.textContent],n),oo,!1).map((e=>e.innerHTML)).join(""))}}const Rl=new class{only(e){if(1==_l.size&&_l.has(e))return!1;_l.clear(),_l.add(e)}turn(e){_l.has(e)?_l.delete(e):this.clean(e).add(e)}reverse(e){for(const t of e)_l.has(t)?_l.delete(t):this._parentAdd(t)}expand(e,t){return _l.has(t)?this.adds(e):this.removes(e)}adds(e){e.forEach((e=>_l.has(e)||this._parentAdd(e)))}removes(e){e.forEach((e=>_l.has(e)&&_l.delete(e)))}empty(){if(0==_l.size)return!1;_l.clear()}add(e){_l.has(e)||this.clean(e).add(e)}safeAdd(e){_l.has(e)||_l.add(e)}safeAdds(e){_l.pushes(e)}delete(e){return _l.has(e)&&_l.delete(e)}unshift(e){let t=[..._l];t.length&&_l.clear(),this.adds(e.concat(t))}cleanUp(e){let t=this._parentItem(e);return!!t&&(_l.delete(t),_l)}cleanDown(e){let t=this._contains(e);return!!t.length&&(t.forEach((e=>_l.delete(e))),_l)}clean(e){return this.cleanUp(e)||this.cleanDown(e)||_l}_parentAdd(e){this.cleanDown(e),_l.add(e)}_parentItem(t){for(const n of _l)if(e.contains(n,t,!0))return n;return null}_contains(t){let n=[];return _l.forEach((r=>e.contains(t,r,!0)&&n.push(r))),n}},Il=new class{toText(e){e.text(e.text())}unWrap(t){let n=new Set;t.forEach((e=>n.add(e.parentElement))),t.unwrap(),e(n).normalize()}newAfter(t,n){e.after(t,n)}newBefore(t,n){e.before(t,n)}newPrepend(t,n){e.prepend(t,n)}newAppend(t,n){e.append(t,n)}cloneAfter(t,n){t.forEach(((t,r)=>e.after(t,n[r])))}appends(t,n){t.forEach((t=>e.append(t,n)))}fills(t,n){t.forEach((t=>e.fill(t,n)))}replaces(t,n){t.forEach(((t,r)=>e.replace(t,n[r])))}replacex(t,n){e.replace(t[0],n),t.slice(1).forEach((t=>e.remove(t)))}insert(t,n,r){t?e.before(t,r):e.append(n,r)}alignInsert(t,n,r){t.forEach(((t,o)=>e[n](t,r[o])))}reverses(e){for(const t of e){let e=t.length-1;for(let n=0;n<parseInt(t.length/2);n++)Mn(t[n],t[e-n])}}merges(t,n,r){e.append(t,n),r.filter(ji).remove()}movePrev(t,n){for(const r of t)0===n?e.before(Dn(r[0],1/0),r):r.forEach((t=>e.before(Dn(t,n),t)))}moveNext(t,n){for(const r of t)0===n?e.after(Hn(hs(r),1/0),r):r.reverse().forEach((t=>e.after(Hn(t,n),t)))}sectionsUp(t){t.forEach((t=>function(t){let n=t.parentElement;if("s1"===e.attr(t,"role"))return ws(b.sectionNotUp,t);e.after(n,function(t){return e.find("section",t).forEach((e=>vn(e,-1))),vn(t,-1)}(t)||t)}(t))),Yl()}sectionsDown(t){t.forEach((t=>{return n=t[0],r=t[1],function(t){e.find("section",t).forEach((e=>vn(e,1))),vn(t,1)}(n),void e.append(e.replace(n,r),n);var n,r})),Yl()}styles(t,n,r){for(const o of t)e.cssSets(o,n,r)}attrs(t,n,r){for(const o of t)e.attribute(o,n,r)}},Ll=new Sn(g.history,yl);let zl=null,Ul=null,Dl=null,Hl=null,Ml=null,Fl=null,jl=null,Pl=null,Bl=null,Kl=null,Vl=null;function Wl(...e){Gl(),ms(null),Ll.push(...e.filter((e=>e)))}function Gl(){e.trigger(zl,m.redoEvent,!1,!0)}function Xl(){Ll.clear(),e.trigger(zl,m.undoEvent,!1,!0),e.trigger(zl,m.redoEvent,!1,!0)}function ql(e,t){return void 0===t?e[rl]:(e[rl]=t,e)}function Jl(t){try{return null==t?e.empty(Dl):(e.intoView(t,0),e.fill(Dl,function(t,n){return[t].concat(e.parentsUntil(t,(e=>e===n))).reverse().map((t=>ql(e.elem("b",function(e){let t=e.tagName.toLowerCase();return e.hasAttribute("role")&&(t+=":"+e.getAttribute("role")),t}(t)),t)))}(t,zl))),wl.set(t)}finally{!function(t){e.trigger(Ul,m.covert,t&&sn(t)&&Qi(t)||"")}(t)}}function Yl(){let e=wl.get();_l.has(e)&&Jl(e)}function Ql(e,t){Rl.cleanUp(t),Rl.expand(e,t)}function Zl(e,t){e.forEach((e=>Rl.cleanUp(e))),Rl.expand(e,t)}function ei(e,t){e.forEach((e=>Rl.cleanUp(e))),Rl[t](e)}function ti(e,t,n){n&&Rl.cleanUp(e),Rl[t](e)}function ni(e,t){return[new Nl(ti,e,t),new Sl(e)]}function ri(e,t){for(const n of e)Rl.cleanUp(n),Rl.adds(t(n))}function oi(e){Rl.empty(),Rl.safeAdds(e)}function li(e){Rl.empty(),e.forEach((e=>Rl.add(e)))}function ii(e){Rl.cleanUp(e),Rl.reverse(e.parentElement.children)}function si(){return _l.size>0&&new Nl((()=>_l.clear()))}function ai(e){return(e=ds(e)).length>0&&new Nl((()=>_l.pushes(e)))}function ui(t,n){let r=wl.get();return r&&t.length?t.some((t=>e.contains(t,r,!n)))&&new Sl(null):null}function ci(t,n){if(0!==t.length)return n&&!t.every(ji)?(ms("has_cannot_del",Ii(t)),null):new El((()=>e(t).remove()))}function fi(e,t,n){return e.length>0&&new El(Il[n],e,t)}function di(t,n,r,o){if(!Ki(n))return ms("cannot_append",n);if(!t.every(ji))return ms("has_cannot_del",Ii(t));let l=mi(r,n,t.clone(!0,!0,!0)),i=si(),s=o&&new El((()=>e.empty(n)));return[new Sl,i,s,new El((()=>t.remove())),l.length&&new El(Il.insert,r,n,l),...hi(n,l)]}function pi(t,n,r,o){if(!Ki(n))return ms("cannot_append",n);let l=mi(r,n,t),i=si(),s=o&&new El((()=>e.empty(n)));return[new Sl,i,s,l.length&&new El(Il.insert,r,n,l),...hi(n,l)]}function hi(e,t){return un(e)?[new Nl((()=>_l.add(e)))]:[ai(t),new Sl(t[0])]}function mi(t,n,r){try{return gs((()=>r.map((e=>Sr(t,n,{},e))).flat().map((t=>t&&e.remove(t))).filter((e=>e))))}catch(e){throw ws(e,n)}}function gi(t,n,r){if(n=isNaN(n)?1:n||1/0,!t||n<0)return;let o=e.prevAll(t,((e,t)=>t<=n));return o.length&&r(o,t)}function _i(t,n,r){if(n=isNaN(n)?1:n||1/0,!t||n<0)return;let o=e.nextAll(t,((e,t)=>t<=n));return o.length&&r(o,t)}function wi(t,n,r){if(n=isNaN(n)?1:n,!t||n<=0)return;let o=e.closest(t,((e,t)=>t==n||e===zl));return o&&o!==zl&&r(o)}function vi(t,n,r){if(n=n||0,!t||n<0)return;let o=e.children(t,n);return o&&r(o)}function yi(e,t){let n=_n(e,zl);return n&&t(n)}function bi(t,n){return t.size===n.length&&e.every(t,((e,t)=>n[t]===e))}function xi(e,t,n){if(!e.length||e.some(Ti))return;return new El(Il.styles,e,t,(e=>`${(parseFloat(e)||0)+n}px`))}function Ei(e,t){return new El(Il.styles,e,t,"auto")}function Ti(t){return 107===en(t)||"absolute"!==e.css(t,"position")}function Ci(t){let n=new Sl(null),r=null,o=new El((()=>e.normalize(t)));return _l.has(t)&&(r=new Nl(Rl.delete,t)),Vl=new Ol(t,window.getSelection().getRangeAt(0)),e.trigger(zl,m.medIn,null,!0),e.trigger(jl,"hide"),e.trigger(Bl,m.insType,m.miniedTpl),[n,r,o,Vl,new Sl(Vl.elem())]}function Ni(t){let n=e.attr(e.elem(t.tagName),"role",e.attr(t,"role"));return[new El(Il.newAfter,t,n),...Ci(n)]}function Si(t,n){let r=en(n),o=cl[r];return Ai(t,T.Keys.miniedSameLine)?fl.has(r)&&Ni(n):!!Ai(t,T.Keys.miniedLogicLine)&&(function(e,t){return e&&e[1]===en(t.parentElement)}(o,n)?function(t,n){let r=e.elem(n);return[new El(Il.newAfter,t,r),...Ci(r)]}(n,o[0]):fl.has(r)&&Ni(n))}const $i={[m.levelName1]:[Il.newAfter,Il.newBefore],[m.levelName2]:[Il.newAppend,Il.newPrepend]};function Ai(e,t){let n=t.split(ol);return n.length===e.size&&n.every((t=>e.has(t.toLowerCase())))}function ki(e){let t=new Map;for(const n of e){let e=n.parentElement;(t.get(e)||t.set(e,[]).get(e)).push(n)}return[...t.values()]}function Oi(t){let n=wl.get(),r=e.contains(t,n);try{return r&&wl.cancel(),on(t)}finally{r&&wl.set(n)}}function Ri(e,t){return t=isNaN(t)?1:t,new Array(t).fill().map((()=>on(e)))}function Ii(e){for(const t of e)if(!ji(t))return t}function Li(e){for(const t of e)if(!pn(t))return t}function zi(e){for(const t of e)if(hn(t))return t}function Ui(t,n,r){let o=n.cellIndex(t);return e.isArray(o)?function(e,[t,n],r){let o=new Set;for(let l=t;l<n;l++)e.column(l,r).forEach((e=>o.add(e)));return[...o]}(n,o,r):n.column(o,r)}function Di(t,n){if(!t)return;let r=t.parentElement;if(!e.contains(r,n,!0))return null;for(;n.parentElement!==r;)n=n.parentElement;return n}function Hi(e){return(e=e.parentElement)!==zl&&e}function Mi(e){let t=new Set,n=0;for(const[r,o]of e.entries()){let e=o.parentElement;if(n+=e.childElementCount,t.add(e).size===r)throw ws("repeat sibling",o)}if(n===e.size)throw ws("no more sibling")}function Fi(e,t){return t=t||e[0].tagName,e.every((e=>e.tagName===t))}function ji(e){let t=en(e);return $t(t)||At(t)||Ot(t)}function Pi(e){let t=en(e);return kt(t)||At(t)&&!bt(t)}function Bi(e){return un(e.parentElement)&&un(e)}function Ki(e){let t=en(e);return!bt(t)&&!St(t)}function Vi(e,t){return Ki({prepend:e,append:e,fill:e,before:e.parentElement,after:e.parentElement,replace:e.parentElement}[t])}function Wi(e){return e.reduce(((e,t)=>e.add(en(t))),new Set)}function Gi(e){let t=new Set;for(const n of e)n.parentElement&&t.add(n.parentElement);return t}function Xi(t,n,...r){setTimeout((()=>t.isConnected&&e.trigger(t,n,...r)),1)}function qi(t){return function(t){let n=t.shift();if(!n||"TABLE"===n.tagName&&t.length>0)return[];let r=[...rn(n)];return t.length>0&&(r=r.filter((e=>t.every((t=>nn(t,e)))))),e.map(r.filter((e=>!Ir.has(e))),(e=>Or[e]))}(t.filter((e=>!St(en(e)))))}function Ji(t,n,r="text"){return t?e("tr",t).find(n)[r]():null}function Yi(e,t){return e&&Un(e).then((e=>e?ds(e).map((e=>$r(t,e))):[]))}function Qi(e){let t=[...e.attributes].map((e=>`${e.name}="${e.value}"`)).join(" ");return t?`<${e.tagName} ${t}>`:`<${e.tagName}>`}function Zi(e){return es(e).outerHTML}function es(t){let n=e.clone(t);return e.find(nl,n,!0).forEach((t=>e.removeClass(t,tl))),n}function ts(e,t,n,r){let o=[...e];return o.length||(o=[...zl.children]),n&&(t.TEXT=o.map((e=>e.textContent))),r&&(t.HTML=o.map(Zi)),t}function ns(e,t){let n,r=new Function("$$","$","_",e);try{n=r(t,rs,zl)}catch(e){return{type:"error",data:e}}return void 0===n?null:{type:"value",data:n,code:e}}const rs=new Proxy(e,{apply:(e,t,n)=>e(n[0],n[1]||zl)});function os(e,t){return t.some((t=>""!==e.style[t]))}function ls(e,t){let n=e[0].style[t];for(const r of e.slice(1))if(r.style[t]!==n)return null;return n}function is(t,n){let r=rn(t),o=[];for(const e of n)(3!==e.nodeType||e.textContent.trim())&&(bn(e,r)||o.push(e));return o.length?o:function(t){for(const n of t){if(1!==n.nodeType)continue;let t=is(n,e.contents(n));if(t)return t}}(n)}function ss(e){return 3===e.nodeType?e.textContent:e.cloneNode().outerHTML.replace(RegExp(`</${e.tagName}>$`,"i"),"")}function as(e,...t){for(const n of t)[n[e],n[e-1]]=[n[e-1],n[e]]}function us(e){return xl.reset(),[...xl.split(e)].join(" ").trim()}function cs(e,t="-"){let n=e.length;for(;n--&&(!e[n]||e[n]===t););return n+1}function fs(e){return e.textNodes().map((e=>e.filter((e=>e.textContent.trim()))))}function ds(t){return e.isArray(t)?t:[t]}function ps(e){for(const t of e.values())return t}function hs(e){return e[e.length-1]}function ms(t,n=null){if(null===t)return e.trigger(Hl,"off");let[r,o]=E[t];e.trigger(ql(Hl,n),"on"),e.trigger(e.get("a",Hl),"setv",[r,o,o])}function gs(t){let n=e.config({varyevent:!1,bindevent:!1});try{return t()}finally{e.config(n)}}function _s(t){setTimeout((()=>e.trigger(Ml,m.info,t)),10)}function ws(t,n){return e.trigger(ql(Hl,n),"on"),e.trigger(e.get("a",Hl),"setv",[null,t,t]),new Error(t)}const vs={[y.select]:null,[y.filter]:null,[y.search]:null,[y.command]:null,[y.calcuate]:null},ys={[y.select]:function(e,t){if(!e.exec(t,wl.get()).length)return b.selectNone;return bs([],e.exec(t,wl.get()))},[y.filter]:function(e,t){return bs([],e.exec(t))},[y.search]:function(t,n){let r=(_l.size?[..._l]:[...zl.children]).map((t=>e.textNodes(t,!0))).flat(),o=r.length&&t.exec(n,r);if(!o.length)return`${b.searchNothing} ${n}`;let l=o.map((e=>new kl(e)));return bs(l,l.map((e=>e.elem())))},[y.command]:function(e,t){return e.exec(t)},[y.calcuate]:function(e,t){let n=e.exec.bind(e),r=new Tl(n,t,wl.get());r.changed()&&(r.warn(b.undoWarn),Wl(r));return r.result()}};function bs(e,t){return e.concat(si(),ai(t),new Sl(t[0]))}function xs(t){let n={},r=[];for(const o of t){let[t,l]=kr(o);r.push(l),e.assign(n,t)}return[n,r]}function Es(t,n){let r=function(e){let t=Ut[e.toUpperCase()];return or[t]?m.convBlocks:lr[t]?m.convLines:rr[t]?m.convInlines:null}(t);switch(r){case m.convInlines:return function(e,t){let[n,r]=xs(t),o=r.map((t=>$r(e,n,t)));return[new El(Il.replaces,t,o),o]}(t,n);case m.convLines:return function(t,n){let[r,o]=xs(n),l=o.map((n=>e.isArray(n)?n.map((e=>$r(t,r,e))):$r(t,r,n)));return[new El(Il.replaces,n,l),l.flat()]}(t,n);case m.convBlocks:return function(e,t){let[n,r]=xs(t),o=null;return Ar(t[0])===m.convLines?(o=$r(e,n,r,!0),[new El(Il.replacex,t,o),[o]]):(o=r.map((t=>$r(e,n,t,!0))),[new El(Il.replaces,t,o),o])}(t,n)}throw new Error(`[${t}] convert is not supported.`)}const Ts={[be]:{self:">h1, >hgroup",prev:null},500:{self:">h1, >hgroup",prev:null},[Ge]:{self:">header[role=abstract]",prev:[be]},507:{self:">nav[role=toc]",prev:[Ge,be]},512:{self:">article",prev:[507,Ge,be]},508:{self:">nav[role=reference]",prev:[512,507,Ge,be]},509:{self:">aside[role=seealso]",prev:[508,512,507,Ge,be]},[qe]:{self:">footer",prev:[509,508,512,507,Ge,be]}},Cs={[be]:{self:">h1",prev:null},[xe]:{self:">h2",prev:null},[Te]:{self:">h4",prev:null},[He]:{self:">h5",prev:null},[Se]:{self:">summary",prev:null},[$e]:{self:">figcaption",prev:null},[Ae]:{self:">caption",prev:null},415:{self:">thead",prev:[Ae]},416:{self:">tbody:last-of-type",prev:[415,Ae]},417:{self:">tfoot",prev:[416,415,Ae]},[Xe]:{self:">header",prev:[xe]},[qe]:{self:">footer",prev:["LastChild"]},[K]:{self:">img",prev:["LastChild"]},LastChild:{self:">:last-child",prev:null}};function Ns(t,n,r){let o=null;if(!n)return o;for(const l of n)if(o=e.get(r[l].self,t),o)break;return o}function Ss(t,n,r){let o=r[en(n)],l=e.get(o.self,t);return l?new El((()=>e.replace(l,n))):(l=Ns(t,o.prev,r),new El(l?()=>e.after(l,n):()=>e.prepend(t,n)))}function $s(t,n,r=zl){let o=Ts[t],l=e.get(o.self,r);if(l)return e.replace(l,n);let i=Ns(r,o.prev,Ts);return i?e.after(i,n):e.prepend(r,n)}function As(e){return Fi(e,"SECTION")&&e.some((e=>en(e)!==Pe))}function ks(e){return Fi(e,"SECTION")}function Os(e){let t=[...Wi(e)];return t.length>1||t[0]===ke&&"OL"!==e[0].parentElement.tagName?null:Rr[t[0]]||null}const Rs=[function(e){return un(e[0])},function(){return null!==Bs.convtype()},As,ks,function(e){return e.every(ji)},Os],Is={[Pe]:Ds,[Be]:Ds,[Ke]:Ds,[Ve]:Ds,[We]:Ds,[Je]:Ds,521:function(e){return Hs(e,">caption, >thead, >tfoot")},[ze]:null,[Xe]:Us,[qe]:Us,[ot]:Us,[lt]:Us,[it]:function(e){return Hs(e,">summary")}};function Ls(e){let t=Is[e];return null===t?null:t||zs}function zs(t){return e.children(t)}function Us(e){return Hs(e,">h4")}function Ds(e){return Hs(e,">h2")}function Hs(t,n){let r=e.children(t);for(const o of e.find(n,t)){let e=r.indexOf(o);e>=0&&r.splice(e,1)}return r}function Ms(t,n){let r=en(t);if(kt(r))return!Nt(r)&&n.every(un)&&e(n).contents().flat();let o=[...Wi(n)];return 521===r?1===o.length&&521===o[0]&&function(e,t){let n=mn(e).cols();return t.every((e=>n===mn(e).cols()))}(t,n)&&Fs(n):function(e,t){let n=Wt[e];return void 0===n?!bt(e)&&!St(e)&&t.every((t=>t===e)):t.every((e=>n===Wt[e]))}(r,o)&&Fs(n)}function Fs(e){let t=[];for(const n of e){let e=Ls(en(n));e&&t.push(...e(n))}return t}function js(e,t){let n=en(e);return kt(n)?Nt(n)?e:function(e){for(const t of e)if(!un(t))return t}(t):521===n?function(e,t){let n=mn(e).cols();for(const e of t)if("TABLE"!==e.tagName||n!==mn(e).cols())return e;return null}(e,t):bt(n)||St(n)?e:yn(e,t)}const Ps={focusPrevious(e){gi(wl.get(),e,(e=>Jl(hs(e))))},focusNext(e){_i(wl.get(),e,(e=>Jl(hs(e))))},focusParent(e){wi(wl.get(),e,(e=>Jl(e)))},focusChild(e){vi(wl.get(),e,(e=>Jl(e)))},focusItemTop(){yi(wl.get(),(e=>Jl(e)))},focusSetNext(){let e=wl.get(),t=_l.next(e);t&&t!==e&&Jl(t)},focusSetPrev(){let e=wl.get(),t=_l.prev(e);t&&t!==e&&Jl(t)},click(t,n){let r=wl.get(),o=t.data;if(Ai(n,T.Keys.elemFocus))return Jl(o);if(Ai(n,T.Keys.acrossSelect)){let t=Di(r,o),n=t&&((l=r)===(i=t)?[]:[l,...e.next(l,i,!0)?e.nextUntil(l,i):e.prevUntil(l,i),i]);return t&&n.length&&Wl(new Nl(Ql,n,r),new Sl(t))}var l,i;if(Ai(n,T.Keys.smartSelect)){let e=Di(r,o);return e&&Wl(...ni(e,"turn"))}if(Ai(n,T.Keys.parentFocus)){let e=Hi(o);return e&&Jl(e)}if(Ai(n,T.Keys.parentSelect)){let e=Hi(o);return e&&Wl(...ni(e,"turn"))}if(Ai(n,T.Keys.turnSelect))return Wl(...ni(o,"turn"));_l.has(o)&&r===o&&1===_l.size||Wl(...ni(o,"only"))},__click:1,pathTo(t,n){if(e.intoView(t.data,0),!Ai(n,T.Keys.elemFocus))return Ai(n,T.Keys.turnSelect)?Wl(...ni(t.data,"turn")):void(_l.has(t.data)||Wl(...ni(t.data,"add")));wl.set(t.data)},__pathTo:1,turn(){let e=wl.get();e&&Wl(...ni(e,"turn"))},reverse(){let e=wl.get();e&&Wl(new Nl(ii,e))},siblings(){let t=wl.get();if(!t)return;let n=e.siblings(t);n.length&&Wl(new Nl(Ql,n,t))},tagsame(){let t=wl.get();if(!t)return;let n=e.siblings(t,t.tagName);n.length&&Wl(new Nl(Ql,n,t))},tagsame2(){let t=wl.get();if(!t)return;let n=e.find(`>* >${t.tagName}`,t.parentElement.parentElement);n.splice(n.indexOf(t),1),n.length&&Wl(new Nl(Zl,n,t))},tagsame2x(){let t=wl.get();if(!t)return;let n=t.parentElement,r=null;if("TR"===n.tagName){let e=n.parentElement;r=Ui(t,mn(e.parentElement),e)}else r=e.find(">* >"+`${(o=t).tagName}:nth-child(${e.prevAll(o).length+1})`,n.parentElement);var o;r.splice(r.indexOf(t),1),r.length&&Wl(new Nl(Zl,r,t))},cleanSiblings(){let t=wl.get();if(!t||1===_l.size&&_l.has(t))return;let n=e.children(t.parentElement).filter((e=>_l.has(e)));Wl(new Nl(Rl.removes,n),new Nl(ni,t,"add"))},cleanOthers(){let e=wl.get();!e||1===_l.size&&_l.has(e)||Wl(new Nl(Rl.empty),new Nl(ni,e,"safeAdd"))},contentBoxes(){let e=wl.get();if(!e)return;let t=gn(e);t.some((e=>!_l.has(e)))&&Wl(new Nl(ei,t,"adds"),new Sl(t[0]))},contentBoxesStart(){let e=wl.get();if(!e)return;let t=gn(e);t.some((e=>!_l.has(e)))&&Wl(new Nl(ei,t,"unshift"),new Sl(t[0]))},previous(e){gi(wl.get(),e,((e,t)=>Wl(new Nl(Ql,e,t),new Sl(hs(e)))))},next(e){_i(wl.get(),e,((e,t)=>Wl(new Nl(Ql,e,t),new Sl(hs(e)))))},parent:e=>wi(wl.get(),e,(e=>_l.has(e)||Wl(...ni(e,"add")))),child:e=>vi(wl.get(),e,(e=>_l.has(e)||Wl(new Nl(ti,e,"safeAdd",!0),new Sl(e)))),itemTop(){yi(wl.get(),(e=>_l.has(e)||Wl(...ni(e,"add"))))},onlyPrevious(e){gi(wl.get(),e,(e=>Wl(...ni(hs(e),"only"))))},onlyNext(e){_i(wl.get(),e,(e=>Wl(...ni(hs(e),"only"))))},onlyParent(e){wi(wl.get(),e,(e=>Wl(...ni(e,"only"))))},onlyChild(e){vi(wl.get(),e,(e=>Wl(...ni(e,"only"))))},onlyItemTop(){yi(wl.get(),(e=>Wl(...ni(e,"only"))))},siblingsVF(){Mi(_l),Wl(new Nl(ri,_l,(t=>e.siblings(t))))},tagsameVF(){Mi(_l),Wl(new Nl(ri,_l,(t=>e.find(`>${t.tagName}`,t.parentElement))))},previousVF(t){Mi(_l),t=isNaN(t)?1:t,Wl(new Nl(ri,_l,(n=>e.prevAll(n,((e,n)=>n<=t)))))},nextVF(t){Mi(_l),t=isNaN(t)?1:t,Wl(new Nl(ri,_l,(n=>e.nextAll(n,((e,n)=>n<=t)))))},contentBoxesVF(){let e=[..._l].map((e=>gn(e))).flat();bi(_l,e)||Wl(new Nl(oi,e),new Sl(e[0]))},childVF(t){t=t||0;let n=e.map(_l,(n=>e.children(n,t)));bi(_l,n)||Wl(new Nl(oi,n),new Sl(n[0]))},parentVF(e){let t=new Set;for(const n of _l)wi(n,e,(e=>t.add(e)));t=[...t],bi(_l,t)||Wl(new Nl(li,t),new Sl(t[0]))},itemTopVF(){let e=new Set;for(const t of _l)yi(t,(t=>e.add(t)));e=[...e],bi(_l,e)||Wl(new Nl(li,e),new Sl(e[0]))},selectSort(){let t=e(_l).sort().item();t.length<2||Wl(new Nl(oi,t),new Sl(t[0]))||_s(b.sortCompleted)},selectReverse(){let t=e(_l).sort().item().reverse();t.length<2||Wl(new Nl(oi,t),new Sl(t[0]))||_s(b.sortCompleted)},toText(){let t=e(_l);if(0!==t.length&&function(e){for(const t of e)if(t.childElementCount>0)return!0;return!1}(t))return t.every(Pi)?void Wl(ui(t),new El(Il.toText,t)):ms("need_conelem",function(e){for(const t of e)if(!Pi(t))return t}(t))},__toText:null,unWrap(){let t=e(_l);if(0!==t.length)return t.every(Bi)?void Wl(ui(t,!0),si(),new El(Il.unWrap,t)):ms("both_conelem",function(e){for(const t of e)if(!Bi(t))return t}(t))},__unWrap:null,deletes(){let t=e(_l),n=ci(t,!0);return n&&Wl(ui(t,!0),si(),n),!!n},deleteForce(){let t=e(_l),n=ci(t);n&&Wl(ui(t,!0),si(),n)},deleteContents(){let t=e(_l).map((e=>gn(e))).flat(),n=function(t){if(0!==t.length)return new El((()=>e(t).empty()))}(t);n&&Wl(si(),ui(t),n,ai(t))},elementCloneSelf(t){let n=e(_l);if(!n.length)return;if(n.some(hn))return ms("only_child",zi(n));let r=n.map((e=>Oi(e)));1===r.length&&(r=[Ri(r[0],t)]),Wl(new Sl,ui(n,!0),si(),new El(Il.cloneAfter,n,r),ai(r.flat()))},elementCloneTeam(t){let n=e(_l);if(!n.length)return;if(n.some(hn))return ms("only_child",zi(n));let r=function(e){let t=[e.shift()],n=[t];for(const r of e)r.previousElementSibling===hs(t)?t.push(r):n.push(t=[r]);return n}(n.sort()),o=r.map((e=>hs(e))),l=r.map((e=>e.map((e=>Oi(e)))));1===l.length&&1===l[0].length&&(l[0]=Ri(l[0][0],t)),Wl(new Sl,si(),new El(Il.cloneAfter,o,l),ai(l.flat()))},toUpperCase(){if(!_l.size)return;let t=fs(e(_l)).flat();t.length&&Wl(new Cl(t,(e=>e.toUpperCase())))},toUpperCase1(){if(!_l.size)return;let t=fs(e(_l)).map((e=>e[0]));t.length&&Wl(new Cl(t,(e=>e.replace(/[a-z]/,(e=>e.toUpperCase())))))},toLowerCase(){if(!_l.size)return;let t=fs(e(_l)).flat();t.length&&Wl(new Cl(t,(e=>e.toLowerCase())))},elementFill(){let t=wl.get();if(!t||!_l.size)return;if(_l.has(t))return ms("cannot_selected",t);let n=di(e(_l),t,null,!0);n&&Wl(...n)},elementCloneFill(){let t=wl.get();if(!t||!_l.size)return;if(1===_l.size&&_l.has(t))return;let n=pi(e(_l).clone(),t,null,!0);n&&Wl(...n)},elementAppend(){let t=wl.get();if(!t||!_l.size)return;if(_l.has(t))return ms("cannot_selected",t);let n=di(e(_l),t);n&&Wl(...n)},elementCloneAppend(){let t=wl.get();if(!t||!_l.size)return;let n=pi(e(_l).clone(),t);n&&Wl(...n)},elementBefore(){let t=wl.get();if(!t||!_l.size)return;if(_l.has(t))return ms("cannot_selected",t);let n=di(e(_l),t.parentElement,t);n&&Wl(...n)},elementCloneBefore(){let t=wl.get();if(!t||!_l.size)return;let n=pi(e(_l).clone(),t.parentElement,t);n&&Wl(...n)},elementAfter(){let t=wl.get();if(!t||!_l.size)return;if(_l.has(t))return ms("cannot_selected",t);let n=di(e(_l),t.parentElement,e.nextNode(t));n&&Wl(...n)},elementCloneAfter(){let t=wl.get();if(!t||!_l.size)return;let n=pi(e(_l).clone(),t.parentElement,e.nextNode(t));n&&Wl(...n)},movePrevious(t){let n=e(_l).sort(),r=n[0];if(!((t=isNaN(t)?1:t)<0||!n.length||function(t){let n=e.prevNode(t,!1,!0);return!n||cn(n)}(r)))return n.some(fn)?ms("has_fixed2",function(e){for(const t of e)if(fn(t))return t}(n)):void Wl(new El(Il.movePrev,ki(n),t))},moveNext(t){let n=e(_l).sort(),r=hs(n);if(!((t=isNaN(t)?1:t)<0||!n.length||function(t){let n=e.nextNode(t,!1,!0);return!n||fn(n)}(r)))return n.some(cn)?ms("has_fixed1",function(e){for(const t of e)if(cn(t))return t}(n)):void Wl(new El(Il.moveNext,ki(n),t))},indentReduce(){let t=e(_l);if(t.length)return As(t)?void Wl(new El(Il.sectionsUp,t)):ms("only_section",Li(t))},indentIncrease(){let t=e(_l);if(!t.length)return;if(!ks(t))return ms("only_section",Li(t));let n=function(e){let t=[];for(const n of e){let e=en(n);t.push([n,$r(e,{h2:b.sectionH2})])}return!!t.length&&t}(t);Wl(new El(Il.sectionsDown,n))},reversePlaces(){let t=e(_l).sort(),n=ki(t);if(!(t.length<2||n.every((e=>e.length<2))))return t.some(dn)?ms("has_fixed",function(e){for(const t of e)if(dn(t))return t}(t)):void Wl(new El(Il.reverses,n))},contentsMerge(){let t=e(_l),n=t.shift();if(!t.length)return;let r=Ms(n,t);if(!r)return ms("merge_types",js(n,t));Wl(ui(t,!0),si(),new El(Il.merges,n,r,t),...ni(n,"safeAdd"))},normalize(){let t=new El((()=>e.normalize(zl)));t.changed()&&Wl(t)},moveToLeft(){let e=[..._l],t=xi(e,"left",-1);t&&Wl(t,Ei(e,"right"),new $l(!0))},moveToLeftTen(){let e=[..._l],t=xi(e,"left",-10);t&&Wl(t,Ei(e,"right"),new $l(!0))},moveToRight(){let e=[..._l],t=xi(e,"left",1);t&&Wl(t,Ei(e,"right"),new $l(!0))},moveToRightTen(){let e=[..._l],t=xi(e,"left",10);t&&Wl(t,Ei(e,"right"),new $l(!0))},moveToUp(){let e=[..._l],t=xi(e,"top",-1);t&&Wl(t,Ei(e,"bottom"),new $l(!0))},moveToUpTen(){let e=[..._l],t=xi(e,"top",-10);t&&Wl(t,Ei(e,"bottom"),new $l(!0))},moveToDown(){let e=[..._l],t=xi(e,"top",1);t&&Wl(t,Ei(e,"bottom"),new $l(!0))},moveToDownTen(){let e=[..._l],t=xi(e,"top",10);t&&Wl(t,Ei(e,"bottom"),new $l(!0))},paste(e,t){let n=[..._l].map((e=>gn(e))),r=n.flat(),o=t?"appends":"fills";r.length&&Wl(ui(r),...function(e,t,n){return 1===e.length?[fi(e[0],t.join("\n"),n)]:(1===t.length&&(t=new Array(e.length).fill(t[0])),e.map(((e,r)=>fi(e,t[r],n))))}(n,e.data,o))},__paste:1,setStyle(t,n,r){(function(t,n,r){return e.isArray(n)?t.some((e=>n.some((t=>e.style[t]!==r)))):t.some((e=>e.style[n]!==r))})(t.data,n,r)&&Wl(new El(Il.styles,t.data,n,r),new $l)},__setStyle:1,eraseStyle(e,t){let n=null;t=t.split(ol);for(const r of e.data)if(os(r,t)){n=!0;break}n&&Wl(new El(Il.styles,e.data,t,null),new $l)},__eraseStyle:1,brushStyle(t){let n=t.data,r=e.attr(n,"style"),o=_l.size,l=null;!r||!o||1===o&&_l.has(n)||(_l.has(n)&&(l=new Nl(Rl.delete,n)),Wl(l,new El(Il.attrs,[..._l],"style",r),new $l))},__brushStyle:1,clearStyle(t){let n=null;for(const r of t.data)if(null!==e.attr(r,"style")){n=!0;break}n&&Wl(new El(Il.styles,t.data,null),new $l)},__clearStyle:1,attrUpdate(e,t){1===_l.size&&Wl(new El(Il.attrs,[..._l],t,e.data),new $l)},__attrUpdate:1,deleteAttr(e){Wl(new El(Il.attrs,[..._l],e.data,null),new $l)},__deleteAttr:1,htmlUpdate(t){if(1!==_l.size||!t.data.length)return;let n=[..._l],r=function(t){let n=e.fragment(t);for(const t of e.find(nl,n))e.removeClass(t,tl);return e.contents(n)}(t.data);Wl(ui(n,!0),si(),new El((()=>e.replace(n[0],r))))},__htmlUpdate:1,runScript(t,n,r,o){let l=t.data.trim();if(!l)return null;if("editor"===n){let t=new Tl(ns,l,e(_l));return t.changed()&&(t.warn(b.undoWarn),Wl(t)),t.result()||Yr(l)||null}return function(e){let t=On.pick();return new Promise(((n,r)=>{t.onmessage=e=>{t.onmessage=null,On.add(t),e.data.error?r(e.data.error):n(e.data.result)},t.postMessage(e)}))}(ts(_l,{code:l},r,o)).then((e=>({type:"value",data:e,code:l}))).catch((e=>({type:"error",data:e,code:""})))},__runScript:1,insResult(t,n,r){let o=t.data.trim(),l=[..._l];if(!l.length||!r||!o)return;let i=function(e,t){for(const n of e)if(!Vi(n,t))return n;return null}(l,r);if(i)return ms("cannot_append",i);let s=function(t,n){switch(t){case"text":return e(e.Text(n,!0));case"html":return e(e.fragment(n).children)}throw new Error("can't to here.")}(n,o),a=si(),u=l.map((e=>function(e,t,n){return mi(...{prepend:[null,e],append:[null,e],fill:[null,e],before:[e,e.parentElement],after:[e,e.parentElement],replace:[e,e.parentElement]}[t],n)}(e,r,s.clone())));Wl(new Sl,a,new El(Il.alignInsert,l,r,u))},__insResult:1,propUpdate(t,...n){let r=[..._l],o=(l=en(r[0]),uo[l]||((t,n,r)=>e.attr(t,n,r)));var l;if(1===r.length)return Wl(new El(o,r[0],t.data,...function(e,...t){let n=co[en(e)];return n?n(e,...t):function(e){return e.map((e=>""===e?null:e))}(t)}(r[0],...n)),new $l(!0));let i=function(e,...t){let n=en(e[0]),r=fo[n];return r?r(e,...t):xo(e,function(e){return e.map((e=>""===e||null===e?void 0:e))}(t))}(r,...n);Wl(...r.map(((e,n)=>new El(o,e,t.data,...i[n]))))},__propUpdate:1,cmdRun(t,n){let r=t.data,o=r.trim()&&ys[n](vs[n],r);return Zo(n).add(t.data),e.isArray(o)?(Xi(zl,"focus.content",null,!0),Wl(...o)||null):o},__cmdRun:1,pluginsRun(t){let o=(i=t.data,Ao.get(i)||null),l=e.attr(t.data,"title")||"";var i;if(!o)throw new Error("not found the plugins.");return function(e,t){let n=new Worker(e);return new Promise(((e,r)=>{n.onmessage=t=>{n.terminate(),t.data.error?r(t.data.error):e(t.data)},n.postMessage(t)}))}(`${w}${v.plugRoot}/${o}/${v.plugMain}`,ts(_l,{INFO:{}},!0,!0)).then((e=>function(e,t,o){let l=n.get(t);return o=e.title||o,e.node&&!e.error?[e.result,l.node(e.node),o]:(l=n.get(r),[e.error||e.result,l.node(v.plugResult),o])}(e,o,l)))},__pluginsRun:1,editUndo(){e.trigger(zl,m.undoEvent,Vl?(document.execCommand("undo"),document.queryCommandEnabled("undo")):(Ll.undo(),Ll.canUndo()),!0)},editRedo(){e.trigger(zl,m.redoEvent,Vl?(document.execCommand("redo"),document.queryCommandEnabled("redo")):(Ll.redo(),Ll.canRedo()),!0)},miniedIn(){let e=_l.first();if(e){if(!un(e))return Jl(e),ms("need_conelem",e);Wl(...Ci(e)),Vl.active()}},miniedInEnd(){let e=_l.first();if(e){if(!un(e))return Jl(e),ms("need_conelem",e);Wl(...Ci(e)),Vl.activeEnd()}},properties(){let t=e(_l),o=Os(t);if(!o)return ms("not_property",t[0]);!function(t){n.get(r).get(m.modalProp).then((n=>e.trigger(Pl,"open",[t,n])))}(o)}},Bs={undo(){Ps.editUndo()},redo(){Ps.editRedo()},sels:()=>e(_l),esize:()=>_l.size,sel0:()=>ps(_l)||null,efocus:()=>wl.get(),tobj:()=>_l.size?mn(function(e){switch(e.tagName){case"TR":return e.parentElement.parentElement;case"TBODY":case"THEAD":case"TFOOT":case"CAPTION":return e.parentElement;case"TH":case"TD":return e.parentElement.parentElement.parentElement;case"TABLE":return e}throw new Error("not in table element.")}(_l.first())):null,trbox(){let e=_l.first();return"TR"===e.tagName?e.parentElement:e},tsecbox(){let e=_l.first();return"TABLE"===e.tagName?e:e.parentElement},codebox(){let e=_l.first();if(!e)return null;switch(en(e)){case 526:return e.firstElementChild;case ne:case Ze:return e;case Ue:return e.parentElement}throw new Error("bad type of element.")},attrns:e=>[...e.data.attributes].map((e=>e.name)),__attrns:1,obtname(t){let n=t.data,r=e=>gl.has(e)?ml:e.replace(ol,"");return e.isArray(n)?[...new Set(n.map(r))]:r(n)},__obtname:1,obtsplit:e=>(xl.reset(),e.data.map((e=>e?[...xl.split(e)].map((e=>e.trim())):[]))),__obtsplit:1,obtval:e=>function([e,t,n]){return t.length=cs(t),n.length=cs(n),e.length=Math.max(cs(e),t.length,n.length),[e,t,n]}(e.data.map((e=>e.map(us).map((e=>e||"-"))))).map((e=>e.join(";\n")||null)),__obtval:1,source:e=>ql(e.data),__source:1,rngok(e){let t=e.data.commonAncestorContainer;e.data.detach(),3===t.nodeType&&(t=t.parentElement);let n=en(t);return kt(n)&&n!==ne},__rngok:1,menupos(t,n,[r,o]){let l=e.outerWidth(t.data),i=e.offset(n),s=e.innerWidth(n),a=o-i.top+e.scrollTop(n)+g.popupGapTop;return r+l<s+i.left?[r-i.left+"px",`${a}px`]:[s-l-g.popupGapRight+"px",`${a}px`]},__menupos:1,submenu(t){let n=e.parent(t.data),r=e.outerWidth(n)-1+"px",o=e.children(t.data,-1),l=parseFloat(e.css(n,"right"));return e.outerWidth(o)>l?{left:"auto",right:r}:{left:r,right:"auto"}},__submenu:1,convtype(){let e=new Set;for(const t of _l)e.add(Ar(t));if(e.size>1)return null;let t=ps(e);return t===m.convLines?m.convBlocks:t},__convtype:null,roleinfo(t,n){let r=e.attr(t.data,"role");return r?`${n}:${r}`:n},__roleinfo:1,elemSelf(e){let t=e.data;return t?Qi(t).replace(ul,""):null},__elemSelf:1,cmenable(t){let n=[..._l];return 0===n.length?[]:e.map(Rs,((e,r)=>e(n)?t.data[r]:null))},__cmenable:1,inslist(e,t){if(!e.data.length)return null;let o=pl[t](e.data),l=n.get(r);return o.length?o.map((e=>l.node(e))):null},__inslist:1,ismixed:e=>(e.data===m.levelName1?[...Gi(_l)]:[..._l]).some((e=>al.test(e.tagName)&&3===Lt(e))),__ismixed:1,pretreat2(e,t,n){let r=e.data;return r=n?r.trim().split(ll):[r],t?r.map((e=>e.trim().replace(il,"$1"))):r},__pretreat2:1,pretreat1(t,n){let r=t.data;return e.isArray(r)?n?r.map((e=>e.replace(il,"$1"))):r:n?r.trim().replace(il,"$1"):r},__pretreat1:1,splitx:(e,t)=>e.data.trim().split(t?ll:sl),__splitx:1,k3edit(t,n,r,o,l){let i=Yn(r,!0,t.data),s=o&&+e.val(o);switch(n){case"Enter":return`\n${a=i,a.substring(0,qn(a,1/0))||" "}`;case"Tab":return function(e,t){return t>0?" ".repeat(t-Jn(e)%t):"\t"}(i,s)}var a;return s>0&&!r.toString()&&i.endsWith(" ".repeat(s))&&(l&&(s=i.length),r.setStart(r.endContainer,r.endOffset-s),r.setEnd(r.endContainer,r.endOffset)),null},__k3edit:1,indentcut(e,t){if(t)return e.data;let n=e.data.split(sl).filter((e=>!!e)),r=function(e){let t=1/0;for(const n of e)if(t=qn(n,t),!t)return 0;return t}(n);return r?n.map((e=>e.substring(r))).join("\n"):e.data},__indentcut:1,hlcode:(e,t,n)=>Qn(e.data.split(sl),n,t),__hlcode:1,codels:e=>io(null,e.data,lo),__codels:1,codeblo:(e,{lang:t})=>io(t,e.data,oo),__codeblo:1,image3:(t,n)=>"svg"===n?e.svg({html:t.data}):Un(t.data).then((e=>$r(F,function(e){let[t,n]=e;return"string"!=typeof t&&([n,t]=[t,n]),Object.assign({src:t},n)}(e)))),__image3:1,mediasubs(e,t){let n=Yi(e.data.trim(),P);return void 0===t?n:Promise.all([n,Yi(t.trim(),j)])},__mediasubs:1,picsubs:e=>Yi(e.data.trim(),B),__picsubs:1,cbstate(e,t,n){if(!e.data.length)return null;let r=e.data[0].style[t]===n;for(const o of e.data.slice(1)){if(o.style[t]===n!==r)return[!1,!0]}return[r,!1]},__cbstate:1,styVal:(t,n)=>t.data.length?e.isArray(n)?n.map((e=>ls(t.data,e))):ls(t.data,n):null,__styVal:1,unitVal(e){let t=e.data[0].value,n=e.data[1].value;return isNaN(parseFloat(t)-t)?t:t+n},__unitVal:1,styName:(e,t)=>e.data.length?t.split(ol).filter((t=>function(e,t){return e.every((e=>""!==e.style[t]))}(e.data,t))):null,__styName:1,styKey:(e,t)=>e.data.length?t.split(ol).filter((t=>function(e,t){return t+=":",e.every((e=>e.style.cssText.includes(t)))}(e.data,t))):null,__styKey:1,cleanHTML:e=>Zi(e.data),__cleanHTML:1,mdline:t=>x.mdline&&t.data?e.isArray(t.data)?t.data.map((t=>e.fragment(jn(t)))):e.fragment(jn(t.data)):t.data,__mdline:1,cmdclear(){this.cmdNavTemp=null},savedhtml:()=>bl.get(m.storeMain),ecancel(){(_l.size||wl.get())&&Wl(new Sl(null),new Nl(Rl.empty))},puthtml(t){let n=e.fragment(t.data);Wl(new Sl(null),si(),new El((t=>e.fill(zl,t)),[...n.childNodes]))},__puthtml:1,heading(t){if(zl.childElementCount>0)return;Wl(new El((t=>e.prepend(zl,t)),e.elem("h1",t.data)))},__heading:1,errmsg(e,t){Ai(t,T.Keys.elemFocus)&&Jl(e.data)},__errmsg:1,chapter(t){let n=e.get(t.data.map((e=>`>section:nth-of-type(${+e})`)).join(" ")+" >h2",e.get("article",zl));n&&e.intoView(n,1,1)},__chapter:1,save(t){let n=e(t.data.children).map(Zi).join("");return m.saver(n)||bl.set(m.storeMain,n),b.localStoreDone},__save:1,export:t=>(t.data.length?t.data:e.children(zl)).map(Zi).join(""),__export:1,export2(t){let n=es(zl),r=e.get("article",n);return $s(507,$r(507,{h4:t.data},r),n),e.html(n)},__export2:1,nicehtml(t,n){let r=isNaN(n)?"\t":" ".repeat(n),o=[...e.fragment(t.data).children];try{return o.map((e=>Fn(e,r))).join("").trim()}catch(t){e.trigger(e.get(`#${v.sourceTips}`),"show")}},__nicehtml:1,blankline(e,t,n){if(!t)return;let r=Yn(n,!0,e.data);r.length>1||" "!==r[0]||(n.setStart(n.endContainer,n.endOffset-1),n.setEnd(n.endContainer,n.endOffset))},__blankline:1,toclist:t=>mr(e.find(">section",t.data)),__toclist:1,medpass(t,n){let r=function(){Vl.done();let t=Vl.elem();return Gl(),"H2"===t.tagName&&e.trigger(Fl,m.medOk,t),e.trigger(zl,m.medOk,null,!0),e.trigger(jl,"show"),e.trigger(Bl,m.insType,m.normalTpl),Xi(Kl,m.evnFollow),Vl=null,t}();if("Tab"===t.data)return Ps.miniedIn();let o=Si(n,r);o&&(Wl(...o),Vl.active())},__medpass:1,medcancel(){Ll.pop(),Gl(),Vl=null,e.trigger(jl,"show"),e.trigger(Bl,m.insType,m.normalTpl)},__medcancel:null,rngelem(e,t){let n=e.data.commonAncestorContainer;3===n.nodeType&&(n=n.parentElement);let r=si(),o=new Al(e.data,t),l=o.elem();Wl(r,o,new Nl(ti,l,"safeAdd"),new Sl(l)),function(e,t){return hl.has(e)&&!t.completed()}(t,o)&&Ps.properties()},__rngelem:1,cmenudo(e){let t=dl[e.data];t&&Ps[t]()},__cmenudo:1,convert(e){if(!_l.size)return;let t=[..._l],n=ui(t,!0),r=si(),[o,l]=Es(e.data,t);Wl(n,r,o,ai(l)),hl.has(e.data)&&Ps.properties()},__convert:1,croptr(t,n){if(n<=0)return;let r=t.data,o=n-r.rows.length;o&&function(t,n,r){if(n<0)return t.removes(n,null,r);t.inserts(n,null,r).map((e=>[...e.children])).flat().forEach((t=>e.attr(t,"contenteditable",!0)))}(e.table(r.parentElement),o,r)},__croptr:1,colcrop(t,n){if(n<=0)return;let r=e.table(t.data),o=n-r.cols()+1;o&&function(t,n){if(n<0)for(;n++<0;)t.removeColumn(-1);else(function(e,t){let n=[];for(;t-- >0;)n.push(e.insertColumn(e.newColumn()));return n})(t,n).flat().forEach((t=>e.attr(t,"contenteditable",!0)))}(r,o)},__colcrop:1,inserts(t,n,r){let o=[..._l],l=function(t,n){if(n<2)return[t];if(t.length>1)return t;let r=t[0];for(let o=0;o<n-1;o++)t.push(e.clone(r));return t}(e(t.data),o.length),i=si(),s=function(e,t,n,r){return e.map(((e,o)=>null!=t[o]&&new El($i[r][+n],e,t[o])))}(o,l,n,r),a=l.flat().filter((e=>1===e.nodeType&&!sn(e)));Wl(i,...s,ai(a),a[0]&&new Sl(a[0]))},__inserts:1,topinsert(e,t){let n=_l.first(),r=t===m.levelName1?n.parentElement:n;Wl(si(),Ss(r,e.data,Ts),...ni(e.data,"safeAdd"))},__topinsert:1,fixinsert(t,n){let r=n===m.levelName1?[...Gi(_l)]:[..._l],o=function(t,n){if(t=ds(t),n<2||t.length>1)return t;let r=t[0];for(let o=0;o<n-1;o++)t.push(e.clone(r));return t}(t.data,r.length);Wl(ui(r),si(),...function(e,t){let n=[];return e.forEach(((e,r)=>null!=t[r]&&n.push(Ss(e,t[r],Cs)))),n}(r,o),ai(o),new Sl(o[0]))},__fixinsert:1,instbody(t,n,r){let o=t.data,l=_l.first(),i=r===m.levelName1?l.parentElement:l,s=mn(i),a=ui([i]),u=si(),c=null;n?("TBODY"!==l.tagName&&(l=s.body(!0)),c=new El(Il.newAppend,l,e.children(o)),o=null):("TBODY"!==l.tagName&&(l=e.get("tbody:last-of-type",i)),c=new El(Il.newAfter,l,o)),Wl(a,u,c,...ni(o||l,"safeAdd"))},__instbody:1,table(e,t,[n,r,o,l]){let i=e.data,s=o?"":":not(:first-child)",a=o?"th,td":"td",u=Ji(r&&i.tHead,`th${s}`),c=Ji(i.tBodies[0],a),f=Ji(l&&i.tFoot,a);return $r("table",{cols:c[0].length-!!o,border:n,caption:t,th0:o=!!o,head:u,foot:f},c,!0)},__table:1,codelang(t,n,r){let o=t.data;if(n===e.attr(r,"-lang"))return o;for(const t of o)e.attr(t,"-lang")||e.attr(t,"-lang",n);return o},__codelang:1,checkhtml(t,n){let r=e.fragment(n),o=is(t.data.parentElement,e.contents(r));return o?o.map(ss):null},__checkhtml:1,attrlist(t,n){let r=new Set(n);for(const n of t.data){let t=e.prop(n,"value");r.has(t)?r.delete(t):e.remove(n)}return[...r]},__attrlist:1,obtline(t,n,r,o){let l=e.siblingNth(t.data);return l<n.length&&n.splice(l,0,""),l<r.length&&r.splice(l,0,""),l<o.length&&o.splice(l,0,""),e.prop(e.clone(t.data),"text",null)},__obtline:1,obtdel(t,n,r,o){let l=e.siblingNth(t.data)-1;return n.splice(l,1),r.splice(l,1),o.splice(l,1),t.data},__obtdel:1,obtswap(t,n,[r,o,l]){let i=t.data;return"ArrowUp"===n?function(t,n,r,o){let l=e.prev(t);return l?(as(e.siblingNth(l),n,r,o),[l,"after"]):null}(i,r,o,l):function(t,n,r,o){let l=e.next(t);return l?(as(e.siblingNth(t),n,r,o),[l,"before"]):null}(i,r,o,l)},__obtswap:1,cmdlast(t,n,r){let o=n.selectionStart,l=Zo(t.data).find(n.value.substring(0,o));this.cmdNavTemp=new Go(l);let i=r?this.cmdNavTemp.last():this.cmdNavTemp.first();i&&e.val(n,i).setSelectionRange(o,i.length)},__cmdlast:1,cmdnext(t){let n=t.data,r=n.selectionStart,o=this.cmdNavTemp&&this.cmdNavTemp.next();o&&e.val(n,o).setSelectionRange(r,o.length)},__cmdnext:1,cmdprev(t){let n=t.data,r=n.selectionStart,o=this.cmdNavTemp&&this.cmdNavTemp.prev();o&&e.val(n,o).setSelectionRange(r,o.length)},__cmdprev:1,cmdNavTemp:null};
//! $ID: api.js 2021.10.21 Cooljed.Base $
let Ks;s(h,"Ed",Ps,["click","pathTo","toText","unWrap","setStyle","eraseStyle","brushStyle","clearStyle","attrUpdate","deleteAttr","htmlUpdate","runScript","insResult","propUpdate","cmdRun","pluginsRun","deletes","paste"]),s(h,"Kit",Bs,["ecancel","puthtml","heading","errmsg","chapter","save","export","export2","nicehtml","blankline","toclist","medpass","medcancel","rngelem","cmenudo","convert","croptr","colcrop","inserts","topinsert","fixinsert","instbody","table","codelang","checkhtml","attrlist","obtline","obtdel","obtswap","cmdlast","cmdnext","cmdprev"]),a(_,null,Bs,["sels","esize","sel0","efocus","elemSelf","tobj","trbox","tsecbox","codebox","attrns","obtname","obtsplit","obtval","source","rngok","menupos","submenu","convtype","roleinfo","cmenable","inslist","ismixed","pretreat2","pretreat1","splitx","k3edit","indentcut","hlcode","codels","codeblo","image3","mediasubs","picsubs","cbstate","styVal","unitVal","styName","styKey","cleanHTML","mdline","savedhtml","cmdclear"]),window.ESet=_l,window.History=Ll;const Vs={init(t){Ks=e.get(t)},heading(t){let n=e.get("h1",Ks);if(void 0===t)return n&&e.html(n);Xl(),n||(n=e.prepend(e.get("hgroup",Ks)||Ks,e.elem("h1"))),e.html(n,t)},subtitle(t,n){let r=e.get("hgroup",Ks),o=r?e.find(">h3",r):[];if(void 0===t)return o.map((t=>e.html(t)));Xl(),r||(r=e.prepend(Ks,e.elem("hgroup"))),n||o.forEach((t=>e.remove(t))),e.append(r,e(Ws(t)).Element("h3"))},abstract(t,n){let r=e.get(">header[role=abstract]",Ks);if(void 0===t&&void 0===n)return r&&Gs(r);Xl(),Xs(t,n,r,Ge)},article(t){let n=e.get("article",Ks);if(void 0===t)return n&&e.html(n);Xl(),$s(512,e.Element("article",t))},seealso(t,n){let r=e.get(">aside[role=seealso]",Ks);if(void 0===t&&void 0===n)return r&&qs(r,"ul");Xl(),Js(t,n,r,"ul",509)},reference(t,n){let r=e.get(">nav[role=reference]",Ks);if(void 0===t&&void 0===n)return r&&qs(r,"ol");Xl(),Js(t,n,r,"ol",508)},footer(t,n){let r=e.get(">footer",Ks);if(void 0===t&&void 0===n)return r&&Gs(r);Xl(),Xs(t,n,r,qe)},content(t){if(void 0===t)return e.html(Ks);Xl(),e.html(Ks,t)},toc:(t=b.tocLabel)=>$r(507,{h4:t},e.get("article",Ks)).outerHTML,theme(t){let n=e.get(`#${v.styleTheme}`);return void 0===t?n.href:Ys(n,t)},style(t){let n=e.get(`#${v.styleMain}`);return void 0===t?n.href:Ys(n,t)},codes(t){let n=e.get(`#${v.styleCodes}`);return void 0===t?n.href:Ys(n,t)}};function Ws(t){return e.isArray(t)?t:[t]}function Gs(t){let n=e.get("h4",t);return[n&&e.html(n),e(">*",t).not("h4").prop("outerHTML").join("")]}function Xs(t,n,r,o){let l=r&&e.get("h4",r),i=r&&e(">*",r).not("h4");$s(o,$r(o,{h4:t||l&&e.text(l)},n?[...e.fragment(n).children]:i,!0))}function qs(t,n){let r=e.get("h4",t),o=e.get(`>${n}`,t);return[r&&e.html(r),o&&e.children(o).map((t=>e.html(t)))]}function Js(t,n,r,o,l){let i=r&&e.get("h4",r),s=r&&e.get(`>${o}`,r);n&&(s=e.elem(o),e.append(s,e(Ws(n)).wrap("<li>"))),$s(l,$r(l,{h4:t||i&&e.text(i)},s))}function Ys(t,n){return e.style({id:t.id,href:n},t).then((()=>e.remove(t)))}
//! $ID: main.js 2019.11.16 Cooljed.User $
window.GHK=(new f).config(T.Global),window.SHK=(new f).config(T.Slave),window.DHK=(new f).config(T.Modal),window.CHK=new d(Ps).config(T.Content),window.Sys=m,window.Kit=Bs,window.KM=T.Keys,window.edInit=function(t,o,l,i,s,a,u,c,f,d){zl=e.get(t),Ul=e.get(o),Kl=e.get(l),Dl=e.get(i),Hl=e.get(s),Ml=e.get(a),Fl=e.get(u),jl=e.get(c),Pl=e.get(f),Bl=e.get(d),Object.assign(vs,{[y.select]:new jo(_l,zl),[y.filter]:new Po(_l),[y.search]:new Bo(zl),[y.command]:new Ko(_l),[y.calcuate]:new Vo(_l,zl)}),Qo(e.get("#x-help"),n.get(r).node(m.modalPlug)),e.on(zl,"attrdone styledone nodesdone emptied detach normalize propdone",null,yl)},window.Api=Vs,window.ESC=new Cn,e.config({varyevent:!0}),u.build(window,{on:`${m.recover}|savedhtml dup pass`,to:"main.content|html"},_,h),u.init(_,h).config(o).then((e=>e.build(document))).then((()=>e.trigger(document.body,"finish"))).then((()=>Vs.init("#content"))).then((()=>m.readyCall())).catch((e=>m.failCall(e))).then((()=>m.contenter())).then((t=>null!=t&&e.html(e.get("main#content"),t))),l&&(window.On=_,window.By=h,window.Tpls=n.get(r));
