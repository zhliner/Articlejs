<!DOCTYPE html>
<html><head>
<meta charset="utf-8" />
<meta http-equiv="no-cache">
<title>Happy editing...</title>
<link rel="stylesheet" href="tpb/pb.css" />

<!-- tools -->
<script src="jquery-2.0.3.js"></script>
<script src="tpb/jquery.tpb.js"></script>

<!-- base -->
<script src="tpb/core.js"></script>
<script src="tpb/pb.core.js"></script>
<script src="tpb/pb.act.js"></script>

<!-- app-support -->
<script src="tpb/render.js"></script>
<script src="tpb/app.js"></script>
<script src="tpb/pb.app.js"></script>

<!-- apps -->
<script src="jced.js"></script>
<script src="config.js"></script>

<!-- apps: based file -->
<script src="utility.js"></script>
<script src="jced.pb.js"></script>
<script src="api.js"></script>

<!-- config setting -->
<script>
    // 配置优先级：
    // localStorage（用户） > 调用指定 > 系统默认
    var __D = frameElement._Data,
        __C = jcEd.Config,
        __W = __C.Word,
        _id = __D.option.id;

    // 键完整
    __W.Local += _id;
    __W.Head += _id;
    __W.Text += _id;

    var _conf = __C.local,
        _temp = jcEd.Utility.storage(__W.Local),
        _opts = _temp ? $.extend(__D.option, _temp) : __D.option;

    if (!_opts.lang) _opts.lang = _conf.language;
    if (!_opts.theme) _opts.theme = _conf.theme;
    if (!_opts.style) _opts.style = _conf.style;

    $.extend(jcEd.CallBack, __D.calls);
    jcEd.CallBack.edIndex = _id;

    if (!_opts.width) __D.ebox.style.width = _conf.width + 'px';
    if (!_opts.height) __D.ebox.style.height = _conf.height + 'px';
</script>

<!-- app running -->
<script>
$(document).ready(function() {
	new $.Tpb.Loader(_conf.setup)
	.json('config.json', function(data, loader) {
		jcEd.set({
			'root': _conf.setup,
			'lang': _opts.lang,
			'exts': data.root.plate,
			'tpls': data.root.template,
			'l10n': data.root.locale,
		});
		jcEd.Core.loadLibs(function() {
			jcEd.Store.init(__D.store);
			// 上层元素存储
			jcEd.Store.set(__W.elH1, __D.option.heading);
			jcEd.Store.set(__W.elText, __D.option.textarea);
			// 命令行导航
			jcEd.Core.initCmdline();
			jcEd.run({
				'main': 'editor.html',
				'l10n': 'editor.json',
				// 'list': '_list.json',  // 节点清单（filename:[tpl-name]）
				'cbox': document.body,
				'done': function() {
					jcEd.Core.initSize(__D.ebox);
					jcEd.Core.useCalls(__D.option.api);

					$('#app-root').trigger('finish', {
						'theme':  _opts.theme,
						'style':  _opts.style,
						'time':   _opts.datetime || 0,
						'recover': _opts.recover || false,
					});
					jcEd.Api.init();
					jcEd.CallBack.call('onready');
				}
			});
		});
		loader
		.style('theme/' + _opts.theme + '/style.css')
		.style('base/system.css')
		.style('styles/' + _opts.style + '.css');
	});
});
</script>

<style>
audio#page-beep {
    position: absolute;
    visibility: hidden;
    z-index: -1;
}
</style>
</head>
<body lang="">

<aside>
	<!-- 大纲栏：定时/手动更新。可隐藏。 -->
</aside>

<main>
	<!-- 编辑器区域：工具栏，编辑区，录入面板，状态栏/命令行 -->
</main>

<aside>
	<!-- 帮助栏：固定时占用空间。可隐藏。 -->
</aside>

<!-- 提示音 -->
<audio id="page-beep" src="../pub/beep.ogg"></audio>

</body>
</html>
