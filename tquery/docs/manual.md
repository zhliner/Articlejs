# tQuery（类 jQuery）使用手册

## 前言

传统的 `jQuery` 接口使用十分方便，性能强大，但在 `ES6` 正式推出以后，以及随着 `HTML5/CSS3` 的逐步成熟，个人感觉 `jQuery` 的历史负担过重。于是想轻装上阵，编写了一个类 `jQuery` 的工具 `tQuery`。它类似于 `jQuery`，但采用 `ES6` 语法编写（不考虑浏览器兼容性），并且仅包含 `jQuery` 中有关 `DOM`、`CSS` 和 `Event` 的部分，即省略了 `Ajax`、`Deferred` 和 `Effect` 等，省略的部分交由 `ES6/HTML5` 中原生的 `Fetch`、`Promise` 和 `CSS3` 来解决。

大部分接口与 `jQuery` 中相似，少部分地方略有变化，也有一些小的扩展和增强，如支持嵌入代理（见 `$.embedProxy`），用户可以修改 `$` 的默认行为。

> **注：**<br>
> `tQuery` 名称里的 `t` 来源于 `Tpb` 里的 `Template`，但也可以视为 `tiny-Query` 吧。<br>
> 如果您想先简单浏览一下 `tQuery` 的接口情况，可以打开 `test.html` 然后在浏览器控制台执行 `console.dir($)` 或 `console.dir($(''))` 看看。<br>



## Api 设计

`jQuery` 中对检索结果集的操作，在这里都有一个**单元素**的版本，如：`$.next(el, slr)`、`hasClass(el, names)` ，以及相应的集合版本，如：`$('xx').next(...rest)`、`$('xx').hasClass(...rest)`。单元素版通常返回 `$` 本身，而集合版则会返回一个元素集（`Elements` 类型，继承于数组），与 `jQuery` 类似，`Elements` 的实例可以链式调用。

虽然大多数情况下同名的接口行为相似，但有些地方区别依然明显。如对元素集的属性取值，`jQuery` 中是仅取集合内**首个元素**的值，如 `$('a').attr('href')` 取首个 `<a>` 元素的 `href` 属性值，而 `tQuery` 中则会返回集合里全部元素的属性值（作为一个数组）。

又如 `$.html` 接口，`jQuery` 中它既可以处理文本，也可以处理节点元素，效果与连续的 `$.empty().append()` 调用相同。但在 `tQuery` 中该接口就只负责文本逻辑，设置元素内容时接收文本参数，获取源码时接收节点参数，即该接口不会删除 `DOM` 中已有的元素，另外还扩展了功能，可转换源码或指定覆写方式（如 `fill`、`append`、`before` 等）。

本设计还规范了名称指定，在接口参数中仅类名和事件名支持空格分隔的多名称指定，其它元素属性则无此待遇，必须用数组形式传递多个名称。另外在实现上，事件为 `DOM` 原生事件（无侵入），元素上也不存储任何数据，以便于JS的垃圾回收。

总体上，`tQuery` 的设计尽量精简，主要是提供 `DOM` 节点操作相关的 API（元素、属性、事件等），其它事情则交由外部环境（`ES6`、`CSS3` 等）去处理。


## 接口参考

### 基本工具


### 节点遍历


### 节点过滤


### 节点操作


### 元素属性


### 文本操作


### CSS 相关


### 事件扩展


### 元素集（Elements）



## 附：与jQuery同名接口存在的差异（简表）

- `.contains`
    - jQuery：仅针对内部子孙元素，不含容器元素自身测试。
    - tQuery：包含容器元素自身测试，与DOM同名接口行为相同。

- `.hasClass`
    - jQuery：对空格分隔的名称序列视为一个整体。
    - tQuery：空格分隔的名称序列被视为多个名称，逐个判断，因此 `class="A B"` 与 `class="B A"` 是一样的。

- `$().is`
    对集合中每一个元素判断，返回一个true和false值混合的集合。需用数组的some或every作进一步详细的判断。

- `$.data`
    没有该接口，元素的data-xx系属性融入在attr和prop接口中，且支持名称简写（-xx，无前置data词）。



## 附：嵌入代理（$.embedProxy）的应用

### plugins/tracker.js

追踪用户对页面元素的修改操作，提供回溯（Undo/Redo）的简便处理方式。
