# $.Later( evn, handle, over? ): Function

封装事件处理器（`handle`）的进一步事件（`evn`）激发，主要用于两个事件间的联动。

行为是：根据 `handle` 的返回值决定后续行为，如果 `handle` 返回假值，则不再激发 `evn`，否则对返回的元素（集）或配置对象（集）逐一激发目标事件（`evn`）并传递可能有的额外数据。


## 参数

### evn: String

待激发的事件名，仅支持简单名称（单个）。**注**：采用 `$.trigger` 激发。


### handle: Function | Object

前阶处理器，可以是函数或一个实现了 `EventListener` 接口的对象。

处理器接口：`function(ev, elo): Element | [Element] | Object | [Object] | false`，其中 `Object` 是一个配置对象，这在激发事件需要传递额外的数据时有用，定义如下：

```js
Object: {
    elem: Element   // 进一步激发 evn 事件的元素
    data: Value     // 激发需要传递的额外数据（CustomEvent.detail 的值）
}
```


### over: Boolean

是否跳过当前调用栈，即是否采用一个 `setTimeout` 零延时调用来激发新事件。可选，默认为 `false`。

> **注：**<br>
> 传递真值会让前阶事件完全结束，因此新事件中的处理器就无法获得前阶事件完成前的状态，这在某些情况下不可行。


### 返回值

一个封装了相关逻辑的处理器函数，该处理器函数自身的返回值规则为：如果 `handle` 返回了假值，则返回该假值本身，如果返回了真值（元素/配置对象或其数组），则返回 `undefined` 或一个定时器ID。


## 示例

```html
<form id="frm">
    <p>请选择操作系统&浏览器：</p>
    <fieldset id="fos">
        <label><input type="radio" name="os" value="windows" data-val="edge">Windows</label>
        <label><input type="radio" name="os" value="macos" data-val="safari">MacOS</label>
        <label><input type="radio" name="os" value="linux" data-val="chrome">GNU/Linux</label>
    </fieldset>
    <fieldset id="fset">
        <label><input type="checkbox" name="browsers" value="chrome">Chrome</label>
        <label><input type="checkbox" name="browsers" value="edge">Edge</label>
        <label><input type="checkbox" name="browsers" value="firefox">Firefox</label>
        <label><input type="checkbox" name="browsers" value="safari">Safari</label>
    </fieldset>
    <input name="txt" type="text" value="Hello!">
    <hr>
    <input type="submit" value="提交">&nbsp;<input type="reset" value="重置">
</form>
```

### 准备工作

预先绑定待激发事件的侦听。

```js
function select( ev ) {
    // 获取目标浏览器值控件
    let _el = $.get( `[value=${ev.detail}]`, this );
    // 设为选中。
    $.prop(_el, 'checked', true);
}

// 绑定默认选取行为。
$.on(fset, 'browser', null, select);
```


### 行为 1

选取 Window 控件，自动连带选取 Edge 浏览器选项控件。

```js
let el = $.get('#fos input');
// <input ... value="windows" data-val="edge">

let fset = $.get('#fset');
// <fieldset id="fset">...</fieldset>


let call = $.Later(
        'browser',
        (ev, elo) => ({ elem: fset, data: $.attr(elo.current, '-val') })
    );

$.on( el, 'click', null, call );
```


### 行为 2

单击任意操作系统标签选项，目标操作系统的默认浏览器被选中。

```js
let els = $('#fos input');
// Collector [
//     <input ... value="windows" data-val="edge">,
//     <input ... value="macos" data-val="safari">,
//     <input ... value="linux" data-val="chrome">
// ]


// （同上）
let call = $.Later(
        'browser',
        (ev, elo) => ({ elem: fset, data: $.attr(elo.current, '-val') }),
        // 脱离当前栈，可有可无
        true
    );

els.on( 'click', null, call );
```


### 行为3

当用户点击表单的重置按钮时，侦听哪些控件的值发生了变化（**注**：这一行为浏览器没有提供默认支持）。

**准备工作：**

```js
// 仅限于value属性的值。
function rsmonitor(ev, elo) {
    console.info('curent-value: ', elo.origin.value);
    console.info('default-value: ', elo.origin.defaultValue);
}

// 一个定制的事件名。
$.on(frm, 'changes', null, rsmonitor);
```

重置事件对 `changes` 的联动激发：

```js
let rschanges = $.Later(
        // 待激发的事件
        'changes',
        // 提取当前值和默认值不同的控件集
        () => $.controls(frm).filter( el => el.value != el.defaultValue )
        // 不可传递 true，
        // 否则无法获取 reset 前的值。
    );

$.on(frm, 'reset', null, rschanges);
```

或者一次性绑定两个处理器：

```js
// 处理器定义同上。
function rsmonitor(ev, elo) {
    console.info('curent-value: ', elo.origin.value);
    console.info('default-value: ', elo.origin.defaultValue);
}

let rschanges = $.Later(
    'changes',
    () => $.controls(frm).filter( el => el.value != el.defaultValue )
);

// 一个名值对对象，也支持Map类型。
$.on( frm, {'changes': rsmonitor, 'reset': rschanges} );
```
