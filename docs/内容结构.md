# 文章内容的规范化结构

如果排除主标题 `<h1>`，按标题层级我们可以把文章的内容分为五个逻辑：**章**、**节**、**区**、**段**、**末**。它们分别对应一个标题（`<h2>~<h6>`）和一个紧随的 `<section>` 容器。

这里试图规范文章的内容结构，如果可行，样式文件就可以共享。共享的样式独立出来有很大好处：独立制作、渲染精美，同时还能让作者们更专注于内容本身。



## 内容的结构

逐级嵌套的结构按标题号递减（数字递增），逻辑上是越来越细化的片区。 **注**：规范化的结构也能促进内容组织合理，表达更清晰。


### 层次图

```html
<h1></h1>                                   <!-- 主标题 -->
<header role="abstract"></header>           <!-- 提要 -->
<nav role="toc" class="toc"></nav>          <!-- 目录 -->
<article>                                   <!-- 文章区 -->
    <header></header>                       <!-- 章导言 -->
    <h2></h2>                               <!-- 章标题 -->
    <section role="s1">                     <!-- 章片区。第一层 section -->
        <header></header>                   <!-- 节导言 -->
        <h3></h3>                           <!-- 节标题 -->
        <section role="s2">                 <!-- 节片区。第二层 section -->
            <header></header>               <!-- 区导言 -->
            <h4></h4>                       <!-- 区标题 -->
            <section role="s3">             <!-- 区片区。第三层 section -->
                <header></header>           <!-- 段导言 -->
                <h5></h5>                   <!-- 段标题 -->
                <section role="s4">         <!-- 段片区。第四层 section -->
                    <header></header>       <!-- 末导言 -->
                    <h6></h6>               <!-- 末标题 -->
                    <section role="s5">     <!-- 末片区。第五层 section -->
                        [ Text ] ...        <!-- 正文内容 -->
                    </section>
                    ...                     <!-- 平级 h6/section -->
                    <footer></footer>       <!-- 末结语 -->
                </section>
                ...                         <!-- 平级 h5/section -->
                <footer></footer>           <!-- 段结语 -->
            </section>
            ...                             <!-- 平级 h4/section -->
            <footer></footer>               <!-- 区结语 -->
        </section>
        ...                                 <!-- 平级 h3/section -->
        <footer></footer>                   <!-- 节结语 -->
    </section>
    <hr />                                  <!-- 章间隔 -->
    ...                                     <!-- 平级 h2/section -->
    <footer></footer>                       <!-- 章结语 -->
</article>
<ul role="seealso"></ul>                    <!-- 另参见 -->
<ol role="reference"></ol>                  <!-- 文献参考 -->
```

**附：Markdown解析**

1. 每一级标题之后的内容即为该标题相关的 `<section>`。
2. 如果在内容之中包含层级更低的子标题，首个子标题之前的内容被视为 `<header>`。
3. 如果内容中已经没有下级标题，则视为正文内容。
4. 如果子标题不是顺次递减而是跨级，也视为正文内容，但内部子标题继续解析。**注**：这通常是内容组织不合理的表现。



## 内容的组成

### 内容块

独立的行块内容单元，占据单独的一行（`display:block`），如 `<ol>`、`<p>` 等。前者为固定结构类单元，后者可以直接包含文本内容。


#### 结构类

内部不能直接包含文本或内联元素，有固定的子级结构。

```html
<!--                                     说明：Name -->
<hgroup></hgroup>                   <!-- 标题块：Hgroup /h1, h2 -->
<header role="abstract"></header>   <!-- 提要：Abstract /h3, p... -->
<nav role="toc"></nav>              <!-- 目录：Toc /h4, ol:cascade/li/a（可多级） -->
<ul role="seealso"></ul>            <!-- 另参见：Seealso /li/... -->
<ol role="reference"></ol>          <!-- 文献参考：Reference /li/... -->
<header></header>                   <!-- 导言：Header /h4, p... -->
<footer></footer>                   <!-- 结语：Footer /h4, p... -->
<article></article>                 <!-- 文章区：Article /header, h2, s1, footer, hr -->
<section role="s1"></section>       <!-- 片区：S1 /header, h2, s2, footer -->
<section role="s2"></section>       <!-- 片区：S2 /header, h3, s3, footer -->
<section role="s3"></section>       <!-- 片区：S3 /header, h4, s4, footer -->
<section role="s4"></section>       <!-- 片区：S4 /header, h5, s5, footer -->
<section role="s5"></section>       <!-- 片区：S5 /[content]... -->
<ul></ul>                           <!-- 无序列表：Ul /li/... -->
<ol></ol>                           <!-- 有序列表：Ol /li/... -->
<ol role="cascade"></ol>            <!-- 多级编号列表：Cascade /li/h5, ol, ... -->
<ol role="codelist"></ol>           <!-- 代码表：Codelist /li/code/b, #text -->
<dl></dl>                           <!-- 定义列表：Dl /dt, dd/... -->
<table></table>                     <!-- 表格：Table /caption, thead, tbody, tfoot/tr/td/... -->
<figure></figure>                   <!-- 插图：Figure /figcaption, p... -->
<blockquote></blockquote>           <!-- 引用块：Blockquote /h4, p... -->
<aside></aside>                     <!-- 批注块：Aside /h4, p... -->
<details></details>                 <!-- 详细内容：Details /sumary, p... -->
<pre role="codeblock"></pre>        <!-- 代码块：Codeblock /code/b, #text -->
```


#### 文本类

可直接包含文本内容，同时脱离固定的DOM结构且单独占据一行的块级元素。线条作为内容本身也归类到此，不单独分类。

```html
<p></p>                     <!-- 段落：P 通用内容容器 -->
<p role="note"></p>         <!-- 注解：Note -->
<address></address>         <!-- 地址信息：Address -->
<pre></pre>                 <!-- 预排版：Pre 非代码块 -->
<hr />                      <!-- 线条：Hr 特例 -->
<div role="space"></div>    <!-- 空白块：Space 可用于交互展示 -->
```


### 内容件

可直接作为文章正文内容的内容块被称为**内容件**，上面的文本类内容块和除了顶层**提要**、**目录**等少数几个单元的结构类内容块都可以作为正文内容，它们都是内容件。


### 内容行和内容元素

可直接包含文本和内联元素的行级元素，上面的文本类内容件就是**内容行**。但内容行还包括不能单独作为内容的行元素，如 `<li>`、`<caption>`、`<dt>`、`<dd>` 等。

**内容元素**是所有可以直接包含文本或其它内联元素的元素。上面的内容行是内容元素，但还有其它非行级的可直接包含文本的元素，如 `<td>`、`<strong>`、`<small>` 等，前者是表格的块单元（非行），后两者是内联元素。


### 行内单元

只能被包含在内容元素里的元素。即通常所说的内联（`inline`）元素，其中既有可以包含文本和其它内联元素的内容元素，也有作为内容本身的内容实体元素（如 `<img>`、`<audio>` 等）。

行内单元不是独立的**内容块**，也不是**内容件**，它们不能单独出现在章节片区（`<section>`）里，必须被内容行（譬如 `<p>`）封装才行。

```html
<!--                             说明：Name -->
<audio></audio>             <!-- 音频：Audio /track,source, #text -->
<video></video>             <!-- 视频：Video /track,source, #text -->
<picture></picture>         <!-- 图片：Picture /source,img -->
<a></a>                     <!-- 链接：A -->
<strong></strong>           <!-- 重点：Strong -->
<em></em>                   <!-- 强调：Em -->
<q></q>                     <!-- 短引用：Q -->
<abbr></abbr>               <!-- 缩写：Abbr -->
<cite></cite>               <!-- 来源：Cite -->
<small></small>             <!-- 注脚：Small -->
<time></time>               <!-- 时间：Time -->
<del></del>                 <!-- 删除：Del -->
<ins></ins>                 <!-- 插入：Ins -->
<sub></sub>                 <!-- 下标：Sub -->
<sup></sup>                 <!-- 上标：Sup -->
<mark></mark>               <!-- 标记：Mark -->
<code></code>               <!-- 代码：Code -->
<code role="orz"></code>    <!-- 表情：Orz -->
<ruby></ruby>               <!-- 注音：Ruby /rb,rp,rt -->
<dfn></dfn>                 <!-- 定义：Dfn -->
<samp></samp>               <!-- 样本：Samp -->
<kbd></kbd>                 <!-- 键盘字：Kbd -->
<s></s>                     <!-- 失效：S -->
<u></u>                     <!-- 注记：U -->
<var></var>                 <!-- 变量：Var -->
<bdo></bdo>                 <!-- 文本方向：Bdo -->
<meter></meter>             <!-- 度量：Meter -->
<b>                         <!-- 粗体：B 主要用于代码块内的关键字包裹 -->
<i>                         <!-- 斜体：I 主要用于图标占位（icon） -->
<img />                     <!-- 图片：Img -->
<br />                      <!-- 换行：Br -->
<wbr />                     <!-- 软换行：Wbr -->
<span role="blank"></span>  <!-- 空白段：Blank -->
$text                       <!-- 文本节点：#text -->
```



## 内容的类型

> **注**：详见 `base/types.js` 文件定义。


### 合法子类型

每个结构性元素或普通单元的子单元都是类型受限的（**注**：详见 `base/types.js` 文件配置）。

插入节点时会考虑：

1. 目标参考元素的父元素允许哪些子单元？符合即简单插入，否则检查是否需要/可以转换？
2. 目标参考元素自身作为容器允许哪些子单元，符合即简单添加，否则检查是否需要/可以转换？



## 内容块结构

### 原生结构

#### 文章

这是文章内容的主容器，除了文章的主标题（页面标题 `<h1>`）、提要、目录等少数几个结构外，其它所有内容块都被包含在里面。

```html
<article>
    [...]   <!-- 主体内容 -->
</article>
```


#### 导言

```html
<header>
    <h4></h4> <!-- 可选 -->
    <p></p> ...
</header>
```


#### 结语

```html
<footer>
    <h4></h4> <!-- 可选 -->
    <p></p> ...
</footer>
```


#### 无序列表

```html
<ul>
    <li></li>
</ul>
```


#### 有序列表

```html
<ol>
    <li></li>
</ol>
```


#### 定义列表

```html
<dl>
    <dt></dt>
    <dd></dd>
</dl>
```


#### 表格

```html
<table>
    <caption></caption>
    <thead> <!-- 可选 -->
        <tr><td></td></tr>
    </thead>
    <tbody>
        <tr><td></td></tr>
    </tbody>
    <tfoot> <!-- 可选-->
        <tr><td></td></tr>
    </tfoot>
</table>
```


#### 插图

```html
<figure>
    <figcaption></figcaption>
    <p>
        <img />...
    <p>
</figure>
```


#### 引用块

```html
<blockquote>
    <h4></h4>   <!-- 可选 -->
    <p><p> ...  <!-- 平级罗列 -->
</blockquote>
```


#### 批注块

```html
<aside>
    <h4></h4> <!-- 可选 -->
    <p><p> ...
</aside>
```


#### 详细内容

从内容逻辑和浏览器的视觉实现上看，本区块的摘要（标题）与内容有明显的区隔，因此内容部分采用单独的容器封装（而不是平级罗列）。

```html
<details>
    <summary></summary>  <!-- 可选 -->
    <p></p> ...  <!-- 平级罗列 -->
</details>
```


#### 注音

这是一个内联的微结构单元，和其它行内单元一样，必须被包含在行块级的内容元素里。**注**：`<td>` 虽然不是行逻辑，但它属于一种微块单元。

```html
<ruby>
    <rb>漢</rb><rp>（</rp><rt> ㄏㄢˋ </rt><rp>）</rp>
</ruby>
```


### 定制结构

#### 提要

```html
<header role="abstract">
    <h3>摘 要</h3>
    <p></p> ...
</header>
```


#### 目录

```html
<nav role="toc">
    <h4></h4>
    <ol role="cascade">
        <li><h5><a href="#..."></a></h5></li>
    </ol>
</nav>
```


#### 片区

这是一个抽象体，包含4个并列的逻辑区段：**导言**、**标题**、**内容区**、**结语**，没有一个统一的容器来包含它们。

```html
<header></header>       <!-- 导言：可选 -->
<h2>                    <!-- 标题：h2-h6 -->
<section role="s1">     <!-- 内容区：s1-s5 -->
    [ Text ]...
</section>
<footer></footer>       <!-- 结语：可选 -->
```

共有**5**个逐级递减的片区，它们被命名为：**章**、**节**、**区**、**段**、**末**。


#### 另参见

```html
<ul role="seealso">
    <li></li>
</ul>
```


#### 文献参考

```html
<ol role="reference">
    <li></li>
</ol>
```


#### 级联编号表

级联编号表仅由有序列（`<ol>`）表构成，除了最深那个层级，列表项（`<li>`）中仅有两个子元素：可选的小标题（`<h5>`）和子列表（`<ol>`）。

> **注：**<br>
> 有序（`<ol>`）和无序（`<ul>`）列表的混合嵌套也是一种级联表，但它们属于正常的DOM结构，不在这里特别区分。

```html
<ol role="cascade">
    <li></li> <!-- 由CSS表达序号规则 -->
    <li><h5></h5> ...
        <ol>
            <li></li>
        </ol>
    </li>
</ol>
```


#### 代码表

```html
<ol role="codelist">
    <li><code data-lang="xx"> <!-- 根封装 -->
        ...<b></b>... <!-- 代码内容，<b>着色封装 -->
    </code></li>
    <li><code data-lang="xx"> ... </code></li>
</ol>
```

> **注**：所有代码的data-lang属性仅设置在 `<code>` 元素上。


#### 代码块

```html
<pre role="codeblock"><!-- 容许简单换行 -->
<code data-lang="xx"> ...<b></b>...
</code><pre> <!-- 末尾应当紧跟 -->
```


#### 注解

用于解释正文中具体的名词或词组。

```html
<p role="note">...</p>
```

> **注：**
> 与批注块（`<aside>`）单元相比，**注解** 逻辑上是直接与目标相关联。



## 代码着色

### 封装规则

代码内的高亮着色采用 `<b>` 元素封装，由 `role` 定义高亮所属的类型。所有 `<b>` 元素只会处于同一层级（`<code>` 直接子元素），不存在嵌套。

基本名称（简写）定义如下（14个）：

```js
简写       选择器       说明
-----------------------------------------------------------
cmt     // b[role=cmt] comments 注释
str     // b[role=str] string 字符串
kws     // b[role=kws] keywords 关键字
tag     // b[role=tag] tag-name HTML标签名
slr     // b[role=slr] selector CSS选择器
atn     // b[role=atn] attribute-name 属性名
atv     // b[role=atv] attribute-value 属性值
fun     // b[role=fun] function 函数名
typ     // b[role=typ] data-type 数据类型
imp     // b[role=imp] important 重要
doc     // b[role=doc] &lt;!DOCTYPE...&gt; HTML文档声明
cdt     // b[role=cdt] &lt;![CDATA[...]]&gt; HTML代码片段
rex     // b[role=rex] RegExp 正则表达式（如：/.../gi）
err     // b[role=err] error 错误提示
```

> **注：**<br>
> 用 `<b>` 封装着色文本不但减少书写量，在没有样式渲染时，默认的粗体显示也很友好。


### 示例

#### 源码1（代码块）

```html
<pre role="codeblock">
<code data-lang="go"><b role="cmt">// prints its command-line arguments.</b>
<b role="kws">package</b> main

<b role="kws">import</b> (
    <b role="str">"fmt"</b>
    <b role="str">"os"</b>
)

<b role="kws">func</b> main() {
    <b role="kws">var</b> s, sep <b role="typ">string</b>
    <b role="kws">for</b> i := 1; i &lt; <b role="fun">len</b>(os.Args); i++ {
        s += sep + os.Args[i]
        sep = <b role="str">" "</b>
    }
    fmt.Println(s)
}</code></pre>
```

#### 效果

```go
// Echo1 prints its command-line arguments.
package main

import (
    "fmt"
    "os"
)

func main() {
    var s, sep string
    for i := 1; i < len(os.Args); i++ {
        s += sep + os.Args[i]
        sep = " "
    }
    fmt.Println(s)
}
```

#### 源码2（代码表）

```html
<ol role="codelist">
    <li><code data-lang="go"><b role="kws">package</b> main</code></li>
    <li><code data-lang="go"><b role="kws">import</b> <b role="str">"fmt"</b></code></li>
    <li><code data-lang="go"><b role="kws">func</b> main() {</code></li>
    <li><code data-lang="go">    fmt.Println(<b role="str">"Hello, 世界"</b>) <b role="cmt">// 通过导入的 fmt 包，执行 Println 函数向控制台打印消息。</b></code></li>
    <li><code data-lang="go">}</code></li>
    <li><code data-lang="go"><b role="kws">type</b> MapSort <b role="kws">struct</b> {</code></li>
    <li><code data-lang="go">    m <b role="kws">map</b>[<b role="typ">string</b>]<b role="typ">int</b></code></li>
    <li><code data-lang="go">    s []<b role="typ">string</b></code></li>
    <li><code data-lang="go">}</code></li>
</ol>
```

#### 效果

```go
package main
import "fmt"
func main() {
    fmt.Println("Hello, 世界") // 通过导入的 fmt 包，执行 Println 函数向控制台打印消息。这是一个长行。
}
type MapSort struct {
    m map[string]int
    s []string
}
```

**注**：HTML页面中实际会显示行号。
