# 文章内容的规范化结构

文章结构的良好有着十分重要的价值，它不但让大纲清晰，易于理解，而且会让样式共享成为可能。共享样式意义非凡，它使得样式可以独立制作，渲染精美，而文章的作者就能专注于内容本身了。

依通常的情形和需求，这里提供最多5个层级的支持，分别命名为：**章**、**节**、**区**、**段**、**末**。它们逐层嵌套，每一层都由一个 `<section>` 封装，为便于识别和定位，`<section>` 元素上分别定义 `role` 属性值为：`s1 ~ s5`。



## 层次

### 标题规划

逐层嵌套的 `<section>` 封装会隔离标题的层次逻辑，但标题自身的层级依然是可以被规划和利用的，这可能带来一些额外的好处或便利。细节如下：

- `h1`: 仅用于文章的主标题，通常就是页面主标题。
- `h2`: 各区段（`<section>`）的主标题（作为首个子元素存在）；以及文章的副标题，和主标题 `h1` 一起存在于一个 `hgroup` 容器之内。
- `h3`: 各行块内容单元的标题，如：文章提要（`<header:abstract>`）、引用块（`<blockquote>`）、导言（`<header>`）等。
- `h4`: 级联表的小标题。以及其它行块单元内主标题层级之下的细粒度扩展。
- `h5~h6`: 在各自行块内的顶级标题下的更细粒度扩展。


### 层次示意

```html
<h1></h1>                                   <!-- 页标题 -->
<header role="abstract"></header>           <!-- 提要 -->
<nav role="toc" class="toc"></nav>          <!-- 目录 -->
<article>                                   <!-- 文章区 -->
    <header></header>                       <!-- 导言 -->
    <section role="s1">                     <!-- 章片区。第一层 section -->
        <h2></h2>                           <!-- 章标题 -->
        <header></header>                   <!-- 章导言 -->
        <section role="s2">                 <!-- 节片区。第二层 section -->
            <h2></h2>                       <!-- 节标题 -->
            <header></header>               <!-- 节导言 -->
            <section role="s3">             <!-- 区片区。第三层 section -->
                <h2></h2>                   <!-- 区标题 -->
                <header></header>           <!-- 区导言 -->
                <section role="s4">         <!-- 段片区。第四层 section -->
                    <h2></h2>               <!-- 段标题 -->
                    <header></header>       <!-- 段导言 -->
                    <section role="s5">     <!-- 末片区。第五层 section -->
                        <h2></h2>           <!-- 末标题 -->
                        <header></header>   <!-- 末导言 -->
                        {content} ...       <!-- 正文内容 -->
                        <footer></footer>   <!-- 末小结 -->
                    </section>
                    ...                     <!-- 平级 section:s5 -->
                    <footer></footer>       <!-- 段小结 -->
                </section>
                ...                         <!-- 平级 section:s4 -->
                <footer></footer>           <!-- 区小结 -->
            </section>
            ...                             <!-- 平级 section:s3 -->
            <footer></footer>               <!-- 节小结 -->
        </section>
        ...                                 <!-- 平级 section:s2 -->
        <footer></footer>                   <!-- 节小结 -->
    </section>
    <hr />                                  <!-- 章分隔 -->
    ...                                     <!-- 平级 section:s1 -->
    <footer></footer>                       <!-- 结语 -->
</article>
<ul role="seealso"></ul>                    <!-- 另参见 -->
<ol role="reference"></ol>                  <!-- 文献参考 -->
```

**附：Markdown解析**

1. 每一级标题之后的内容即为该标题关联的 `<section>`。
2. 如果在内容之中包含层级更低的子标题，首个子标题之前的内容被视为 `<header>`。
3. 如果内容中已经没有下级标题，则视为正文内容。
4. 如果子标题不是顺次递减而是跨级，也视为正文内容，但内部子标题继续解析。但这通常是内容组织不合理的表现。



## 组成

### 内容块

独立的行块内容单元，占据单独的一行（`display:block`）。如 `<ol>`、`<p>`，前者为固定结构类单元，后者可以直接包含文本内容。


#### 结构类

内部不能直接包含文本或内联元素，有固定的子级结构。

```html
<!--                                     说明：Name -->
<hgroup></hgroup>                   <!-- 主/副标题组：HGROUP /h1, h2 -->
<header role="abstract"></header>   <!-- 提要：ABSTRACT /h3, p... -->
<nav role="toc"></nav>              <!-- 目录：TOC /h3, ol:cascade/li/a（可多级） -->
<ul role="seealso"></ul>            <!-- 另参见：SEEALSO /li/... -->
<ol role="reference"></ol>          <!-- 文献参考：REFERENCE /li/... -->
<header></header>                   <!-- 导言：HEADER /h3, p... -->
<footer></footer>                   <!-- 结语/小结：FOOTER /h3, p... -->
<article></article>                 <!-- 文章区：ARTICLE /header, s1, footer, hr -->
<section role="s1"></section>       <!-- 片区：S1 /h2, header, s2, footer -->
<section role="s2"></section>       <!-- 片区：S2 /h2, header, s3, footer -->
<section role="s3"></section>       <!-- 片区：S3 /h2, header, s4, footer -->
<section role="s4"></section>       <!-- 片区：S4 /h2, header, s5, footer -->
<section role="s5"></section>       <!-- 片区：S5 /h2, header, [content], footer -->
<ul></ul>                           <!-- 无序列表：UL /li/... -->
<ol></ol>                           <!-- 有序列表：OL /li/... -->
<ol role="codelist"></ol>           <!-- 代码表：CODELIST /li/code/b, #text -->
<ul role="ulx"></ul>                <!-- 无序级联表：ULX /li/h4, ol|ul/... -->
<ol role="olx"></ol>                <!-- 有序级联表：OLX /li/h4, ul|ol/... -->
<ol role="cascade"></ol>            <!-- 级联编号表：CASCADE /li/h4, ol/... -->
<dl></dl>                           <!-- 定义列表：DL /dt, dd/... -->
<table></table>                     <!-- 表格：TABLE /caption, thead, tbody, tfoot/tr/td/... -->
<figure></figure>                   <!-- 插图：FIGURE /figcaption, p... -->
<blockquote></blockquote>           <!-- 引用块：BLOCKQUOTE /h3, p... -->
<aside></aside>                     <!-- 批注块：ASIDE /h3, p... -->
<details></details>                 <!-- 详细内容：DETAILS /sumary, p... -->
<pre role="codeblock"></pre>        <!-- 代码块：CODEBLOCK /code/b, #text -->
```


#### 文本类

可直接包含文本内容，同时脱离固定的DOM结构且单独占据一行的块级元素。线条作为内容本身也归类到此，不单独分类。

```html
<p></p>                 <!-- 段落：P 通用内容容器 -->
<p role="note"></p>     <!-- 注解：NOTE -->
<p role="tips"></p>     <!-- 提示：TIPS -->
<address></address>     <!-- 地址信息：ADDRESS -->
<pre></pre>             <!-- 预排版：PRE 非代码块 -->
```


#### 单体类

不包含任何内容，是一个独立存在的单元。

```html
<hr />                      <!-- 分隔：HR -->
<div role="blank"></div>    <!-- 白板：BLANK 用于交互展示 -->
```

> **注：**
> 白板可插入内容，但仅适用在运行时下且应当是临时的。


### 内容件

可直接作为文章正文内容的内容块被称为 **内容件**，上面的文本类内容块和除了顶层 **提要**、**目录** 等少数几个单元的结构类内容块都可以作为正文内容，它们都是内容件。


### 内容行和内容元素

可直接包含文本和内联元素的行级元素，上面的文本类内容件就是 **内容行**。但内容行还包括不能单独作为内容的行元素，如 `<li>`、`<caption>`、`<dt>`、`<dd>` 等。

**内容元素** 是所有可以直接包含文本和其它内联元素的元素。上面的内容行是内容元素，但还有其它非行级的元素也可以直接包含文本，如 `<td>`、`<strong>`、`<small>` 等，前者是表格的内容单元，而后两者则是内联元素。


### 内联单元

只能被包含在内容元素里的元素，没有行块的逻辑，有时也称为行内元素。其中既有可以包含文本的内容元素，也有结构性元素，如 `<img>`、`<audio>` 等。

内联单元不是 **内容件**，它们不能作为片区（`<section>`）的直接子元素出现，必须被行块级的内容行元素（如 `<p>`、`<address>` 等）封装才行。

```html
<!--                                 说明：Name -->
<audio></audio>                 <!-- 音频：AUDIO /track,source, #text -->
<video></video>                 <!-- 视频：VIDEO /track,source, #text -->
<picture></picture>             <!-- 图片：PICTURE /source,img -->
<a></a>                         <!-- 链接：A -->
<strong></strong>               <!-- 重点：STRONG -->
<em></em>                       <!-- 强调：EM -->
<q></q>                         <!-- 短引用：Q -->
<abbr></abbr>                   <!-- 缩写：ABBR -->
<cite></cite>                   <!-- 来源：CITE -->
<small></small>                 <!-- 注脚：SMALL -->
<time></time>                   <!-- 时间：TIME -->
<del></del>                     <!-- 删除：DEL -->
<ins></ins>                     <!-- 插入：INS -->
<sub></sub>                     <!-- 下标：SUB -->
<sup></sup>                     <!-- 上标：SUP -->
<mark></mark>                   <!-- 标记：MARK -->
<code data-lang=".."></code>    <!-- 代码：CODE，可定义语言 -->
<code role="orz"></code>        <!-- 表情：ORZ -->
<ruby></ruby>                   <!-- 注音：RUBY /rb,rp,rt -->
<dfn></dfn>                     <!-- 定义：DFN -->
<samp></samp>                   <!-- 样本：SAMP -->
<kbd></kbd>                     <!-- 键盘字：KBD -->
<s></s>                         <!-- 失效：S -->
<u></u>                         <!-- 注记：U -->
<var></var>                     <!-- 变量：VAR -->
<bdo></bdo>                     <!-- 有向文本：BDO -->
<meter></meter>                 <!-- 度量：METER -->
<img />                         <!-- 图片：IMG -->
<br />                          <!-- 换行：BR -->
<wbr />                         <!-- 软换行：WBR -->
<span role="space"></span>      <!-- 空白：SPACE -->
<b>                             <!-- 特用：代码关键字封装 -->
<i>                             <!-- 特用：代码注释/标题编号 -->
#text                           <!-- 文本节点：$text -->
```



## 类型

> **注**：详见 `base/types.js` 文件定义。


### 合法子类型

每个结构性元素或普通单元的子单元都是类型受限的（**注**：详见 `base/types.js` 文件配置）。

从面板录入时，面板只会显示合法的条目构造。当对已有节点移动/克隆插入时则遵循如下原则：

1. **平级插入**：目标参考元素的父元素允许哪些子单元？符合即简单插入（元素），否则提取内容节点，构造默认单元插入。
2. **向内插入**：目标参考元素自身作为容器允许哪些子单元，符合即简单添加，否则提取内容节点构造默认条目插入。



## 单元结构

### 原生结构

#### 文章

这是文章内容的主容器，除了文章的主标题（页面标题 `<h1>`）、提要、目录等少数几个结构外，其它所有内容块都被包含在里面。

```html
<article>
    <header></header>   <!-- 导言：可选 -->
    {content} ...       <!-- 主体内容 -->
    <footer></footer>   <!-- 结语：可选 -->
</article>
```


#### 导言

```html
<header>
    <h3></h3> <!-- 可选 -->
    <p></p> ...
</header>
```


#### 结语

```html
<footer>
    <h3></h3> <!-- 可选 -->
    <p></p> ...
</footer>
```


#### 无序列表

```html
<ul>
    <li></li>
</ul>
```


#### 有序列表

```html
<ol>
    <li></li>
</ol>
```


#### 定义列表

```html
<dl>
    <dt></dt>
    <dd></dd>
</dl>
```


#### 表格

```html
<table>
    <caption></caption>
    <thead> <!-- 可选 -->
        <tr><td></td></tr>
    </thead>
    <tbody>
        <tr><td></td></tr>
    </tbody>
    <tfoot> <!-- 可选-->
        <tr><td></td></tr>
    </tfoot>
</table>
```


#### 插图

```html
<figure>
    <figcaption></figcaption>
    <p>
        <img />...
    <p>
</figure>
```


#### 引用块

```html
<blockquote>
    <h3></h3>   <!-- 可选 -->
    <p><p> ...
</blockquote>
```


#### 批注块

```html
<aside>
    <h3></h3> <!-- 可选 -->
    <p><p> ...
</aside>
```


#### 详细内容

```html
<details>
    <summary></summary>
    <p></p> ...
</details>
```


#### 段落

最简单的内容行元素，也是大多数小区块里内容的默认封装单元。

```html
<p>
    <!-- 文本或内联单元 -->
</p>
```


#### 地址信息

```html
<address>
    <!-- 文本或内联单元 -->
</address>
```


#### 预排版

与包含特定语言标注的代码表/代码块不同，这是一种需要保留原始版式的通用结构。

```html
<pre data-tabs="4">
    <!-- 文本或内联单元
        注：
        首个换行会被浏览器友好清理，末尾换行会被原样保留。 -->
</pre>
```


#### 分隔

分隔作为行块对待，样式由外部CSS定义。

```html
<hr />
<hr role="dotted" />    <!-- 虚线 -->
<hr role="solid" />     <!-- 实线 -->
<hr role="double" />    <!-- 双划线 -->
<hr role="dashed" />    <!-- 点划线 -->
<hr role="groove" />    <!-- 内槽线 -->
<hr role="ridge" />     <!-- 外槽线 -->
<hr role="inset" />     <!-- 内嵌线 -->
<hr role="outset" />    <!-- 外嵌线 -->
```


#### 注音

这是一个内联的微结构单元，有着固定的子元素逻辑。

```html
<ruby>
    <rb>漢</rb><rp>（</rp><rt> ㄏㄢˋ </rt><rp>）</rp>
</ruby>
```


### 定制结构

#### 提要

```html
<header role="abstract">
    <h3>提 要</h3>
    <p></p> ...
</header>
```


#### 目录

```html
<nav role="toc">
    <h3></h3>
    <ol role="cascade">
        <li><h4><a href="#..."><!-- [#text] --></a></h4></li>
    </ol>
</nav>
```


#### 片区

包含4个并列的逻辑区段：**标题**、**导言**、**内容区**、**结语**。

```html
<section role="s1">     <!-- s1 ~ s5 -->
    <h2></h2>           <!-- 标题 -->
    <header></header>   <!-- 导言：可选 -->
    {content} ...       <!-- 内容区 -->
    <footer></footer>   <!-- 结语：可选 -->
</section>
```


#### 另参见

```html
<ul role="seealso">
    <li></li>
</ul>
```


#### 文献参考

```html
<ol role="reference">
    <li></li>
</ol>
```


#### 无序级联表

以无序列表 `<ul>` 为根容器，内含多级子列表（可为任意 `<ol>` 或 `<ul>`）。

```html
<ul role="ulx">
    <li></li>
    <li>
        <h4></h4> <!-- 级联小标题 -->
        <ol>      <!-- 也可为<ul> -->
            <li></li>
        </ol>
    </li>
</ul>
```


#### 有序级联表

以有序列表 `<ol>` 为根容器，内含多级子列表（可为任意 `<ul>` 或 `<ol>`）。

```html
<ol role="olx">
    <li></li>
    <li>
        <h4></h4> <!-- 级联小标题 -->
        <ul>      <!-- 也可为<ol> -->
            <li></li>
        </ul>
    </li>
</ol>
```


#### 级联编号表

仅由有序列（`<ol>`）表构成，除了最终的层级，列表项（`<li>`）中仅有两个子元素：小标题（`<h4>`）和子列表（`<ol>`）。

```html
<ol role="cascade">
    <li></li>
    <li> <!-- 由CSS表达序号逻辑 -->
        <h4></h4>
        <ol>
            <li></li>
        </ol>
    </li>
</ol>
```


#### 代码表

包含 `data-lang` 属性用于指定代码语言，`data-tab` 属性指定制表符（`Tab`）对应的空格数。可以有两级定义：

1. 根级。书写在 `<ol>` 元素上，对应整个代码表的默认值。
2. 行级。书写在 `<code>` 元素上，对应当前行的语言和制表符宽度（可选）。

元素的 `start` 属性在引用代码片段时很有用。例：[源码2（代码表）](#源码2（代码表）)。

```html
<ol role="codelist" data-lang="xx" data-tab="4" start="n">
    <li><code> <!-- 根封装 -->
        ...<b>... <i>... <!-- 代码内容，<b>着色封装，<i>注释封装 -->
    </code></li>
    <li><code data-lang="xx" data-tab="2"> <!-- data-xx定义覆盖 -->
        ...
    </code></li>
</ol>
```

> **注：**
> `data-lang` 特性是设置在 `<code>` 元素而不是 `<li>` 元素上，这与其它代码单元（代码块/代码段）行为一致。


#### 代码块

与代码表相似，包含 `data-lang` 和 `data-tab` 两个属性定义代码的特性，设置在 `<code>` 元素上。

```html
<pre role="codeblock"><!-- 容许简单换行 -->
<code data-lang="xx" data-tab="4"> ...<b>..<i>...
<!-- 非零Tab会被自动转换为空格 -->
</code></pre> <!-- 末尾应当紧跟 -->
```


#### 注解

用于解释正文中具体的名词或词组，在UI上可能是一种弹出展示。

```html
<p role="note">
    <!-- 文本或内联单元 -->
</p>
```


#### 提示

一段小型的文本，通常用于小条目下的简单说明。外观可能像无序列表的 `<li>` 项。

```html
<p role="tips">
    <!-- 文本或内联单元 -->
</p>
```


#### 白板

这是一种特别的内容单元，用于交互展示。

```html
<div role="blank">
    <!-- 动态表达区 -->
</div>
```



## 代码着色

### 封装规则

代码内的各种单元采用 `<b>` 元素封装，由 `role` 定义单元类型，但注释类型采用 `<i>` 封装。通常所有的 `<b>` 和 `<i>` 都处于同一层级（`<code>` 的直接子元素），没有嵌套。

基本名称（简写）定义如下：

```js
简写        // 选择器       说明
-----------------------------------------------------------
kw          // b[role=kw]   keyword 关键字
str         // b[role=str]  string 字符串
fn          // b[role=fn]   function-name 函数名
op          // b[role=op]   operator 运算符
dt          // b[role=dt]   data-type 数据类型
tag         // b[role=tag]  tag-name HTML标签名
an          // b[role=an]   attribute-name 属性名
imp         // b[role=imp]  important 重要
doc         // b[role=doc]  <!DOCTYPE...> HTML文档声明
cd          // b[role=cd]   <![CDATA[...]]> HTML代码片段
re          // b[role=re]   RegExp 正则表达式（如：/.../gi）
err         // b[role=err]  error 错误提示
```

> **注：**<br>
> 用 `<b>` 封装着色文本可减少书写，在没有样式渲染时，默认的粗体显示也较为友好。<br>
> 用 `<i>` 封装注释有类似的功用，另外如果注释内还包含其它标记，也使得它们与 `<b>` 有所区分。<br>


### 示例

#### 源码1（代码块）

```html
<pre role="codeblock">
<code data-lang="go"><i>// prints its command-line arguments.</i>
<b role="kw">package</b> main

<b role="kw">import</b> (
    <b role="str">"fmt"</b>
    <b role="str">"os"</b>
)

<b role="kw">func</b> main() {
    <b role="kw">var</b> s, sep <b role="typ">string</b>
    <b role="kw">for</b> i <b role="op">:=</b> 1; i <b role="op">&lt;</b> <b role="fn">len</b>(os.Args); i<b role="op">++</b> {
        s <b role="op">+=</b> sep <b role="op">+</b> os.Args[i]
        sep <b role="op">=</b> <b role="str">" "</b>
    }
    fmt.Println(s)
}</code></pre>
```

#### 效果

```go
// prints its command-line arguments.
package main
import (
    "fmt"
    "os"
)
func main() {
    var s, sep string
    for i := 1; i < len(os.Args); i++ {
        s += sep + os.Args[i]
        sep = " "
    }
    fmt.Println(s)
}
```


#### 源码2（代码表）

```html
<ol role="codelist" data-lang="go" start="3"">
    <li><code><b role="kw">package</b> main</code></li>
    <li><code><b role="kw">import</b> <b role="str">"fmt"</b></code></li>
    <li><code><b role="kw">func</b> main() {</code></li>
    <li><code>    fmt.Println(<b role="str">"Hello, 世界"</b>) <i>// 通过导入的 fmt 包，执行 Println 函数向控制台打印消息。</i></code></li>
    <li><code>}</code></li>
    <li><code><b role="kw">type</b> MapSort <b role="kw">struct</b> {</code></li>
    <li><code>    m <b role="kw">map</b>[<b role="typ">string</b>]<b role="typ">int</b></code></li>
    <li><code>    s []<b role="typ">string</b></code></li>
    <li><code>}</code></li>
</ol>
```

#### 效果

```go
package main
import "fmt"
func main() {
    fmt.Println("Hello, 世界") // 通过导入的 fmt 包，执行 Println 函数向控制台打印消息。这是一个长行。
}
type MapSort struct {
    m map[string]int
    s []string
}
```

**注**：HTML页面中实际会显示行号。
