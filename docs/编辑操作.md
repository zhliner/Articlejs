# 编辑操作

与普通的编辑器有所不同，本编辑器有两种操作模式：

1. 键盘友好的**普通模式**。除了从功能区插入各种内容外，可以通过快捷键执行多种操作：选取、复制、移动、删除等。
2. 执行小量内容修改的**修订模式**。这是通过设置内容元素的 `contenteditable` 特性使得元素可编辑，适用于小量修订（有时也称为*微编辑模式*）。

兼顾编辑的便捷性，修订模式下支持简单的创建新行的能力。



## 普通模式

编辑器初始即处于普通模式。普通模式下无法对文本进行编辑，但可以对内容进行各种控制操作，此时也称为**控制态**。

- **选取**：鼠标单击选取目标元素，按 `Ctrl` 键单击可多选或切换选取。另外还有一些扩展选取的快捷方式。选取的多个目标元素称为选取集，它们是接下来操作的目标对象。
- **克隆**：将选取集元素克隆并插入到焦点元素前后。
- **移动**：将选取集元素移动到焦点元素前后。如果克隆/移动是在兄弟元素之间发生，则不会发生可能需要的内容转换。
- **删除**：部分内容单元拥有固定的结构（如表格），删除操作不会破坏这样的结构（如选取的是 `<tbody>` 元素），此时只会删除其**内容**，完整的单元才会被整体删除。
- **录入**：从编辑器主面板下方的功能区可录入各种类型的内容单元，这也是本编辑器主要的输入内容的地方。各个内容单元有自己的结构逻辑，以及应当处于文章内什么位置的约束。文章结构的规范化就是通过这单独的录入逻辑实现的。


> ### 附：快捷辅助键使用原则约定
> 普通模式下大量的操作都可以使用热键（快捷键），这可以提高编辑效率。为便于记忆，快捷键的设定遵循如下原则。
>
> - `Shift`: 当前功能增强。
> - `Ctrl`:  当前功能相关、衍生功能。
> - `Alt`:   提供当前功能的额外能力，多与系统级相关联（系统能力支持），或逻辑差异较大。
>
> 当然，用户也可以根据自己的习惯修改系统默认的热键配置（详见：*base/shortcuts.js*）。


### 焦点元素

选取集是按元素选取的先后顺序排列的一个集合，其中最新添加的元素就是当前选取的，因为是当前选取，被视为拥有焦点，所以也称它为焦点元素。

但焦点元素并不完全就是最新添加的那个元素，实际上焦点可以在任意元素间移动的。这里的焦点的准确含义是**当前正在或需要被操作的目标**，它与浏览器文档节点树上的元素焦点并不相同。焦点之下的元素称为焦点元素，它可能被添加到选取集，也可能是需要从选取集中移除。

为了与浏览器节点树上的元素焦点概念区别，有时我们称之为**选取焦点**（注：下文中提到的焦点皆指此）。


#### 焦点移动

选取焦点可通过键盘上的几个方向键移动，或者通过实施箭头功能的其它友好键位（如 Vim 中的 `hjkl`）移动。移动分为两个维度：

- **兄弟/平级**：在DOM树的同级元素方向上，即兄弟元素间移动。
- **父子/纵向**：在DOM树的纵深方向上，即父子元素间的跨层级移动。

借鉴于DOM的树逻辑，方向键含义如下：

- `↑`： 平级移动，定位到前一个（`prev`）兄弟元素。支持数字指定移动距离，默认值 `1`（即前一个兄弟元素），特殊值 `0` 表示头部首个兄弟元素。
- `↓`： 平级移动，定位到下一个（`next`）兄弟元素。支持数字指定移动距离，默认值 `1`（即下一个兄弟元素），特殊值 `0` 表示末尾最后一个兄弟元素。
- `←`：纵向移动，定位到父元素（*父级方向*）。支持数字指定移动层级，默认值 `1`（即父元素），需提供准确数值，不支持 `0` 特殊值。
- `→`：纵向移动，定位到子元素（*子级方向*），支持数字指定子元素位置下标，默认值 `0`（即首个子元素），负值表示从末尾算起（`-1` 表示最后一个子元素）。

**注记**：方向键的逻辑设计实际上也符合文章纵向为平级罗列的表现。


#### 附：顶元素

支持一个特殊的键 `t` 将焦点移动到当前焦点元素的**顶元素**上。顶元素是一个特意设计的**虚拟**根容器，以方便用户快速定位经常操作的目标。

- 对于内联单元来说，顶元素是其所在行块的内容行元素。如 `<p>`、`<li>`、`<dd>` 和 `<td>` 等（`<th>, <td>` 被视为特殊内容块）。
- 对于行块单元内的中间结构元素，其顶元素即为单元根元素。如 `<tr>` 的顶元素为 `<table>`，列表项 `<li>` 的顶元素为其所在 `<ol>` 或 `<ul>`。
- 对于内联单元内的结构元素，其顶元素即是该内联单元本身。如 `<rt>` 的顶元素为 `<ruby>`，SVG 系子元素的顶元素为 `<svg>`。


### 元素选取

#### 鼠标点选

通过鼠标**单击**的方式可以定位焦点元素并实现选取或取消选取。

- `单选：单击`:         简单单击选取目标元素，之前的选取会被取消。
- `多选：Ctrl + 单击`:  增加选取目标元素，之前的选取无影响。如果单击的是已经选取的元素，则为取消选取（切换逻辑）。
- `聚焦：Alt + 单击`:   仅将焦点移动到目标元素上，不作任何选取类动作。这在编辑操作中定位目标时有用。

下面的选取有一定的智能性，单击的目标不一定是最终目标（与焦点元素有关）。

- `跨选：Shift + 单击`:         同态焦点元素至目标元素的同级兄弟元素，如果目标元素层级较深，自动取与焦点元素同级的父级元素为目标。焦点移动到目标元素。
- `浮选：Ctrl + Shift + 单击`:  以焦点元素所在层级为依据，获取目标的同层级父级元素**切换**选取。如果目标与焦点元素不在同一父容器内则无效。

任意目标的父级元素选取（与焦点元素无关）。

- `父选（多选）：Alt + Ctrl + 单击`:  选取鼠标单击目标的父元素，不影响已有选取。比如直接选取表格行（`<tr>`）元素。
- `父焦（聚焦）：Shift + Alt + 单击`: 聚焦鼠标单击目标的父元素，不影响已有选取。

> **同态：**
> 焦点元素有选取和非选取两者状态，使得目标与焦点元素状态相同，称之为**同态**操作。


#### 按键选取

在鼠标选取的基础上，通过键盘按键操作，我们可以实现更多的选取逻辑。

- `Space | Enter`: 选取切换。焦点元素选取或取消选取，不影响其它已选取元素（类似 `Ctrl + 单击`）。
- `Shift + 箭头键`: 单选游走。移动焦点的同时改选目标元素（类似鼠标单击）。

**注**：另外也支持 `Shift + t` 单选游走到焦点元素的**顶元素**（含义见后）。


#### 选取扩展

在现有选取集的基础上，可以通过简单的键位操作将选取集进行扩展。扩展以当前焦点元素为参考，键位功能定义如下：

下面的扩展与焦点元素状态有关，会执行**同态**操作。

- `a`:               定位全部兄弟元素，使得与焦点元素状态相同。焦点不变。
- `e`:               定位相同标签名的兄弟元素，使之与焦点元素状态相同，焦点不变。
- `Shift + e`:       定位叔伯元素（父元素的兄弟元素）内的相同标签子元素，使之与焦点元素状态相同，焦点不变。**注**：可用于同态所在章节内的标题，或跨行的列头单元格（`<th>`）。
- `Alt + Shift + e`: 定位叔伯元素内相同标签且相同位置的子元素，使之与焦点元素状态相同，焦点不变。**注**：定位表格列单元格时位置为逻辑列（容错跨列）。


下面在移动焦点的同时按 `Ctrl + Shift` 键会执行**同态**操作。

- `Ctrl + Shift + ↑`: 同级向前（`previous`）状态扩展，支持数字指定距离，焦点移动到最终元素上。
- `Ctrl + Shift + ↓`: 同级向后（`next`）状态扩展，逻辑同上。


下面在移动焦点的同时按 `Ctrl + Shift` 键会同时执行**选取**操作。**注**：纵深方向上未设计同态逻辑（选取成员不会相互包含）。

- `Ctrl + Shift + ←`: 向上移动焦点到父元素上，同时选取父元素。支持数字指定距离。
- `Ctrl + Shift + →`: 向下移动焦点到目标子元素上，同时选取目标子元素。支持数字指定子元素下标。
- `Ctrl + Shift + t`:  移动焦点到当前元素的顶元素（`Top`）上并选取。


下面的操作与焦点元素状态无关，为固定的选取或取消选取逻辑。

- `v`:          同级反选：已选取的取消选取，未选取的则选取。焦点不变。
- `w`:          选取焦点元素内全部内容根元素添加到现有选取集。焦点移动到首个内容根元素（**注记**：这可体现出视觉上的变化，如 `<tr>` 到 `<td>`）。
- `Shift + w`:  同上选取逻辑，但新的元素插入到现有选取集头部。焦点移动同上。
- `q`:          取消焦点元素之外的同级已选取，保留焦点元素选取或自动选取（若未选取）。
- `Shift + q`:  取消焦点元素之外全部已选取，焦点逻辑同上。
- `ESC`:        取消全部选取（**注**：可撤销），同时焦点也会被取消。


#### 虚焦点支持

大部分的选取操作都是基于焦点元素，但焦点元素只有一个。对于需要批量操作的场景，这并不友好，因此这里引入了**虚焦点**的设计。

虚焦点是：**把当前选取集内的每一个成员都视为焦点元素**，并据此执行特定的选取操作。支持虚焦点的操作并不多，并且只能是选取的逻辑而非**同态**（未选取即无法成为虚焦点）。

因为每一个成员都变成了焦点，所以这里有一些限制：

1. 仅适用部分简单的选取，比如 `e` 选取同级同类元素。而对于复杂的叔伯元素选取（`Shift + e`），则不适用。
2. 平级操作时（如 `e`、`Shift + ↓`），选取集内的成员不能互为兄弟元素。即：每个成员只能是在其父元素内唯一选取的元素。纵向操作（如 `w`、`Shift + →`）则不限。

通常，支持虚焦点的操作的快捷键辅助键为`Alt`，可用操作共计**8**个：

- 平级类：`a`、`e`、`Shift + ↑`、`Shift + ↓`。每个成员在各自父元素内为单选，且仅为选取（**非同态**）。因为选取之后就失去了唯一性前提，所以这是**一次性**的。
- 纵深类：`w`、`Shift + →`、`Shift + ←`、`Shift + t`。向下操作时元素各自独立，向上操作时可能会有共同的父级元素（会自动去重）。

如果操作使用了虚焦点，平级类操作会保留原来的实际焦点不变，但纵深类操作则会将焦点移到整个选取集的首个成员上。


#### 路径辅助选取

在编辑器内容区的底部会显示当前焦点元素的**DOM树路径**，用鼠标单击其中任何一段，即可**选取**相应的元素。路径提供了清晰的节点树层次，可用于精确选取。

路径选取也有切换选取的逻辑，此时按住 `Ctrl` 键即可（否则为确定多选）。如果仅仅只是需要从路径上**聚焦**目标元素，则可以在单击的时候按住聚焦辅助键（`Alt`），此时只是改变焦点，而路径序列也不会重构。

**提示**：将鼠标滑过路径上的不同部分，会有其相应元素的背景阴影提示，便于用户识别其指代的目标。


#### 选取集排序

元素选取的方式非常多也十分地灵活，有时候需要让选取的元素保有看上去（DOM树方向）的顺序，以便于进一步的操作（比如后面的系统级复制/粘贴）。

因此这里设计了两个快捷排序操作。

- `s`:         选取集按DOM节点树排序，焦点定位到排序后的首个成员。
- `Shift + s`: 选取集按DOM节点树逆序，焦点定位同上（从DOM上看就是最后一个元素）。


### 编辑操作

与选取类操作以焦点元素为中心不同，编辑操作的目标就是整个选取集元素。焦点元素在这里有另外的含义——用于定位与操作关联的目标（详见后）。

借鉴**Vim**编辑器的操作便利性，这里大部分的操作都采用单个键位（加辅助键）执行。


#### 普通编辑

- `del`:               智能删除。删除选取集中的元素，但仅限于完整单元和可删除的中间结构元素（如 `<li>`、`<tr>`、`<dd>` 等）。
- `Shift + del`:       增强删除。删除选取集中元素的可编辑内容（即内容根元素内的内容）。
- `Alt + Shift + del`: 强制删除。删除选取集中的任意元素，有破坏性。**注**：提供用户自主的能力，如高级用户编辑异形表格时。

- `u`:  撤消（Undo）。
- `r`:  重做（Redo）。
- `x`:  逆序。将选取集内的同级兄弟元素逆序重排，不相邻的元素会保持其位置。
- `z`:  合并。将选取集内元素的内容合并为一，合并顺序按选取时的顺序，首个选取元素为容器。仅限于内容元素。
- `Alt + z`     对内容区全文执行规范化（normalize），通常在命令行执行搜索时需要。

- `c`:          分组克隆。以选取集内**相邻成员**为分组，整体克隆并插入原组之后（`after`）。选取集更新为新插入的元素。**特例**：如果选取集只有一个成员，支持数字指定克隆数量。
- `Shift + c`:  各别克隆。选取集内每一个成员分别克隆并插入自身之后（`after`）。选取集更新为新插入的元素。特例支持同上。

以下操作与焦点元素相关。

- `f`:          向内填充。将选取集**移动**填充到焦点元素之内（`fill`），焦点元素**不应当**被选取。若源为非法子元素，会取内容创建默认子单元。
- `Shift + f`:  克隆填充。将选取集**克隆**填充到焦点元素之内（`fill`），焦点元素可以作为数据源。非法子元素规则同上。
- `d`:          向内添加。将选取集**移动**添加到焦点元素之内（`append`），焦点元素**不应当**被选取。非法子元素规则同上。
- `Shift + d`:  克隆添加。将选取集**克隆**添加到焦点元素之内（`append`），焦点元素可以作为数据源。非法子元素规则同上。

- `i`:          移动前插入。将选取集**移动**并插入到焦点元素之前（`before`）。不可删除元素会移除其内容，焦点元素不可选取。
- `Shift + i`:  克隆前插入。将选取集**克隆**并插入到焦点元素之前（`before`）。焦点元素可以作为数据源。
- `b`:          移动后插入。将选取集**移动**并插入到焦点元素之后（`after`）。不可删除规则同上，焦点元素不可选取。
- `Shift + b`:  克隆后插入。将选取集**克隆**并插入到焦点元素之后（`after`）。焦点元素可以作为数据源。

> **注意：**<br>
> 插入的顺序是按照选取的顺序逐个提取，这样的设计可以有较大的灵活性。如果需要有序，可以先按 `s` 排序。<br>
> 上面的移动逻辑并不专注于元素自身的移动，它们只是一种方便，表达东西被**移动了**的逻辑，有时只是取走了其内容（如果位置不匹配的话）。<br>
> 这里的移动是跨层级的，适用任意目标位置。如果位置非法，内容会被自动转换。<br>


#### 移动与缩进

移动与缩进是编辑中常见的操作，这里的移动是元素自身的移动，但受限于内容单元规定的HTML结构，这里的移动仅限于兄弟元素之间的**平级**移动。

**缩进**的逻辑针对章节，因此操作仅适用于章节（`s1-s5`）或片区单元（`section`）单元，包含升级和降级两种操作。

- `Alt + ↑`:    平级向前移动。选取集成员在各自父元素内移动，支持数字指定距离，超出范围会导致部分或全部逆序插入。`0` 值表示端部，有汇聚插入效果。
- `Alt + ↓`:    平级向后移动。支持同上。
- `Alt + ←`:   片区单元（`section`）左缩进（升级），升级之后排列到当前父片区之后（`after`）。**注**：这是一种层级递升，不一定必然表现在视觉上。
- `Alt + →`:   片区单元（`section`）右缩进（降级），会在原地创建一个空的片区容器来包含被降级的片区。

> **注：**<br>
> 顶层章节的升级会被简单忽略，因为已经没有更高的层级可用了。<br>
> 末层章节（`s5`）再降级会变成没有 `role` 定义的**深片区**，深片区可以无限递进缩进。<br>


#### 进入微编辑

可以对元素内容进行简单的修订（`modify`），这通过进入一种被称为**微编辑**的状态实现。这种修订仅适用于内容元素，非内容元素无效果（会有错误提示）。

微编辑按选取的元素顺序逐个进入，编辑完成后按快捷键（详见后）确认退出。同一时刻只有一个元素处于微编辑状态。

- `m`:         进入微编辑，光标定位到单击点或可编辑内容元素的末端。
- `Shift + m`: 进入微编辑，光标定位到元素内容的前端。
- `Tab`        进入微编辑（同 `m`）。主要用于多个选取元素的顺序确认并进入下一个。

**提示**：非内容元素不能直接进入微编辑，此时可以按 `w` 或 `Shift + w` 选取其内容元素然后再继续。


#### 定位移动

有时侯需要内容保持绝对准确的相对位置，这时通常是设置其样式为 `position:absolute`。但这种定位方法需要用户了解 CSS 相关知识（对容器再设置 `position: relative` 样式），因此这里并不鼓励，用户需要自己在特性设置面板里编辑 `style` 特性来实现。

不过如果元素设置了绝对定位，这里提供方便的操作来微调其位置。

- `Ctrl + ←`: 向左移动**1**像素。如果加按 `Shift` 则以**10**像素为单位。
- `Ctrl + →`: 向右移动**1**像素。`Shift` 键同上。
- `Ctrl + ↑`:  向上移动**1**像素。`Shift` 键同上。
- `Ctrl + ↓`:  向下移动**1**像素。`Shift` 键同上。

> **注：**<br>
> 上面的箭头键为真实的箭头键（非 `hlkj`），否则与单选游走冲突。<br>
> 对于没有设置绝对定位的元素，这些组合键操作会被简单忽略。<br>
> 插图单元的讲解在样式文件中有 `position:absolute` 和容器的 `position: relative` 定义。<br>


#### 复制和粘贴事件

普通模式下支持选取集元素的**复制、剪切和粘贴**，这些操作由系统的复制、剪切和粘贴操作触发。普通模式下元素并不是可编辑的，因此这里的操作规则如下。

- **复制**：提取被选取元素的文本内容（`textContent`）到剪贴板，多个选取元素的内容以换行符分隔。
- **剪切**：规则同复制，但同时会删除元素本身，如果元素可以被删除的话。
- **粘贴**：以换行符切分剪贴板里的文本内容，分别对应添加到选取集元素（或根内容）内。如果只选取了一个元素，则内容不切分。默认为末尾添加（`append`）方式，加按 `Shift` 键为覆盖（`fill`）方式。

> **注意：**
> 粘贴里的分组插入仅与**选取**有关。比如选取一个 `<tr>`，会将相同的内容插入到内部所有的单元格中，如果需要与单元格一一对应，则应当选取单元格。
> 提取或插入的分组是以选取顺序为一一对应的（更灵活），但可能有点混乱的感觉。如果需要DOM的顺序，按 `s` 键先排序即可。


### 杂项功能

- `n`:              显示焦点元素关联的插入面板（并聚焦）。
- `p`:              打开单元属性编辑面板。
- `Alt + p`:        导出文章内容源码（打开导出对话框）。
- `Alt + Shift + p` 同上导出内容源码，但会在适当的位置插入大纲（目录）。
- `Ctrl + s`:       手动执行本地暂存（localStorage）。
- `g`:              章节跳转。根据键入的章节序列（如：`3.12.5`），将目标章节显示到当前视口。**注**：键入需要内容区聚焦。


### 关于格式刷

将选取集内的元素样式应用为**焦点元素**的样式。焦点元素可以为选中或非选中状态（实质兼容）。

这与普通编辑器（如 Word）中的格式刷操作逻辑稍有不同。



## 录入面板

与普通编辑器的原地输入不同，本设计中的内容录入主要通过内容面板来实现。

因为文章的内容单元有结构性限制，即该内容只能出现在什么位置（比如 `<address>` 应当只存在于 `<footer>` 内），所以录入面板的创建方式更合理，因为这样可以很方便的限定可以在目标位置创建什么内容。

目标位置用选取元素来标识，新的内容可以插入到该位置之前、之后或内部。如果选取了多个元素，可插入项目是各目标可插入项目的交集，且内容会同时插入到多个目标位置处。


### 快捷键

#### 录入文本框 <textarea>

- `Alt+F` **切换**录入框最大化（充满面板）。
- `Ctrl+Enter` 直接**提交**插入，效果同单击插入按钮。**注**：焦点会保持在录入框内。
- `Alt+Ctrl+Enter` 同上直接提交。但如果录入框已铺满，恢复为普通状态。


#### 表格单元录入 <table:th|td>

- `Enter` 纵向向下切换单元格（并选取）。
- `Shift + ↓` 同上效果。
- `Shift + ↑` 纵向向上切换单元格并选取。
- `Shift + Enter` 插入换行符（浏览器自身功能）。

- `粘贴` 内容以换行符切分，从焦点单元格开始，同行后续单元格连续粘贴（内容覆盖式）。
- `Shift + 粘贴` 普通方式粘贴，可能为纯文本（浏览器能力）。

**提示**：智能切分粘贴只支持单行单元格序列。如果需要一次性对多行粘贴，可以插入后在内容区操作。



## 修订模式

内容元素的 `contenteditable` 特性被设置为 `true`，此时即进入修订模式，编辑范围严格受限于容器元素之内。这种模式应当仅用于简单的文本修改。

在这种模式中，`Enter` 键的功能被严格限制，以回避不同浏览器的兼容性问题。

- `Enter`           确认并退出。**注**：会提前执行 `normalize`。
- `Shift + Enter`   插入一个换行元素 `<br>`，或者在 `<pre>` 元素内插入一个换行字符 `\n`。**注**：浏览器默认行为。
- `Ctrl + Enter`    新建一个同类空行，原行确认，光标在新行内。仅限于段落类 `<p:xx>` 和列表项元素 `<li>, <dt>, <dd>`。
- `Alt + Enter`     新建一个逻辑空行。特定于 `dt > dd` 和 `td|th ~ tr` 两种情况。
- `Tab`             完成并切换。功能与 `Enter` 类似，但会取消当前元素的选取并进入下一个已选取元素的微编辑（如果有）。
- `ESC`             取消当前修订并退出微编辑。元素选取保持。

> **附：换行兼容性**<br>
> `Enter` 的行为在不同浏览器之间差异较大，`Shift+Enter` 则较为一致。<br>
> `<pre>` 元素微编辑修订后，其中的换行元素 `<br>` 会被强制替换为换行字符 `\n`，以保证内容的一致性。<br>


### 代码元素

对于普通的内容元素，修订时是所见即所得的。但对于代码内容，则是纯文本的（语法标注 `<b>` 会被清除），系统会在确认提交时重新解析语法。

**提示**：后期可能提供代码编辑时的即时解析高亮能力。



## 属性框

选中目标元素或相同类型的多个单元，如果该类型有属性可修改，键入快捷键 `P` 或从上下文菜单中单击属性条目，可打开属性编辑对话框。

如果目标只是单个单元，修改的属性条目会逐一应用：文本框内的空串会导致该条目的属性被移除，其它形式的控件则遵循所显示的意义。

但如果目标是多个单元，则属性对应的条目控件存在**不确定**态，即 `indeterminate`。不确定态的条目如果未作修改（控件保持原样），则表示各条目的对应属性也会保持原样。这为多个目标的部分属性执行批量修改提供了可能性。表示不确定态的控件状态约定如下：

- 文本框：      包含 `<input:text>` 和 `<textarea>` 两种，无值（空串）时表示不确定态。`$.val()` 取值为一个空串。
- 单选按钮组：  没有任一按钮被选中时，表示不确定态。`$.val()` 取值为 `null`。
- 复选按钮：    浏览器支持其不确定态的特殊外观（通常是小方框内一个短横线），同时该控件的 `indeterminate` 属性值为 `true`。取值时应当检查 `indeterminate` 属性而不是简单地调用 `$.val()`。
- 条目选单：    即 `<select>`，类似单选按钮组，没有任一条目被选中时为不确定态。`$.val()` 取值为 `null`。

**注意**：不确定态区分仅适用于多目标选取时。



## 命令行

### 搜索（/）

可以对全文或已选取的集合范围执行文本搜索，搜索的结果会被标记为特殊的 `<mark>` 元素。

文本的搜索以文本节点为上下文，不支持跨节点文本的搜索。这既是一种简化方便，也可能有它的合理性：既然文本被断开了，就认为横贯断点的文本不应当被匹配。

激活搜索的指令符为斜线（`/`）。焦点进入命令行后，遵循如下格式：

- `Hello`       检索文本 `Hello`，回车后执行。如果已经存在选取集，则在选取集范围内执行检索。下同。
- `abc/xyz/ok`  检索文本 `abc/xyz/ok`，文本内的斜线只是普通字符。

- `/[0-9a-f]/i` 这是一个正则表达式，由前置的 `/` 标示出来。
- `/[0-9a-f]`   正则表达式**格式错误**，缺乏结尾 `/`。会被视为一个普通的字符串。
- `/[0-9a-f]/`  合法的正则表达式。
- `/[0-9a-f]/ ` 末尾的空格使得这只是一个普通字符串，这也是搜索正则式串本身的一个小技巧。

> **注记：**<br>
> 不支持直接在表达式中定义替换功能，仅仅只是简单地检索文本内容。<br>
> 检索结果会封装为（`<mark>`）并选取，因此可以通过其它方式操作目标。比如替换（粘贴+内容提升）、封装（转换）或删除（按 `Delete`）。<br>


### 查询（?）

保留问号（`?`）指令符用于未来的社区交互逻辑。



## 注记

### 单元移动/转换

- 同级兄弟元素间可自由移动，但不能跨越固定性单元。
- 跨容器单元的移动涉及转换，如果目标位置合法则简单移动，否则转换构造为默认的合法单元插入。


### 内容提升

在严格的规范化内容结构里，片区与内容单元是互斥的逻辑。为便于用户操作，编辑器提供写作时的容错，但在文章提交类操作中提供规范化合并选项。

**另**：工具栏的内容提升按钮除了支持内容元素外，片区单元（容器）也是适用的。


### 表格的容错编辑

通过特性编辑面板，用户可以修改单元格的 `rowspan` 和 `colspan` 特性，因此对于懂得 HTML 结构的专业用户来说，他们可以自由构建不规整的表格结构。因此，编辑器不阻止用户删除/插入独立的单元格。

但这种能力是用户自有的，如果克隆表格行（`<tr>`），编辑器并不检查单元格的这两个特性，而只是简单地参考表格的 `$.Table` 实例的内在状态值（列头和列数）进行处理。



### 兼容性依赖

修订模式下需要浏览器的 `document.execCommand` 支持，以实现从外部插入内容时，可以直接使用浏览器的**Undo/Redo**能力，否则撤销和重做需要编写复杂的代码。
