<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>编辑器操作手册</title>
<link rel="stylesheet" href="../styles/example/main.css" />
<link rel="stylesheet" href="../styles/example/codes.css" />
<link rel="stylesheet" href="../base/tpb/default.css" />
<script src="../base/tquery/tquery.min.js"></script>
<style>
    body {
        margin: 0;
    }
    main {
        width: 800px;
        margin-left: 21em;
    }
</style>
<script type="module" async>
    import { Tpb } from "../base/tpb/tpb.esm.js";
    // 大纲导航：
    // 单击链接条目定位到目标章节。
    Tpb.build(
        document.querySelector('nav'),
        { on: "click(a)|evo(2) paths('nav[role=toc]', 'li') str('>section:nth-of-type(', ')') join str('/', '>h2') $('article') pop $(_1) intoView" }
    );
    // 列表滚动隐显
    // 单击目录标题条子表折叠
    Tpb.build(
        document.querySelector('nav>ol'),
        {
            on: "mouseenter|('auto'); mouseleave|('hidden'); click(~h5)|evo(2) parent fold(2)",
            to: "|css('overflow-y'); |css('overflow-y')"
        }
    )
</script>
</head>
<body>
    <main class="content">
        <h1>快速入门</h1>
        <nav role="toc">
            <h4>目录</h4>
            <ol role="cascade">
                <li>
                    <h5><a>内容区和功能区</a></h5>
                    <ol>
                        <li><a>内容区录入</a></li>
                        <li><a>划选创建</a></li>
                        <li>
                            <h5><a>普通模式</a></h5>
                            <ol>
                                <li><a>焦点移动</a></li>
                                <li><a>选取切换</a></li>
                            </ol>
                        </li>
                    </ol>
                </li>
                <li><a>修订模式</a></li>
                <li><a>内容源码导出</a></li>
            </ol>
        </nav>
        <article>
            <header>
                <ul>
                    <li><kbd>F2</kbd>：左侧大纲面板<em>隐显</em>切换。</li>
                    <li><kbd>F3</kbd>：下方功能区主面板<em>隐显</em>切换。</li>
                    <li><kbd>F4</kbd>：右侧帮助面板<em>隐显</em>切换。</li>
                    <li><kbd>F6</kbd>：内容区底部焦点元素DOM路径提示栏<em>隐显</em>切换。</li>
                    <li><kbd>F7</kbd>：打开插件对话框（按<kbd>ESC</kbd>键可取消显示）。</li>
                    <li><kbd>F8</kbd>：内容区聚焦。</li>
                    <li><kbd>F9</kbd>：当前在显主面板（大纲、功能区、帮助）状态切换，方便用户充分预览内容区。</li>
                    <li><kbd>F10</kbd>：当前窗口最大化切换。</li>
                    <li><kbd>ESC</kbd>：各种取消。支持<code>选取集</code>、<code>上下文菜单</code>、<code>内联创建菜单</code>、<code>模态框</code>、<code>修订模式</code>、<code>前置数字</code>、<code>录入框平铺</code>等。</li>
                </ul>
            </header>
            <section role="s1">
                <h2>内容区和功能区</h2>
                <header>
                    <p>除了左右两侧的辅助面板（左：大纲视图；右：在线帮助），中间区域由上下两个部分构成。</p>
                    <p>上方是包含顶部<strong>工具栏</strong>和底部<strong>路径</strong>提示的文章内容区，文章内容会按真实的样式渲染（真正的所见即所得）。单击任意目标（段落、文本、图片、媒体等）可选取该目标，然后用特定的热键执行各种操作，如删除、转换、移动、复制、属性修改、在目标前后插入新的内容等等。</p>
                    <p>下方是编辑器的功能区，包含了<strong>内容</strong>录入、内联<strong>样式</strong>设置、目标元素<strong>特性</strong>管理（添加、删除）、目标元素<strong>源码</strong>显示、修改，以及高级的<strong>脚本</strong>执行等5个子面板。</p>
                </header>
                <section role="s2">
                    <h2>内容区录入</h2>
                    <p>本编辑器中的文章内容并不是任意结构的HTML源码。在HTML中，文章的段落由一个<code>&lt;p&gt;</code>标签封装，有序列表由一个<code>&lt;ol&gt;</code>加无数个<code>&lt;li&gt;</code>子元素封装，子章节由一个<code>&lt;section&gt;</code>和一个<code>&lt;h2&gt;</code>标题以及任意数量的多种内容单元构成……由此可知，不同的内容单元需要遵循特定的结构逻辑。</p>
                    <p>因此，在一个内容单元前后或内部<strong>可以插入什么</strong>，是存在<strong>结构约束</strong>的。</p>
                    <p>选取目标单元后，可以在其前后插入的内容单元会在录入面板的左侧罗列出来。如果需要向内插入，切换列表框顶部的选单即可，这样系统会根据目标单元的类型罗列出可以向内插入的内容单元。</p>
                    <p>单击清单中的条目，右侧的区域就会显示插入需要使用的文本框或各种控件（就像普通的表单提交）。</p>
                    <aside>
                        <h4>设计理由：</h4>
                        <p>用额外的文本框（和表单控件）而不是在内容区直接编辑来录入内容，是一种必要的复杂化设计。</p>
                        <p>它增加的复杂性并不太多，但却可提供严格的结构逻辑，让内容区的源码结构规范，因此也避免了浏览器兼容性和浏览器自身编辑设计带来的不完美。</p>
                        <p>通过这样严格结构化的内容录入，实际上会让文章的源码最大幅度精简，甚至做到了没有冗余。</p>
                        <p>另外，基于严格结构的源码，还做到了让外部样式可以共享而不会有任何问题。</p>
                    </aside>
                </section>
                <section role="s2">
                    <h2>划选创建</h2>
                    <p>在内容区中，除了已选取元素的上下文菜单之外，我们可以通过鼠标划选目标文本来创建内联单元（如重点<code>&lt;strong&gt;</code>、强调<code>&lt;em&gt;</code>、代码<code>&lt;code&gt;</code>、标记<code>&lt;mark&gt;</code>等等）。鼠标划选之后会自动弹出一个小创建面板（类似于上下文菜单），单击其中条目或键入快捷键（部分可用）即可。<strong>注意</strong>：划选的内容必须完整嵌套，否则不会弹出创建面板。</p>
                </section>
                <section role="s2">
                    <h2>普通模式</h2>
                    <header>
                        <p>编辑器自然呈现的状态，就是普通模式。单击内容区任意目标即可选中目标，此时通常会有UI上的表现（依主题的样式设计不同而不同）。之后即可执行各种操作。</p>
                        <aside>
                            <h4>提示：</h4>
                            <p>单击编辑器上方左侧的操作手册链接即可导入该文章到内容区，在此基础上可尝试任意编辑操作，包括撤销和重做。</p>
                            <p>文章内容的导入也在编辑的历史栈中，因此也可以通过撤销恢复导入之前的内容区状态。</p>
                        </aside>
                    </header>
                    <section role="s3">
                        <h2>焦点移动</h2>
                        <p>可以用4个箭头键移动当前的<strong>选取焦点</strong>（非DOM节点焦点），默认箭头键采用Vim编辑习惯中的<code style="font-weight: bold; color: rgb(204, 0, 102);">hjkl</code>表达箭头方向。</p>
                        <ul>
                            <li><kbd>K</kbd>：向上箭头。平级移动，定位到前一个（<code>prev</code>）兄弟元素。</li>
                            <li><kbd>J</kbd>：向下箭头。平级移动，定位到下一个（<code>next</code>）兄弟元素。</li>
                            <li><kbd>H</kbd>：向左箭头。纵向移动，定位到父元素（<em>父级方向</em>）。</li>
                            <li><kbd>L</kbd>：向右箭头。纵向移动，定位到首个子元素（<em>子级方向</em>）。</li>
                        </ul>
                        <aside>
                            <h4>注意：</h4>
                            <p>需要在编辑器或内容区拥有浏览器DOM节点焦点时，热键才有效（可激发<code>keydown</code>事件）。单击编辑器任意位置可以聚焦到编辑器，单击顶部工具栏或热键<kbd>F8</kbd>可聚焦到主内容区。</p>
                        </aside>
                    </section>
                    <section role="s3">
                        <h2>选取切换</h2>
                        <p>空格键（<kbd>Space</kbd>）和回车键（<kbd>Enter</kbd>）对当前焦点元素进行选取切换。如果需要多选，可按住<kbd>Ctrl</kbd>键后单击目标元素，再次单击也为取消选取（切换）。</p>
                        <p>更详细的选取操作和编辑操作请参考上方的操作手册……此略。</p>
                    </section>
                </section>
            </section>
            <section role="s1">
                <h2>修订模式</h2>
                <p>如果需要对已经录入的内容（内容区）进行修改，可键入<kbd>M</kbd>热键进入修订状态，此时就是浏览器自身的编辑功能支持。但在此模式下，浏览器自身实现的编辑功能被严格限制，以避免不同浏览器带来的兼容性问题。比如回车键（<kbd>Enter</kbd>）的换行功能就被屏蔽，修改为确认键（即确认修改的内容并退出修订模式）。</p>
                <p>浏览器编辑功能中<kbd>Shift+Enter</kbd>的<code>&lt;br&gt;</code>插入依然被保留，因为大部分浏览器都是这一行为。但粘贴的内容会被转化为纯文本，以消除原始HTML带来的影响。</p>
                <p>另外，回车键可以通过加按辅助键<kbd>Ctrl</kbd>和<kbd>Alt</kbd>获得两种智能换行功能：前者是新建一个同类新行（比如在<code>&lt;p&gt;</code>中修订时，<kbd>Ctrl+Enter</kbd>会新建一个<code>&lt;p&gt;</code>元素），后者则是新建一个逻辑新行（比如在<code>&lt;dt&gt;</code>中修订时，<kbd>Alt+Enter</kbd>会新建一个<code>&lt;dd&gt;</code>新行）。两种新建方式中，原来编辑的行都会被自动确认。</p>
                <p>修订内容确认之后，其改变会作为一个整体撤销（<kbd>U</kbd>键）或重做（<kbd>R</kbd>键）。</p>
                <p>如果在修订模式下想取消修改并退出修订，可简单的按<code>ESC</code>键即可。这也是取消大部分临时状态的热键，比如模态框、当前选取、前置数量（对某一操作的前置计数）等。</p>
            </section>
            <section role="s1">
                <h2>内容源码导出</h2>
                <p>HTML是一个开放的标准，因此虽然文章版式美观，结构精简，它不是封闭的专有技术。你可以将文章的内容源码简单地导出（虽然用浏览器的<em>DevTools</em>也可以做到这一点），并格式化为缩进良好的最终源码。</p>
                <ul>
                    <li><kbd>Alt+P</kbd>：导出选取单元或全文内容源码，会自动打开导出对话框。</li>
                    <li><kbd>Alt+Shift+P</kbd>：导出全文内容源码，同时会在适当的位置插入文章目录（大纲）。</li>
                </ul>
                <p>前一个导出是针对选取集成员的，如果内容区无选取（可按<kbd>ESC</kbd>）则导出全部内容。后一种增强导出仅针对全部内容，无论当前是否已有选取。</p>
            </section>
        </article>
    </main>
</body>
</html>