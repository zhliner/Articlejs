<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>编辑器操作手册</title>
<link rel="stylesheet" href="../styles/example/main.css" />
<link rel="stylesheet" href="../styles/example/codes.css" />
<link rel="stylesheet" href="../base/tpb/default.css" />
<script src="../base/tquery/tquery.min.js"></script>
<style>
    body {
        margin: 0;
    }
    main {
        width: 800px;
        margin-left: 21em;
    }
</style>
<script type="module" async>
    import { Tpb } from "../base/tpb/tpb.esm.js";
    // 大纲导航：
    // 单击链接条目定位到目标章节。
    Tpb.build(
        document.querySelector('nav'),
        { on: "click(a)|evo(2) paths('nav[role=toc]', 'li') str('>section:nth-of-type(', ')') join str('/', '>h2') $('article') pop $(_1) intoView" }
    );
    // 列表滚动隐显
    // 单击目录标题条子表折叠
    Tpb.build(
        document.querySelector('nav>ol'),
        {
            on: "mouseenter|('auto'); mouseleave|('hidden'); click(~h4)|evo(2) parent fold(2)",
            to: "|css('overflow-y'); |css('overflow-y')"
        }
    )
</script>
</head>
<body>
    <main class="content">
        <h1>编辑操作</h1>
        <nav role="toc">
            <h3>目录</h3>
            <ol role="cascade">
                <li>
                    <h4><a>普通模式</a></h4>
                    <ol>
                        <li>
                            <h4><a>焦点元素</a></h4>
                            <ol>
                                <li><a>焦点移动</a></li>
                                <li><a>附：顶元素</a></li>
                            </ol></li>
                        <li>
                            <h4><a>元素选取</a></h4>
                            <ol>
                                <li><a>鼠标点选</a></li>
                                <li><a>按键选取</a></li>
                                <li><a>选取扩展</a></li>
                                <li><a>虚焦点支持</a></li>
                                <li><a>路径辅助选取</a></li>
                                <li><a>选取集排序</a></li>
                            </ol></li>
                        <li>
                            <h4><a>编辑操作</a></h4>
                            <ol>
                                <li><a>普通编辑</a></li>
                                <li><a>移动与缩进</a></li>
                                <li><a>进入微编辑</a></li>
                                <li><a>定位移动</a></li>
                                <li><a>复制和粘贴事件</a></li>
                            </ol></li>
                        <li><a>杂项功能</a></li>
                        <li><a>格式刷</a></li>
                    </ol></li>
                <li>
                    <h4><a>录入面板</a></h4>
                    <ol>
                        <li>
                            <h4><a>快捷键</a></h4>
                            <ol>
                                <li><a>录入文本框&lt;textarea&gt;</a></li>
                                <li><a>表格单元录入&lt;th|td&gt;</a></li>
                            </ol></li>
                    </ol></li>
                <li>
                    <h4><a>修订模式</a></h4>
                    <ol>
                        <li><a>代码元素</a></li>
                    </ol></li>
                <li><a>属性框</a></li>
                <li>
                    <h4><a>命令行</a></h4>
                    <ol>
                        <li><a>搜索（/）</a></li>
                        <li><a>查询（?）</a></li>
                    </ol></li>
                <li>
                    <h4><a>注记</a></h4>
                    <ol>
                        <li><a>单元移动/转换</a></li>
                        <li><a>表格的容错编辑</a></li>
                        <li><a>兼容性依赖</a></li>
                    </ol></li>
            </ol>
        </nav>
        <article>
            <header>
                <p>与常见的编辑器不同，本编辑器有<strong>两种</strong>模式：</p>
                <ol>
                    <li><strong>普通模式</strong>。键盘友好，用户可以通过快捷键（通常就是一个字符键）执行各种操作，如：复制、移动、删除、章节缩进、本地保存、源码导出、撤销或重做等。同时，这也是从下方<strong>主面板区</strong>插入各种内容的模式。</li>
                    <li><strong>修订模式</strong>。对录入的内容作小量修改时使用，此时回车键被严格限制，以兼容不同浏览器对<code>contenteditable</code>元素的<kbd>Enter</kbd>行为。该模式有时也称为<strong>微编辑</strong>模式。考虑便捷性，该模式下也支持创建<em>同类或逻辑新行</em>的能力。</li>
                </ol>
                <p>进入<em>修订模式</em>很简单：选中目标元素，键入热键<kbd>M</kbd>或<kbd>Tab</kbd>键（后者适用多个选中目标的连续进入）。或者，右击鼠标展开上下文菜单，点选<em>修改</em>条目进入。</p>
            </header>
            <section role="s1">
                <h2>普通模式</h2>
                <header>
                    <p>编辑器初始的常规状态即为<em>普通模式</em>。此时无法对文本进行编辑，但可以对内容进行各种控制。</p>
                    <ul>
                        <li><strong>选取</strong>：鼠标单击选中目标元素，按 <kbd>Ctrl</kbd> 键单击可多选或切换选取。另外还有一些<em>扩展选取</em>的快捷方式。被选中的多个目标元素称为<strong>选取集</strong>，它们是接下来各种操作的目标对象。</li>
                        <li><strong>移动</strong>：将选取集元素移动到焦点元素之前、之后或内部。如果源元素不是目标位置合法的类型，会自动转换。平级移动非常简单（<kbd>Alt+↑</kbd> 或 <kbd>Alt+↓</kbd>），也不需要转换。</li>
                        <li><strong>克隆</strong>：将选取集元素克隆并插入到焦点元素之前、之后或内部，位置不合法时也会自动转换。原地克隆也很简单，键入热键<kbd>C</kbd>即可，同时也支持<em>前置数字</em>指定克隆的份数。</li>
                        <li><strong>删除</strong>：大部分元素可以按<kbd>Delete</kbd>键直接删除，但拥有固定结构（如表格）的内部元素不可以。删除操作会智能判断目标类型，不能直接删除的只会移除其内容（而不是目标本身）。当然，你也可以<strong>强制删除</strong>它。</li>
                        <li><strong>缩进</strong>：仅适用章节片区。对选中的章节单元进行<em>升级</em>或<em>降级</em>。</li>
                        <li><strong>录入</strong>：从下方主面板的内容标签页里可以录入各种内容单元，这也是编辑器主要的内容导入方式。内容单元有自己的结构逻辑，在什么位置可以插入什么单元，会在左侧的条目选单上体现。</li>
                        <li><strong>转换</strong>：对特定类型的单元可以进行类型转换，比如将多个段落转换为列表、无序列表转为有序列表等。选中一个或多个同类目标，右击弹出<em>上下文菜单</em>即可找到转换<em>子菜单</em>。</li>
                        <li><strong>创建</strong>：在一个文本行上用鼠标<strong>划选</strong>后，会弹出内联单元创建菜单，单击目标条目或热键即可创建内联单元。</li>
                    </ul>
                    <aside>
                        <h3>附：快捷辅助键设计原则</h3>
                        <p>普通模式下大量的操作都可以使用热键（快捷键）完成，这可以极大地提高效率。为便于记忆，热键设定遵循如下原则。</p>
                        <ul>
                            <li><kbd>X</kbd>: 某单个键位，完成某个功能操作。如<kbd>C</kbd>键复制当前选取集并原地插入（<code>after</code>）。</li>
                            <li><kbd>Shift</kbd>+<kbd>X</kbd>: 当前功能增强。如<kbd>Shift+C</kbd>键复制当前选取集，各别插入原元素之后（<code>after</code>）。</li>
                            <li><kbd>Ctrl</kbd>+<kbd>X</kbd>: 当前功能相关的衍生功能。如<em>修订模式</em>下的<kbd>Ctrl+Enter</kbd>创建一个同类新行。</li>
                            <li><kbd>Alt</kbd>+<kbd>X</kbd>: 提供当前功能的额外能力，关联性更远一些。如<kbd>Alt+←</kbd>提升当前章节层级。</li>
                        </ul>
                        <p>当然，用户也可以根据自己的喜好修改系统默认的热键配置（详见：<em>base/shortcuts.js</em>）。</p>
                    </aside>
                </header>
                <section role="s2">
                    <h2>焦点元素</h2>
                    <header>
                        <p>选取集是元素按选中的先后顺序加入集合的，通常最后添加的元素拥有焦点。焦点是为了方便元素选取而设计的一个热点，大部分选取操作就是针对焦点元素而来。拥有焦点的元素即是焦点元素。</p>
                        <p role="tips"><strong style="
            /* color: #328ec3; */
        ">提示</strong>：内容区底部的路径栏显示的即是<em>焦点元素</em>的DOM路径信息。</p>
                        <p>焦点可以在任意元素间移动，通过鼠标单击点选，或者键入方向键来实现。这里的焦点与浏览器DOM元素焦点并不是同一个东西，为了与之相区别，我们可以视之为一种<strong>选取焦点</strong>。但下面为简单起见，统一称之为<strong>焦点</strong>。</p>
                    </header>
                    <section role="s3">
                        <h2>焦点移动</h2>
                        <p>选取焦点可通过键盘上的几个方向键移动，移动分为两个维度：</p>
                        <ul>
                            <li><strong>兄弟/平级</strong>：在DOM树的同级元素方向上，即兄弟元素间移动。</li>
                            <li><strong>父子/纵向</strong>：在DOM树的纵深方向上，即父子元素间的跨层级移动。</li>
                        </ul>
                        <p>借鉴Vim中的便捷方向键<code style="font-weight: bold; color: rgb(204, 0, 102);">hjkl</code>（左下上右），以及DOM节点树的逻辑，方向键含义如下：</p>
                        <ul>
                            <li><kbd>↑/K</kbd>： <strong>平级移动</strong>，定位到前一个（<code>prev</code>）兄弟元素。支持数字指定移动距离，默认值 <code>1</code>（即前一个兄弟元素），特殊值 <code>0</code> 表示头部首个兄弟元素。</li>
                            <li><kbd>↓/J</kbd>： <strong>平级移动</strong>，定位到下一个（<code>next</code>）兄弟元素。支持数字指定移动距离，默认值 <code>1</code>（即下一个兄弟元素），特殊值 <code>0</code> 表示末尾最后一个兄弟元素。</li>
                            <li><kbd>←/H</kbd>：<strong>纵向移动</strong>，定位到父元素（<em>父级方向</em>）。支持数字指定移动层级，默认值 <code>1</code>（即父元素）。</li>
                            <li><kbd>→/L</kbd>：<strong>纵向移动</strong>，定位到子元素（<em>子级方向</em>），支持数字指定子元素位置下标，默认值 <code>0</code>（即首个子元素），负值表示从末尾算起（<code>-1</code>&nbsp;为最后一个子元素）。</li>
                        </ul>
                        <p role="tips"><strong>提示</strong>：在内容区拥有浏览器焦点时（可按<kbd>F8</kbd>），键入数字可设置之后操作的前置计数。左下角状态栏有数字提示，按<kbd>ESC</kbd>取消计数。</p>
                    </section>
                    <section role="s3">
                        <h2>附：顶元素</h2>
                        <p>顶元素是一个<strong style="line-height: 26.4px;">虚拟</strong>的根元素，方便用户快速定位到经常操作的目标。热键<kbd>T</kbd>可以将焦点移动到当前焦点元素的<strong>顶元素</strong>上。</p>
                        <ul>
                            <li>对于内联单元来说，顶元素是其所在行块的<strong>内容行</strong>元素。如<code>&lt;p&gt;</code>、<code>&lt;li&gt;</code>、<code>&lt;dd&gt;</code>和<code>&lt;td&gt;</code>等。</li>
                            <li>对于行块单元内的中间结构元素来说，其顶元素为单元自身的<strong>根元素</strong>。如<code>&lt;tr&gt;</code>的顶元素为<code>&lt;table&gt;</code>，<code>&lt;li&gt;</code>的顶元素为其所在的<code>&lt;ol&gt;</code>或<code>&lt;ul&gt;</code>等。</li>
                            <li>对于内联单元内的结构元素来说，其顶元素即是该内联<strong>单元本身</strong>。如<code>&lt;rt&gt;</code>的顶元素为<code>&lt;ruby&gt;</code>，SVG系子元素的顶元素为其所属根容器<code>&lt;svg&gt;</code>。</li>
                        </ul>
                    </section>
                </section>
                <section role="s2">
                    <h2>元素选取</h2>
                    <section role="s3">
                        <h2>鼠标点选</h2>
                        <p>通过鼠标<strong>单击</strong>的方式可以定位焦点元素并实现选取或取消选取。</p>
                        <ul>
                            <li><strong>单选</strong>：<code>单击</code>。鼠标单击目标元素即选中目标，但之前的选取会被取消。</li>
                            <li><strong>多选</strong>：<kbd>Ctrl</kbd> + <code>单击</code>。目标元素会被添加到当前选取集内。如果目标已经是被选取的，则会取消选取（<strong>切换</strong>）。</li>
                            <li><strong>聚焦</strong>：<kbd>Alt</kbd> + <code>单击</code>。仅将选取焦点移动到目标元素上，没有选取作用。这在某些需要定位的操作中很有用。</li>
                        </ul>
                        <p>下面的鼠标选取有一定的智能性，与焦点元素有关。</p>
                        <ul>
                            <li><strong>跨选</strong>：<kbd>Shift</kbd> + <code>单击</code>。将焦点元素到目标元素的同级兄弟元素全部<strong>选取</strong>或<strong>取消选取</strong>。如果目标元素层级较深，自动取与焦点元素同级的容器元素为目标。焦点同时移动到目标上。与起始的焦点元素保持<em>相同状态</em>（选取与否）可被称为<strong>同态</strong>。</li>
                            <li><strong>浮选</strong>：<kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <code>单击</code>。以焦点元素所在层级为依据，对目标元素的同层级容器元素执行<strong>切换</strong>选取。如果目标不在焦点元素所属父容器内则无效（简单忽略）。</li>
                        </ul>
                        <p>下面的鼠标选取与焦点元素无关。</p>
                        <ul>
                            <li><strong>父选</strong>：<kbd>Alt</kbd> + <kbd>Ctrl</kbd> + <code>单击</code>。选取鼠标单击的目标元素的父元素，将之添加到当前选取集。如果目标的父元素已经选取，则为取消选取（<em>多选</em>/<em>切换选取</em>逻辑）。这在选取表格行元素（<code>&lt;tr&gt;</code>）时很有用。</li>
                            <li><strong>父焦</strong>：<kbd>Shift</kbd> + <kbd>Alt</kbd> + <code>单击</code>。仅将选取焦点移动到单击目标的父元素上，不影响当前选取集。</li>
                        </ul>
                        <aside>
                            <h3>同态：</h3>
                            <p>焦点元素有选取和非选取两者状态，让目标元素与焦点元素状态相同，可简称为<strong>同态</strong>操作。</p>
                        </aside>
                    </section>
                    <section role="s3">
                        <h2>按键选取</h2>
                        <p>如果焦点元素已经存在（<em>鼠标点选</em>），通过简单的键盘按键，我们可以实现更多的选取操作。</p>
                        <ul>
                            <li><kbd>Space</kbd> 或&nbsp;<kbd>Enter</kbd>：<strong>选取切换</strong>。焦点元素选取或取消选取。不影响其它已选取元素，类似&nbsp;<kbd>Ctrl</kbd> + <code>单击</code> 的效果。</li>
                            <li><kbd>Shift</kbd> + <em>箭头键</em>：<strong>单选游走</strong>。移动焦点的同时改选到目标元素，其它选取被取消，类似鼠标<code>单击</code>的效果。</li>
                        </ul>
                        <p role="tips"><strong>提示</strong>：支持 <kbd>Shift</kbd> + <kbd>T</kbd> 单选游走到焦点元素的<strong>顶元素</strong>。顶元素含义见后。</p>
                    </section>
                    <section role="s3">
                        <h2>选取扩展</h2>
                        <p>在现有选取集的基础上，通过简单的键位操作可以将选取集进行<em>扩展</em>。扩展以当前<strong>焦点元素</strong>为参考，键位定义如下：</p>
                        <p>下面的<em>扩展</em>与焦点元素状态有关，会执行<em>同态</em>操作。</p>
                        <ul>
                            <li><kbd>A</kbd>：<code>All</code>，定位<strong>全部</strong>兄弟元素，使得它们与焦点元素的状态相同。焦点不变。</li>
                            <li><kbd>E</kbd>：<code>Element</code>，定位<strong>同类</strong>的兄弟元素（相同标签），使之与焦点元素状态相同。焦点不变。</li>
                            <li><kbd>Shift</kbd> + <kbd>E</kbd>：定位<strong>叔伯</strong>元素（父元素的兄弟元素）内的<em>相同标签</em>子元素，使之与焦点元素状态相同。焦点不变。这在选取同一父章节下的子章节的标题时很有用，或者选取表格中的列头（<code>&lt;th&gt;</code>）时有用。</li>
                            <li><kbd>Alt</kbd> + <kbd>Shift</kbd> + <kbd>E</kbd>：定位叔伯元素中<strong>标签相同</strong>且所在<strong>位置也相同</strong>的子元素，使之与焦点元素状态相同。焦点不变。这在选取<em>表格中的一列</em>时很有用。或者选取一个列表中<em>每一行的首个子元素</em>（如果标签相同）时有用。</li>
                        </ul>
                        <p role="tips"><strong>提示</strong>：新添加的元素位于选取集内的后部，这样的顺序可能并不是你想要的。按<kbd>S</kbd>键可以按DOM节点流顺序排序选取集。</p>
                        <p>下面的热键在移动焦点的同时会执行<strong>同态</strong>操作。</p>
                        <ul>
                            <li><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>↑</kbd>：同级<strong>向前</strong>（<code>previous</code>）扩展，支持前置数字指定扩展距离。焦点会移动到最终的元素上。</li>
                            <li><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>↓</kbd>：同级<strong>向后</strong>（<code>next</code>）扩展，支持同上。</li>
                        </ul>
                        <p role="note"><strong>注记</strong>：<kbd>Shift</kbd>在这里表示选取增强，<kbd>Ctrl</kbd>则表示<em>多选/切换选取</em>的逻辑，与鼠标多选逻辑相同。</p>
                        <p>下面的热键在移动焦点的同时会执行<strong>选取</strong>操作。<em>注：纵深方向上没有同态逻辑，因为选取成员不能相互包含。</em></p>
                        <ul>
                            <li><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>←</kbd>：<strong>向上</strong>移动焦点到<em>父元素</em>上，同时选取父元素。支持<em>数字</em>指定距离。</li>
                            <li><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>→</kbd>：<strong>向下</strong>移动焦点到<em>子元素</em>上，同时选取子元素。支持<em>数字</em>指定目标子元素的下表（<code>0</code>为首个）。</li>
                            <li><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>T</kbd>：移动焦点到当前焦点元素的顶元素（<code>Top</code>）上并选取。</li>
                        </ul>
                        <p>下面的操作与焦点元素状态无关，为固定的<em>选取</em>和<em>取消选取</em>逻辑。</p>
                        <ul>
                            <li><kbd>V</kbd>：同级<strong>反选</strong>。针对焦点元素所在层级，已选取的元素<em>取消选取</em>，未选取的元素<em>选取</em>。焦点不变。</li>
                            <li><kbd>W</kbd>：<strong>宽选</strong>内容子。向下检索焦点元素内全部<strong>内容根</strong>元素，将之添加到选取集。焦点移动到首个成员（<em>以体现视觉变化</em>）。</li>
                            <li><kbd>Shift</kbd> + <kbd>W</kbd>：同上<strong>宽选</strong>逻辑，但新的内容子元素插入到选取集头部而非末尾。焦点移动到首个成员。</li>
                            <li><kbd>Q</kbd>：<strong>排他选取</strong>。取消焦点元素之外的同级已选取，保留焦点元素的选取（<em>若未选取则自动选取</em>）。</li>
                            <li><kbd>Shift</kbd> + <kbd>Q</kbd>：全局<strong>排他选取</strong>。取消焦点元素之外全部已选取，保留焦点元素的选取或自动选取。</li>
                            <li><kbd>ESC</kbd>：<strong>取消</strong>全部选取和焦点元素的选取焦点（<strong>注</strong>：可撤销）。</li>
                        </ul>
                    </section>
                    <section role="s3">
                        <h2>虚焦点支持</h2>
                        <p>大部分的选取操作都是基于<em>焦点元素</em>，但焦点元素只有一个。对于需要批量操作的场景，这并不友好，因此这里引入了<strong>虚焦点</strong>的设计。</p>
                        <p>虚焦点是把选取集内的<strong>每一个成员都视为焦点元素</strong>，然后执行特定的操作。支持虚焦点的操作并不多，并且只有<strong>选取</strong>而没有<em>同态</em>的逻辑。因为每一个成员都变成了焦点，所以这里有一些限制：</p>
                        <ol>
                            <li>仅适用部分简单的选取，比如<kbd>E</kbd>选取同级同类元素，复杂的叔伯元素选取（<kbd>Shift+E</kbd>）则不适用。</li>
                            <li>平级操作时（<kbd>E</kbd>）选取集内的成员不能互为兄弟元素，每个成员只能是其父元素内的唯一选取。纵向操作（<kbd>W</kbd>）则无此约束。</li>
                        </ol>
                        <p>通常，支持虚焦点的操作会辅以<kbd>Alt</kbd>键。可用操作共<strong>8</strong>个：</p>
                        <ul>
                            <li><strong>平级类</strong>：<kbd>A</kbd>、<kbd>E</kbd>、<kbd>Ctrl+Shift+↑</kbd>、<kbd>Ctrl+Shift+↓</kbd>。每个成员在其父元素内为单选，因为操作之后即失去了唯一性，所以这是<em>一次性</em>的。</li>
                            <li><strong>纵深类</strong>：<kbd>W</kbd>、<kbd>Ctrl+Shift+→</kbd>、<kbd>Ctrl+Shift+←</kbd>、<kbd>Ctrl+Shift+T</kbd>。向下选取时元素各自独立，向上改选时共同的父级元素会被自动去重。</li>
                        </ul>
                        <p>如果操作使用了虚焦点，<em>平级类</em>会保留原来的实际焦点不变，但<em>纵深类</em>则会将焦点移到整个选取集的<strong>首个</strong>成员上。</p>
                    </section>
                    <section role="s3">
                        <h2>路径辅助选取</h2>
                        <p>在编辑器内容区的底部会显示当前焦点元素的<strong>DOM树路径</strong>，用鼠标单击其中任何一段，即可<strong>选取</strong>相应的元素。路径提供了清晰的节点树层次，可用于精确选取。</p>
                        <p>从路径上添加选取也可以是单选或多选，多选时按住<kbd>Ctrl</kbd>键单击即可。如果仅仅只需要从路径上<strong>聚焦</strong>目标元素，按住<kbd>Alt</kbd>即可，注意此时只是改变焦点，路径序列并不会重构，这样可以很方便的切换回来。</p>
                        <p role="tips"><strong>提示</strong>：将鼠标滑过路径上的不同部分，会有其对应元素的背景阴影提示。</p>
                    </section>
                    <section role="s3">
                        <h2>选取集排序</h2>
                        <p>元素的选取方式非常多也很灵活，但选取集内部成员的顺序有时是很重要的，比如<em>合并</em>、<em>移动插入</em>或者系统级的<em>复制</em>/<em>粘贴</em>等。除了通过仔细的按顺序选取外，如果要让选取集成员按DOM节点流排序，可以用如下热键完成。</p>
                        <ul>
                            <li><strong>正序</strong>：<kbd>S</kbd>。选取集按DOM节点流排序，焦点定位到排序后的首个成员。</li>
                            <li><strong>逆序</strong>：<kbd>Shift+S</kbd>。选取集按DOM节点树逆序排序，焦点定位规则同上（DOM上看为<em>最后一个</em>元素）。</li>
                        </ul>
                    </section>
                </section>
                <section role="s2">
                    <h2>编辑操作</h2>
                    <header>
                        <p>与选取类操作以焦点元素为中心不同，编辑操作的目标就是整个选取集成员。但<em>焦点元素</em>在这里有另外的用途——<em>定位</em>操作关联的目标。借鉴于<strong>Vim</strong>的操作便捷性，这里大部分的操作也都采用单个键位（或加辅助键）完成。</p>
                    </header>
                    <section role="s3">
                        <h2>普通编辑</h2>
                        <ul>
                            <li><strong>删除</strong>：<kbd>Delete</kbd>。删除选取集内的元素，有一定智能性，部分不可单独删除的不会删除（如：<code>&lt;td&gt;</code>、<code>&lt;rb&gt;</code>等）。</li>
                            <li><strong>内容删除</strong>：<kbd>Shift+Delete</kbd>。删除选取集元素内的可编辑内容（即内容元素里的内容），不含元素自身。</li>
                            <li><strong>强制删除</strong>：<kbd>Alt+Shift+Delete</kbd>。删除选取集内的任意元素，包括结构中不应被删除的子元素。有一定破坏性。</li>
                        </ul>
                        <ul>
                            <li><strong>撤消</strong>：<kbd>U</kbd>。Undo，撤销当前操作的选取或编辑。</li>
                            <li><strong>重做</strong>：<kbd>R</kbd>。Redo，重做被撤销的操作。</li>
                            <li><strong>逆序</strong>：<kbd>X</kbd>。将选取集内的同级兄弟元素逆序重排（移动），未选取的同级元素会保持原位置。</li>
                            <li><strong>合并</strong>：<kbd>Z</kbd>。将选取集内的元素的内容按选取顺序合并为一，<strong>首个</strong>选取的元素为容器，仅适用于内容元素。</li>
                            <li><strong>规范合并</strong>：<kbd>Alt+Z</kbd>。对整个内容区规范化（<code>normalize</code>合并相邻的文本节点）。通常不需要。这是一种DOM优化，在执行搜索命令时有用，因为搜索会以文本节点为边界，相邻的文字如果属于不同节点，则不能成词。</li>
                        </ul>
                        <ul>
                            <li><strong>分组克隆</strong>：<kbd>C</kbd>。以选取集内<strong>相邻的元素</strong>为分组，整体克隆并插入原组之后（<code>after</code>）。选取集更新为新插入的元素。<strong>特例</strong>：如果选取集只有一个成员，支持数字指定克隆数量。</li>
                            <li><strong>各别克隆</strong>：<kbd>Shift+C</kbd>。对选取集内的每一个成员独自克隆并插入其后（<code>after</code>）。选取集更新为新插入的元素。</li>
                        </ul>
                        <p style>以下操作与<em style>焦点元素</em>有关。</p>
                        <ul>
                            <li><strong>向内填充</strong>：<kbd>F</kbd>。将选取集成员<strong>移动</strong>填充到焦点元素之内（<code>fill</code>）。焦点元素<strong>不应当</strong>被选取。若源为非法子元素（结构限制），会自动提取其内容创建目标位置的默认子元素。</li>
                            <li><strong>克隆填充</strong>：<kbd>Shift+F</kbd>。将选取集成员<strong>克隆</strong>填充到焦点元素之内（<code>fill</code>）。焦点元素可以作为数据源。非法子元素规转换则同上。</li>
                            <li><strong>向内添加</strong>：<kbd>D</kbd>。将选取集成员<strong>移动</strong>添加到焦点元素内末尾（<code>append</code>）。焦点元素<strong>不应当</strong>被选取。非法子元素转换规则同上。</li>
                            <li><strong>克隆添加</strong>：<kbd>Shift+D</kbd>。将选取集成员<strong>克隆</strong>添加到焦点元素内末尾（<code>append</code>）。焦点元素可以作为数据源。非法子元素转换规则同上。</li>
                        </ul>
                        <ul>
                            <li><strong>移动前插入</strong>：<kbd>I</kbd>。将选取集成员<strong>移动</strong>并插入到焦点元素之前（<code>before</code>）。不可被删除的元素会移除其<strong>内容</strong>，焦点元素不可选取，非法元素转换规则同前。</li>
                            <li><strong>克隆前插入</strong>：<kbd>Shift+I</kbd>。将选取集成员<strong>克隆</strong>并插入到焦点元素之前（<code>before</code>）。焦点元素可以作为数据源，非法元素转换规则同前。</li>
                            <li><strong>移动后插入</strong>：<kbd>B</kbd>。将选取集成员<strong>移动</strong>并插入到焦点元素之后（<code>after</code>）。不可删除规则同上，焦点元素不可选取，非法元素转换规则同前。</li>
                            <li><strong>克隆后插入</strong>：<kbd>Shift+B</kbd>。将选取集成员<strong>克隆</strong>并插入到焦点元素之后（<code>after</code>）。焦点元素可以作为数据源，非法元素转换规则同前。</li>
                        </ul>
                        <aside>
                            <h3>注意：</h3>
                            <p>插入的顺序是按照选取的顺序逐个提取。这样的设计可以提高灵活性，如果需要有序，可以按<kbd>S</kbd>键排序。</p>
                            <p>上面的移动是<strong>跨层级</strong>的，适用任意目标位置。如果位置非法，内容会被<em>自动转换</em>。但这种移动并不那么直观，需要<em>焦点元素</em>来定位。下面有专注于简单移动的操作，比如兄弟元素之间的<em>平级移动</em>。</p>
                        </aside>
                    </section>
                    <section role="s3">
                        <h2>移动与缩进</h2>
                        <p>移动与缩进是编辑中常见的操作，这里的移动是元素自身的移动，但受限于内容单元固有的<em><code>HTML</code>结构</em>，这里的移动仅限于兄弟元素之间的<strong>平级</strong>移动。</p>
                        <p><strong>缩进</strong>的操作只适用于章节，针对<em>章节</em>（<code>s1-s5</code>）或<em>片区</em>（<code>section</code>）单元。包含<strong>升级</strong>和<strong>降级</strong>两种操作。</p>
                        <ul>
                            <li><strong>向前移动：</strong><kbd>Alt+↑</kbd>。选取集成员在各自父元素内平级移动，支持数字指定距离，超出范围会导致部分或全部逆序插入。<code>0</code> 值表示端部，有汇聚插入的效果。</li>
                            <li><strong>向后移动：</strong><kbd>Alt+↓</kbd>。数字支持同上，移动行为类似（方向不同）。</li>
                            <li><strong>章节升级</strong>：<kbd>Alt+←</kbd>。章节或片区左缩进，升级之后会排列到当前父片区之后（<code>after</code>）。<strong>注</strong>：这种层级递升不一定必然表现出视觉差异。</li>
                            <li><strong>章节降级</strong>：<kbd>Alt+→</kbd>。章节或片区右缩进，会在原地创建一个空的片区容器来包含被降级的片区。</li>
                        </ul>
                        <aside>
                            <h3>注：</h3>
                            <p>顶层章节的升级会被简单忽略，因为已经没有更高的层级可用了。</p>
                            <p>末层章节（<code>s5</code>）再降级会变成没有 <code>role</code> 定义的普通<strong>深片区</strong>，深片区可以无限向下缩进。</p>
                        </aside>
                    </section>
                    <section role="s3">
                        <h2>进入微编辑</h2>
                        <p>可以对元素内容进行简单的修订（<code>Modify</code>），这通过进入一种<strong>微编辑</strong>的状态实现。这种修订仅适用于<em>内容元素</em>。</p>
                        <p>有多个选取元素时，微编辑按选取的元素顺序逐个进入，编辑完成后按<kbd>Enter</kbd>或<kbd>Tab</kbd>键退出。同一时刻只有一个元素处于微编辑状态。</p>
                        <ul>
                            <li><kbd>M</kbd>：进入微编辑，光标定位到单击点。如果单击点不在元素内，进入后为全选状态。</li>
                            <li><kbd>Shift+M</kbd>：进入微编辑，光标定位到元素内容的末端。</li>
                            <li><kbd>Tab</kbd>：进入微编辑（同<kbd>M</kbd>）。如果有多个选取则按顺序进入，进入下一个之后前一个会自动确认。</li>
                        </ul>
                        <p role="tips"><strong>提示</strong>：非内容元素不能直接进入微编辑，此时可以按 <kbd>W</kbd> 或 <kbd>Shift+W</kbd> 选取其内容元素然后再继续。</p>
                    </section>
                    <section role="s3">
                        <h2>定位移动</h2>
                        <p>有时侯需要内容处于准确的平面位置，通常是设置其绝对样式（<code>position:absolute</code>以及<code>left</code>或<code>top</code>值）。这种定位方法需要用户了解一些CSS知识，如对容器设置<code>position:relative</code>样式。</p>
                        <p>如果容器已经设置了<code>position:relative</code>，元素自身设置了<code>position:absolute</code>，通过下面的操作就可以简单调整位置。</p>
                        <ul>
                            <li><kbd>Ctrl+←</kbd>：向左移动<strong>1</strong>像素。加按 <kbd>Shift</kbd> 则以<strong>10</strong>像素为单位。</li>
                            <li><kbd>Ctrl+→</kbd>：向右移动<strong>1</strong>像素。加按<kbd>Shift</kbd> 键同上。</li>
                            <li><kbd>Ctrl+↑</kbd>：向上移动<strong>1</strong>像素。加按<kbd>Shift</kbd> 键同上。</li>
                            <li><kbd>Ctrl+↓</kbd>：向下移动<strong>1</strong>像素。加按<kbd>Shift</kbd> 键同上。</li>
                        </ul>
                        <aside>
                            <h3>提示：</h3>
                            <p>对于没有设置绝对定位的元素，这些组合键操作会被简单忽略。<em>插图</em>单元在内容样式文件中通常有其<em>图片讲解</em>的<code>position: absolute</code>和容器的<code>position：relative</code>定义，因此无需手动设置。</p>
                        </aside>
                    </section>
                    <section role="s3">
                        <h2>复制和粘贴事件</h2>
                        <p>普通模式下支持系统级（浏览器）的<strong>复制</strong>、<strong>剪切</strong>和<strong>粘贴</strong>操作，操作目标为当前<strong>选取集</strong>元素。</p>
                        <ul>
                            <li><strong>复制</strong>：提取选取集元素的文本内容（<code>textContent</code>）到剪贴板，若有多个选取，内容以换行符分隔。</li>
                            <li><strong>剪切</strong>：规则同复制，但同时会删除元素本身，如果元素可以被删除的话。</li>
                            <li><strong>粘贴</strong>：以换行符切分剪贴板里的<strong>文本</strong>内容，分别添加到选取集元素或其<em>根内容元素</em>内。如果选取集只有一个成员，内容不会切分。粘贴默认为<em>填充覆盖</em>方式，加按<kbd>Shift</kbd>键为<em>末尾追加</em>（<code>append</code>）方式。</li>
                        </ul>
                        <aside>
                            <h3>注意：</h3>
                            <p>粘贴里的插入<strong>分组</strong>仅与<strong>选取</strong>有关，比如选取了一个<code>&lt;tr&gt;</code>元素，因为它不是内容元素，所以会宽选其内部的单元格为目标，但此时并不会分组，相同的内容会插入到其内所有单元格中。如果需要与单元格一一对应，应当选取单元格本身。</p>
                            <p>提取或插入的分组是按<em>选取顺序</em>对应的，可能你需要先按<kbd>S</kbd>键来排哈序。</p>
                        </aside>
                    </section>
                </section>
                <section role="s2">
                    <h2>杂项功能</h2>
                    <ul>
                        <li><kbd>P</kbd>：快捷打开目标单元的<strong>属性</strong>面板。<em><strong>注</strong>：从右击鼠标弹出的上下文菜单中也可以。</em></li>
                        <li><kbd>Alt+P</kbd>：<strong>导出</strong>文章内容<em>源码</em>，会自动打开导出对话框。</li>
                        <li><kbd>Alt+Shift+P</kbd>：同上<strong>导出</strong>内容<em>源码</em>，但会在适当的位置插入文章<strong>目录</strong>（大纲）。</li>
                        <li><kbd>Ctrl+S</kbd>：手动执行<strong>本地暂存</strong>（<code>localStorage</code>）。<em><strong>注</strong>：刷新页面会自动恢复之前保存的内容。</em></li>
                        <li><kbd>G</kbd>：<strong>章节跳转</strong>。根据键入的章节序列（如：<code>3.12.5</code>），将目标章节滚动到当前视口。<em><strong>注</strong>：需要内容区聚焦。</em></li>
                    </ul>
                </section>
                <section role="s2">
                    <h2>格式刷</h2>
                    <p>样式标签栏有一个<strong>格式刷</strong>按钮，可以对选取集内的元素应用<strong>焦点元素</strong>的样式。</p>
                </section>
            </section>
            <section role="s1">
                <h2>录入面板</h2>
                <header>
                    <p>与普通编辑器的原地输入不同，本设计中的内容录入主要通过内容面板来实现。</p>
                    <p>因为文章的内容单元有结构性限制，即该内容只能出现在什么位置（比如 <code>&lt;address&gt;</code> 应当只存在于 <code>&lt;footer&gt;</code> 内），所以录入面板的创建方式更合理，因为这样可以很方便的限定可以在目标位置创建什么内容。</p>
                    <p>目标位置用选取元素来标识，新的内容可以插入到该位置之前、之后或内部。如果选取了多个元素，可插入项目是各目标可插入项目的交集，且内容会同时插入到多个目标位置处。</p>
                </header>
                <section role="s2">
                    <h2>快捷键</h2>
                    <section role="s3">
                        <h2>录入文本框&lt;textarea&gt;</h2>
                        <ul>
                            <li><code>Alt+F</code><strong>切换</strong>录入框最大化（充满面板）。</li>
                            <li><code>Ctrl+Enter</code> 直接<strong>提交</strong>插入，效果同单击插入按钮。<strong>注</strong>：焦点会保持在录入框内。</li>
                            <li><code>Alt+Ctrl+Enter</code> 同上直接提交。但如果录入框已铺满，恢复为普通状态。</li>
                        </ul>
                    </section>
                    <section role="s3">
                        <h2>表格单元录入&lt;th|td&gt;</h2>
                        <ul>
                            <li><code>Enter</code> 纵向向下切换单元格（并选取）。</li>
                            <li><code>Shift + ↓</code> 同上效果。</li>
                            <li><code>Shift + ↑</code> 纵向向上切换单元格并选取。</li>
                            <li><code>Shift + Enter</code> 插入换行符（浏览器自身功能）。</li>
                        </ul>
                        <ul>
                            <li><code>粘贴</code> 内容以换行符切分，从焦点单元格开始，同行后续单元格连续粘贴（内容覆盖式）。</li>
                            <li><code>Shift + 粘贴</code> 普通方式粘贴，可能为纯文本（浏览器能力）。</li>
                        </ul>
                        <p role="tips"><strong>提示</strong>：智能切分粘贴只支持单行单元格序列。如果需要一次性对多行粘贴，可以插入后在内容区操作。</p>
                    </section>
                </section>
            </section>
            <section role="s1">
                <h2>修订模式</h2>
                <header>
                    <p>内容元素的 <code>contenteditable</code> 特性被设置为 <code>true</code>，此时即进入修订模式，编辑范围严格受限于容器元素之内。这种模式应当仅用于简单的文本修改。</p>
                    <p>在这种模式中，<code>Enter</code> 键的功能被严格限制，以回避不同浏览器的兼容性问题。</p>
                    <ul>
                        <li><code>Enter</code> 确认并退出。<strong>注</strong>：会提前执行 <code>normalize</code>。</li>
                        <li><code>Shift + Enter</code> 插入一个换行元素 <code>&lt;br&gt;</code>，或者在 <code>&lt;pre&gt;</code> 元素内插入一个换行字符 <code>\n</code>。<strong>注</strong>：浏览器默认行为。</li>
                        <li><code>Ctrl + Enter</code> 新建一个同类空行，原行确认，光标在新行内。仅限于段落类 <code>&lt;p:xx&gt;</code> 和列表项元素 <code>&lt;li&gt;, &lt;dt&gt;, &lt;dd&gt;</code>。</li>
                        <li><code>Alt + Enter</code> 新建一个逻辑空行。特定于 <code>dt &gt; dd</code> 和 <code>td|th ~ tr</code> 两种情况。</li>
                        <li><code>Tab</code> 完成并切换。功能与 <code>Enter</code> 类似，但会取消当前元素的选取并进入下一个已选取元素的微编辑（如果有）。</li>
                        <li><code>ESC</code> 取消当前修订并退出微编辑。元素选取保持。</li>
                    </ul>
                    <aside>
                        <h3>附：换行兼容性</h3>
                        <p><code>Enter</code> 的行为在不同浏览器之间差异较大，<code>Shift+Enter</code> 则较为一致。</p>
                        <p><code>&lt;pre&gt;</code> 元素微编辑修订后，其中的换行元素 <code>&lt;br&gt;</code> 会被强制替换为换行字符 <code>\n</code>，以保证内容的一致性。</p>
                    </aside>
                </header>
                <section role="s2">
                    <h2>代码元素</h2>
                    <p>对于普通的内容元素，修订时是所见即所得的。但对于代码内容，则是纯文本的（语法标注 <code>&lt;b&gt;</code> 会被清除），系统会在确认提交时重新解析语法。</p>
                    <p role="tips"><strong>提示</strong>：后期可能提供代码编辑时的即时解析高亮能力。</p>
                </section>
            </section>
            <section role="s1">
                <h2>属性框</h2>
                <p>选中目标元素或相同类型的多个单元，如果该类型有属性可修改，键入快捷键 <code>P</code> 或从上下文菜单中单击属性条目，可打开属性编辑对话框。</p>
                <p>如果目标只是单个单元，修改的属性条目会逐一应用：文本框内的空串会导致该条目的属性被移除，其它形式的控件则遵循所显示的意义。</p>
                <p>但如果目标是多个单元，则属性对应的条目控件存在<strong>不确定</strong>态，即 <code>indeterminate</code>。不确定态的条目如果未作修改（控件保持原样），则表示各条目的对应属性也会保持原样。这为多个目标的部分属性执行批量修改提供了可能性。表示不确定态的控件状态约定如下：</p>
                <ul>
                    <li>文本框： 包含 <code>&lt;input:text&gt;</code> 和 <code>&lt;textarea&gt;</code> 两种，无值（空串）时表示不确定态。<code>$.val()</code> 取值为一个空串。</li>
                    <li>单选按钮组： 没有任一按钮被选中时，表示不确定态。<code>$.val()</code> 取值为 <code>null</code>。</li>
                    <li>复选按钮： 浏览器支持其不确定态的特殊外观（通常是小方框内一个短横线），同时该控件的 <code>indeterminate</code> 属性值为 <code>true</code>。取值时应当检查 <code>indeterminate</code> 属性而不是简单地调用 <code>$.val()</code>。</li>
                    <li>条目选单： 即 <code>&lt;select&gt;</code>，类似单选按钮组，没有任一条目被选中时为不确定态。<code>$.val()</code> 取值为 <code>null</code>。</li>
                </ul>
                <p role="tips"><strong>注意</strong>：不确定态区分仅适用于多目标选取时。</p>
            </section>
            <section role="s1">
                <h2>命令行</h2>
                <section role="s2">
                    <h2>搜索（/）</h2>
                    <p>可以对全文或已选取的集合范围执行文本搜索，搜索的结果会被标记为特殊的 `&lt;mark&gt;` 元素。</p>
                    <p>文本的搜索以文本节点为上下文，不支持跨节点文本的搜索。这既是一种简化方便，也可能有它的合理性：既然文本被断开了，就认为横贯断点的文本不应当被匹配。</p>
                    <p>激活搜索的指令符为斜线（`/`）。焦点进入命令行后，遵循如下格式：</p>
                    <ul>
                        <li><code>Hello</code> 检索文本 <code>Hello</code>，回车后执行。如果已经存在选取集，则在选取集范围内执行检索。下同。</li>
                        <li><code>abc/xyz/ok</code> 检索文本 <code>abc/xyz/ok</code>，文本内的斜线只是普通字符。</li>
                    </ul>
                    <ul>
                        <li><code>/[0-9a-f]/i</code> 这是一个正则表达式，由前置的 <code>/</code> 标示出来。</li>
                        <li><code>/[0-9a-f]</code> 正则表达式<strong>格式错误</strong>，缺乏结尾 <code>/</code>。会被视为一个普通的字符串。</li>
                        <li><code>/[0-9a-f]/</code> 合法的正则表达式。</li>
                        <li><code>/[0-9a-f]/ </code> 末尾的空格使得这只是一个普通字符串，这也是搜索正则式串本身的一个小技巧。</li>
                    </ul>
                    <aside>
                        <h3>注记：</h3>
                        <p>不支持直接在表达式中定义替换功能，仅仅只是简单地检索文本内容。</p>
                        <p>检索结果会封装为（<code>&lt;mark&gt;</code>）并选取，因此可以通过其它方式操作目标。比如替换（粘贴+内容提升）、封装（转换）或删除（按 <code>Delete</code>）。</p>
                    </aside>
                </section>
                <section role="s2">
                    <h2>查询（?）</h2>
                    <p>保留问号（<code>?</code>）指令符用于未来的社区交互逻辑。</p>
                </section>
            </section>
            <section role="s1">
                <h2>注记</h2>
                <section role="s2">
                    <h2>单元移动/转换</h2>
                    <ul>
                        <li>同级兄弟元素间可自由移动，但不能跨越固定性单元。</li>
                        <li>跨容器单元的移动涉及转换，如果目标位置合法则简单移动，否则转换构造为默认的合法单元插入。</li>
                    </ul>
                </section>
                <section role="s2">
                    <h2>表格的容错编辑</h2>
                    <p>通过特性编辑面板，用户可以修改单元格的 <code>rowspan</code> 和 <code>colspan</code> 特性，因此对于懂得 HTML 结构的专业用户来说，他们可以自由构建不规整的表格结构。因此，编辑器不阻止用户删除/插入独立的单元格。</p>
                    <p>但这种能力是用户自有的，如果克隆表格行（<code>&lt;tr&gt;</code>），编辑器并不检查单元格的这两个特性，而只是简单地参考表格的 <code>$.Table</code> 实例的内在状态值（列头和列数）进行处理。</p>
                </section>
                <section role="s2">
                    <h2>兼容性依赖</h2>
                    <p>修订模式下需要浏览器的 <code>document.execCommand</code> 支持，以实现从外部插入内容时，可以直接使用浏览器的<strong>Undo/Redo</strong>功能，避免编写复杂的撤销和重做代码。</p>
                </section>
            </section>
        </article>
    </main>
</body>
</html>